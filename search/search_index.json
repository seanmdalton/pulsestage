{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"PulseStage","text":"<p>Open-source Q&amp;A Platform for Town Halls and All-Hands</p> <p> </p> <p>PulseStage helps teams capture questions, surface what matters with up-votes, and publish clear answers\u2014then present it all live. Built as a full-stack AMA-style app with multi-team spaces and role-based controls, it's designed to increase employee engagement and organizational transparency.</p>"},{"location":"#why-pulsestage","title":"Why PulseStage?","text":"<ul> <li>Up-vote\u2013only questions to reduce noise and highlight priorities  </li> <li>Team-based organization for different departments or forums  </li> <li>Role-based moderation (viewer, member, moderator, admin, owner)  </li> <li>Advanced search with full-text search, filters, and date ranges</li> <li>Moderation tools - Pin, freeze, bulk operations, and analytics</li> <li>Presenter mode for leadership meetings and all-hands  </li> <li>Tagging system for organizing and categorizing questions</li> <li>Real-time updates via Server-Sent Events (SSE)</li> <li>Audit logging for compliance and security</li> <li>Exports (CSV/JSON) for follow-ups and accountability  </li> <li>Self-hostable with Docker (Postgres + Redis), open source (Apache-2.0)</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Get PulseStage running in under 5 minutes:</p> <pre><code>git clone https://github.com/seanmdalton/pulsestage.git\ncd pulsestage\n./setup.sh\ndocker compose up\n</code></pre> <p>Visit http://localhost:3000 to start using PulseStage!</p> <p>For detailed setup instructions, see the Installation Guide.</p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#multi-team-organization","title":"\ud83c\udfe2 Multi-Team Organization","text":"<ul> <li>Organize questions by Engineering, Product, People, General teams</li> <li>Easy team switching with question counts</li> <li>Team management through Admin panel</li> <li>Shareable URLs like <code>/engineering/open</code> or <code>/product/answered</code></li> </ul>"},{"location":"#question-management","title":"\u2753 Question Management","text":"<ul> <li>Anonymous question submission with team assignment</li> <li>Full-text search with prefix matching (e.g., \"mob\" finds \"mobile\")</li> <li>Advanced filters: tags, date ranges, status, team</li> <li>Upvote system with protection against self-upvoting</li> <li>Full-screen viewing for long questions and answers</li> <li>Status tracking (Open and Answered)</li> <li>Tag-based organization</li> </ul>"},{"location":"#role-based-access-control","title":"\ud83d\udc65 Role-Based Access Control","text":"<ul> <li>Viewer: Browse questions anonymously, upvote</li> <li>Member: Submit and upvote questions</li> <li>Moderator: Answer questions, tag, pin, freeze, present (team-scoped)</li> <li>Admin: Full access including exports, audit logs, and team management</li> <li>Owner: Complete control including user management</li> </ul>"},{"location":"#moderation-tools","title":"\ud83d\udccc Moderation Tools","text":"<ul> <li>Pin questions to highlight important topics</li> <li>Freeze questions to lock them from further interaction</li> <li>Bulk operations - Tag, pin, freeze, or delete multiple questions at once</li> <li>Moderation queue - Dedicated interface with comprehensive filters</li> <li>Analytics dashboard - Track moderator performance and activity</li> <li>Quick actions - Pin \ud83d\udccc, Freeze \u2744\ufe0f, Answer \ud83d\udcac buttons on each question</li> </ul>"},{"location":"#modern-user-experience","title":"\ud83c\udfa8 Modern User Experience","text":"<ul> <li>Beautiful, responsive design with dark mode</li> <li>Real-time updates via Server-Sent Events (SSE)</li> <li>Presentation mode optimized for large displays with live tag updates</li> <li>Debounced search with instant feedback</li> <li>Profile management with favorite teams</li> <li>Persistent state across browser windows</li> </ul>"},{"location":"#security-compliance","title":"\ud83d\udd12 Security &amp; Compliance","text":"<ul> <li>Comprehensive audit logging (all admin/mod actions tracked)</li> <li>Team-scoped permissions with RBAC enforcement</li> <li>Tenant isolation for multi-tenancy</li> <li>Session-based authentication with HttpOnly cookies</li> <li>CSRF protection on all state-changing endpoints</li> <li>Security headers (Helmet, CSP, HSTS, X-Frame-Options)</li> <li>Rate limiting on all endpoints</li> <li>MDN HTTP Observatory integration for security validation</li> </ul>"},{"location":"#technology-stack","title":"Technology Stack","text":"<ul> <li>Frontend: React 19, TypeScript, Tailwind CSS, Vite</li> <li>Backend: Node.js 24 LTS, Express, TypeScript</li> <li>Database: PostgreSQL 16 with Prisma ORM, full-text search (GIN indexes)</li> <li>Cache: Redis 7 for rate limiting and session storage</li> <li>Testing: Vitest (208 tests), Playwright E2E, MDN HTTP Observatory</li> <li>Security: Helmet, CSRF protection (csrf-csrf), Content Security Policy</li> <li>Deployment: Docker Compose with multi-stage builds</li> <li>CI/CD: GitHub Actions with Semgrep (SAST), Trivy (security scanning), SBOM generation</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Getting Started - Installation and first steps</li> <li>User Guide - How to use PulseStage</li> <li>Admin Guide - Managing teams, users, and settings</li> <li>Architecture - Technical design and decisions</li> <li>Security - Security features and best practices</li> <li>API Reference - REST API documentation</li> <li>Development - Contributing and local development</li> </ul>"},{"location":"#license","title":"License","text":"<p>Licensed under the Apache License, Version 2.0. See LICENSE for details.</p>"},{"location":"#support","title":"Support","text":"<ul> <li>\ud83d\udcd6 Documentation</li> <li>\ud83d\udc1b Issue Tracker</li> <li>\ud83d\udcac Discussions</li> </ul>"},{"location":"about/branding/","title":"Branding","text":"<p>Documentation coming soon...</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>Documentation coming soon...</p>"},{"location":"about/license/","title":"License","text":"<p>Documentation coming soon...</p>"},{"location":"admin-guide/audit-logging/","title":"Audit Logging","text":"<p>Documentation coming soon...</p>"},{"location":"admin-guide/export/","title":"Export","text":"<p>Documentation coming soon...</p>"},{"location":"admin-guide/moderation-stats/","title":"Moderation Stats","text":"<p>Track moderation activity and performance with detailed analytics dashboard.</p>"},{"location":"admin-guide/moderation-stats/#overview","title":"Overview","text":"<p>Access Moderation Stats from the Admin Panel \u2192 Stats tab.</p> <p>Who can access: - \u2705 Moderators (see their own stats + team stats) - \u2705 Admins (all stats) - \u2705 Owners (all stats)</p>"},{"location":"admin-guide/moderation-stats/#overall-metrics","title":"Overall Metrics","text":"<p>Four key performance indicators displayed as cards:</p>"},{"location":"admin-guide/moderation-stats/#questions-reviewed","title":"Questions Reviewed","text":"<p>Total number of questions reviewed/answered by all moderators in the date range.</p> <p>Includes: - Questions answered - Questions reviewed but not answered - All moderator activity</p>"},{"location":"admin-guide/moderation-stats/#questions-answered","title":"Questions Answered","text":"<p>Total questions that received a response (status changed to ANSWERED).</p> <p>Answer Rate = Questions Answered / Questions Reviewed</p>"},{"location":"admin-guide/moderation-stats/#questions-pinned","title":"Questions Pinned","text":"<p>Total questions currently pinned (highlighted as important).</p>"},{"location":"admin-guide/moderation-stats/#average-response-time","title":"Average Response Time","text":"<p>Mean time from question creation to response, calculated across all answered questions.</p> <p>Displayed as: - Minutes (e.g., \"45m\") for &lt; 60 minutes - Hours and minutes (e.g., \"2h 15m\") for &gt;= 60 minutes - \"N/A\" if no questions have been answered</p>"},{"location":"admin-guide/moderation-stats/#per-moderator-breakdown","title":"Per-Moderator Breakdown","text":"<p>Detailed table showing performance for each moderator:</p> Column Description Moderator Name and email address Reviewed Total questions reviewed Answered Questions with responses Pinned Questions pinned by this moderator Frozen Questions frozen by this moderator Avg Response Average time to respond Teams Number of teams this moderator covers <p>Sorted by: Questions reviewed (most active moderators first)</p>"},{"location":"admin-guide/moderation-stats/#filters","title":"Filters","text":""},{"location":"admin-guide/moderation-stats/#date-range","title":"Date Range","text":"<p>Default: Last 30 days (most recent activity)</p> <p>Custom Range: - Start Date - Beginning of date range - End Date - End of date range (inclusive, includes full day)</p> <p>Indicator: Blue badge shows current range: \"\ud83d\udcc5 Showing: MM/DD/YYYY - MM/DD/YYYY\"</p> <p>Reset Button: \"Reset to Last 30 Days\" returns to default view</p>"},{"location":"admin-guide/moderation-stats/#team-filter","title":"Team Filter","text":"<p>Filter stats to a specific team to see: - Only questions from that team - Only moderators active on that team - Team-specific metrics</p>"},{"location":"admin-guide/moderation-stats/#activity-breakdown","title":"Activity Breakdown","text":"<p>Side panel showing additional metrics:</p>"},{"location":"admin-guide/moderation-stats/#activity-metrics","title":"Activity Metrics","text":"<ul> <li>Total Reviewed - Same as overall card</li> <li>Answer Rate - Percentage of reviewed questions that were answered</li> <li>Questions Frozen - Total frozen in this period</li> </ul>"},{"location":"admin-guide/moderation-stats/#team-activity","title":"Team Activity","text":"<ul> <li>Active Moderators - Number of moderators with activity</li> <li>Avg per Moderator - Questions reviewed per moderator</li> <li>Coverage - Total team assignments across all moderators</li> </ul>"},{"location":"admin-guide/moderation-stats/#use-cases","title":"Use Cases","text":""},{"location":"admin-guide/moderation-stats/#monitor-moderator-performance","title":"Monitor Moderator Performance","text":"<ol> <li>Check default view (last 30 days, all teams)</li> <li>Review per-moderator stats - Who's most active?</li> <li>Check answer rates - Are moderators responding?</li> <li>Review response times - Are we answering quickly?</li> </ol>"},{"location":"admin-guide/moderation-stats/#analyze-team-engagement","title":"Analyze Team Engagement","text":"<ol> <li>Filter to specific team (e.g., \"Engineering\")</li> <li>Check question volume - How many questions from this team?</li> <li>Review moderator coverage - How many moderators active?</li> <li>Check response quality - Are questions getting answered?</li> </ol>"},{"location":"admin-guide/moderation-stats/#historical-analysis","title":"Historical Analysis","text":"<ol> <li>Set custom date range (e.g., Q1 2025)</li> <li>Compare periods - More/less activity than last quarter?</li> <li>Identify trends - Which teams need more moderation support?</li> </ol>"},{"location":"admin-guide/moderation-stats/#performance-reviews","title":"Performance Reviews","text":"<ol> <li>Filter to specific moderator using team filter</li> <li>Check their metrics - Questions reviewed, answered, response time</li> <li>Compare to team average</li> <li>Identify top performers - Sorted by activity</li> </ol>"},{"location":"admin-guide/moderation-stats/#what-gets-tracked","title":"What Gets Tracked","text":""},{"location":"admin-guide/moderation-stats/#when-is-reviewedby-set","title":"When is <code>reviewedBy</code> Set?","text":"<p>The <code>reviewedBy</code> field is automatically set when:</p> <ol> <li>Moderator answers a question - <code>reviewedBy</code> = user who answered</li> <li><code>reviewedAt</code> timestamp - When the answer was submitted</li> </ol>"},{"location":"admin-guide/moderation-stats/#moderation-actions-tracked","title":"Moderation Actions Tracked","text":"<p>All moderation actions are counted:</p> <ul> <li>\u2705 Answering questions</li> <li>\u2705 Pinning/unpinning</li> <li>\u2705 Freezing/unfreezing</li> <li>\u2705 Tagging questions</li> <li>\u2705 Bulk operations</li> </ul>"},{"location":"admin-guide/moderation-stats/#interpreting-metrics","title":"Interpreting Metrics","text":""},{"location":"admin-guide/moderation-stats/#high-review-count-low-answer-count","title":"High Review Count, Low Answer Count","text":"<p>Indicates: Moderators are active but not answering</p> <p>Possible reasons: - Questions are being triaged/tagged but not answered - Questions frozen or archived without answers - Bulk operations counting as reviews</p>"},{"location":"admin-guide/moderation-stats/#long-response-times","title":"Long Response Times","text":"<p>Indicates: Delay between question submission and answer</p> <p>Possible reasons: - Questions submitted far in advance of town hall - Complex questions requiring research - Low moderator availability</p> <p>Action: Consider more moderators or faster triage process</p>"},{"location":"admin-guide/moderation-stats/#uneven-distribution","title":"Uneven Distribution","text":"<p>Indicates: Some moderators much more active than others</p> <p>Possible reasons: - Different team sizes - Uneven team assignments - Some moderators more engaged</p> <p>Action: Review team assignments and workload distribution</p>"},{"location":"admin-guide/moderation-stats/#best-practices","title":"Best Practices","text":""},{"location":"admin-guide/moderation-stats/#regular-monitoring","title":"Regular Monitoring","text":"<ul> <li>Check weekly - Review last 7 days of activity</li> <li>Monthly reports - Compare month-over-month trends</li> <li>Pre-event - Ensure all moderators prepared for town halls</li> </ul>"},{"location":"admin-guide/moderation-stats/#setting-expectations","title":"Setting Expectations","text":"<p>Use stats to set team goals:</p> <ul> <li>Target response time - e.g., &lt; 24 hours</li> <li>Answer rate - e.g., &gt; 80% of reviewed questions answered</li> <li>Coverage - Each team has &gt;= 2 active moderators</li> </ul>"},{"location":"admin-guide/moderation-stats/#recognizing-top-performers","title":"Recognizing Top Performers","text":"<ul> <li>Sort by questions reviewed - See most active moderators</li> <li>Share achievements - Recognize top contributors</li> <li>Balance workload - Redistribute if one moderator doing too much</li> </ul>"},{"location":"admin-guide/moderation-stats/#related-pages","title":"Related Pages","text":"<ul> <li>Moderation Queue</li> <li>Audit Logging</li> <li>Export</li> </ul>"},{"location":"admin-guide/overview/","title":"Admin Guide Overview","text":"<p>Welcome to the PulseStage admin guide! As an admin, you have global access to manage teams, users, permissions, and system-wide settings.</p>"},{"location":"admin-guide/overview/#what-is-an-admin","title":"What is an Admin?","text":"<p>Admins are global roles with access to: - All teams and questions across the entire tenant - User and team management - System configuration and settings - Audit logs and security features - Global moderation statistics</p>"},{"location":"admin-guide/overview/#key-features-for-admins","title":"Key Features for Admins","text":""},{"location":"admin-guide/overview/#team-management","title":"\ud83d\udc65 Team Management","text":"<p>Create, configure, and manage teams across your organization. Assign moderators and control team settings.</p> <p>Learn more about team management \u2192</p>"},{"location":"admin-guide/overview/#tag-management","title":"\ud83c\udff7\ufe0f Tag Management","text":"<p>Create and manage global tags that can be used across all teams. Define tag colors and descriptions.</p> <p>Learn more about tag management \u2192</p>"},{"location":"admin-guide/overview/#user-roles-permissions","title":"\ud83d\udd10 User Roles &amp; Permissions","text":"<p>Manage user roles and permissions using PulseStage's role-based access control (RBAC) system.</p> <p>Learn more about roles &amp; permissions \u2192</p>"},{"location":"admin-guide/overview/#moderation-statistics","title":"\ud83d\udcca Moderation Statistics","text":"<p>View global moderation metrics, track moderator performance, and analyze Q&amp;A activity across all teams.</p> <p>Learn more about moderation stats \u2192</p>"},{"location":"admin-guide/overview/#audit-logging","title":"\ud83d\udccb Audit Logging","text":"<p>Review comprehensive audit logs of all administrative actions, including who did what and when.</p> <p>Learn more about audit logging \u2192</p>"},{"location":"admin-guide/overview/#export-data","title":"\ud83d\udce4 Export Data","text":"<p>Export questions, answers, and analytics data for reporting and compliance purposes.</p> <p>Learn more about data export \u2192</p>"},{"location":"admin-guide/overview/#admin-vs-moderator-vs-owner","title":"Admin vs Moderator vs Owner","text":"Feature Viewer Member Moderator Admin Owner View questions \u2705 \u2705 \u2705 \u2705 \u2705 Submit questions \u274c \u2705 \u2705 \u2705 \u2705 Upvote questions \u274c \u2705 \u2705 \u2705 \u2705 Answer questions \u274c \u274c \u2705 (team-scoped) \u2705 (global) \u2705 (global) Tag questions \u274c \u274c \u2705 (team-scoped) \u2705 (global) \u2705 (global) Pin/Freeze \u274c \u274c \u2705 (team-scoped) \u2705 (global) \u2705 (global) Moderation queue \u274c \u274c \u2705 (team-scoped) \u2705 (global) \u2705 (global) Manage teams \u274c \u274c \u274c \u2705 \u2705 Manage users \u274c \u274c \u274c \u2705 \u2705 Manage tags \u274c \u274c \u274c \u2705 \u2705 View audit logs \u274c \u274c \u274c \u2705 \u2705 Export data \u274c \u274c \u274c \u2705 \u2705 Full system access \u274c \u274c \u274c \u274c \u2705 <p>Global Access</p> <p>Admins and Owners have global access across all teams. Unlike moderators, who are team-scoped, admins can:</p> <ul> <li>View and manage questions from any team</li> <li>Access moderation statistics for all teams</li> <li>Perform administrative actions without team restrictions</li> </ul>"},{"location":"admin-guide/overview/#admin-permissions","title":"Admin Permissions","text":"<p>As an admin, you have access to:</p> <p>\u2705 All questions across all teams \u2705 Global moderation queue and statistics \u2705 Team management (create, edit, delete) \u2705 User role management \u2705 Tag management (create, edit, delete) \u2705 Audit log viewing and export \u2705 Data export (CSV/JSON) \u2705 Pin, freeze, and delete questions globally  </p>"},{"location":"admin-guide/overview/#getting-started","title":"Getting Started","text":"<ol> <li>Access the Admin Panel from your user dropdown (visible from any team)</li> <li>Review the Moderation Queue to see all pending questions</li> <li>Check Moderation Stats to understand platform usage</li> <li>Manage Teams to organize your organization</li> <li>Review Audit Logs to track administrative actions</li> </ol>"},{"location":"admin-guide/overview/#quick-tips","title":"Quick Tips","text":"<p>Best Practices</p> <ul> <li>Set up teams first: Create your organizational structure before adding users</li> <li>Define roles clearly: Assign moderators to appropriate teams</li> <li>Create tag taxonomy: Establish consistent tags before Q&amp;A sessions</li> <li>Monitor audit logs: Regularly review administrative actions</li> <li>Export data regularly: Keep backups and generate reports</li> <li>Review stats: Track engagement and moderator performance</li> </ul> <p>Security Best Practices</p> <ul> <li>Limit admin roles to trusted users</li> <li>Review audit logs for suspicious activity</li> <li>Use strong authentication (SSO recommended)</li> <li>Export and backup data regularly</li> <li>Monitor moderation statistics for anomalies</li> </ul>"},{"location":"admin-guide/overview/#admin-workflow","title":"Admin Workflow","text":"<p>A typical admin workflow:</p> <ol> <li>Initial Setup:</li> <li>Create teams for your organization</li> <li>Assign moderators to teams</li> <li>Create tag taxonomy</li> <li> <p>Configure settings</p> </li> <li> <p>Ongoing Management:</p> </li> <li>Monitor moderation statistics</li> <li>Review audit logs weekly</li> <li>Manage user roles as needed</li> <li> <p>Export data for reporting</p> </li> <li> <p>Before Events:</p> </li> <li>Ensure moderators are assigned</li> <li>Review and clean up old questions</li> <li> <p>Check system health</p> </li> <li> <p>After Events:</p> </li> <li>Review participation metrics</li> <li>Export Q&amp;A data</li> <li>Analyze engagement trends</li> </ol>"},{"location":"admin-guide/overview/#security-compliance","title":"Security &amp; Compliance","text":"<p>As an admin, you're responsible for:</p> <ul> <li>Data security: Protecting user questions and responses</li> <li>Access control: Managing who can view and moderate</li> <li>Audit trails: Maintaining records of administrative actions</li> <li>Data retention: Exporting and archiving data as needed</li> <li>Compliance: Following your organization's policies</li> </ul> <p>Learn more about security features \u2192</p>"},{"location":"admin-guide/overview/#need-help","title":"Need Help?","text":"<ul> <li>For user features: See the User Guide</li> <li>For moderator features: See the Moderator Guide</li> <li>For technical issues: Check our GitHub Issues</li> <li>For security: See the Security Documentation</li> </ul>"},{"location":"admin-guide/overview/#next-steps","title":"Next Steps","text":"<p>Ready to administer PulseStage? Check out these guides:</p> <ul> <li>Team Management - Set up your organizational structure</li> <li>Roles &amp; Permissions - Understand the RBAC system</li> <li>Moderation Stats - Track platform engagement</li> <li>Audit Logging - Monitor administrative actions</li> </ul>"},{"location":"admin-guide/roles-permissions/","title":"Roles Permissions","text":"<p>Documentation coming soon...</p>"},{"location":"admin-guide/tag-management/","title":"Tag Management","text":"<p>Documentation coming soon...</p>"},{"location":"admin-guide/team-management/","title":"Team Management","text":"<p>Documentation coming soon...</p>"},{"location":"api/admin/","title":"Admin","text":"<p>Documentation coming soon...</p>"},{"location":"api/authentication/","title":"Authentication","text":"<p>Documentation coming soon...</p>"},{"location":"api/overview/","title":"API Reference Overview","text":"<p>Welcome to the PulseStage API documentation! This reference covers all available endpoints, authentication methods, and integration patterns.</p>"},{"location":"api/overview/#base-url","title":"Base URL","text":"<p>All API requests should be made to:</p> <pre><code>http://localhost:3000/api\n</code></pre> <p>Or in production:</p> <pre><code>https://your-domain.com/api\n</code></pre>"},{"location":"api/overview/#authentication","title":"Authentication","text":"<p>PulseStage uses SSO (Single Sign-On) for authentication. All API requests must include:</p> <pre><code>X-Tenant-ID: your-tenant-id\nX-Mock-SSO-User: user@example.com  # For development\n</code></pre> <p>In production, authentication is handled by your SSO provider, and the API validates sessions via cookies.</p> <p>Learn more about authentication \u2192</p>"},{"location":"api/overview/#core-concepts","title":"Core Concepts","text":""},{"location":"api/overview/#multi-tenancy","title":"Multi-Tenancy","text":"<p>Every request must include a tenant ID. Data is isolated per tenant, ensuring complete separation between organizations.</p>"},{"location":"api/overview/#team-scoping","title":"Team Scoping","text":"<p>Questions, users, and permissions are scoped to teams. Users can be members of multiple teams with different roles per team.</p>"},{"location":"api/overview/#role-based-access-control-rbac","title":"Role-Based Access Control (RBAC)","text":"<p>Five roles control access: - Viewer: Read-only access - Member: Can submit and upvote questions - Moderator: Can answer and tag questions (team-scoped) - Admin: Can manage teams and users (global access) - Owner: Full system access (global access)</p>"},{"location":"api/overview/#real-time-updates","title":"Real-Time Updates","text":"<p>PulseStage uses Server-Sent Events (SSE) for real-time updates. Connect to <code>/sse</code> to receive live events.</p>"},{"location":"api/overview/#available-resources","title":"Available Resources","text":""},{"location":"api/overview/#questions","title":"Questions","text":"<p>Submit, upvote, search, and manage questions.</p> <p>View Questions API \u2192</p> <p>Key Endpoints: - <code>GET /questions</code> - List questions with filters - <code>POST /questions</code> - Submit a new question - <code>POST /questions/:id/upvote</code> - Upvote a question - <code>POST /questions/:id/respond</code> - Answer a question (moderator+) - <code>POST /questions/:id/pin</code> - Pin a question (moderator+) - <code>POST /questions/:id/freeze</code> - Freeze a question (moderator+)</p>"},{"location":"api/overview/#teams","title":"Teams","text":"<p>Manage teams and memberships.</p> <p>View Teams API \u2192</p> <p>Key Endpoints: - <code>GET /teams</code> - List all teams - <code>POST /teams</code> - Create a new team (admin+) - <code>GET /teams/:id</code> - Get team details - <code>POST /teams/:id/members</code> - Add team member (admin+)</p>"},{"location":"api/overview/#tags","title":"Tags","text":"<p>Create and manage tags for organizing questions.</p> <p>View Tags API \u2192</p> <p>Key Endpoints: - <code>GET /tags</code> - List all tags - <code>POST /tags</code> - Create a new tag (admin+) - <code>POST /questions/:id/tag</code> - Tag a question (moderator+) - <code>DELETE /questions/:id/tag/:tagId</code> - Remove tag (moderator+)</p>"},{"location":"api/overview/#users","title":"Users","text":"<p>User profile and preferences.</p> <p>View Users API \u2192</p> <p>Key Endpoints: - <code>GET /users/me</code> - Get current user profile - <code>GET /users/:id</code> - Get user details</p>"},{"location":"api/overview/#admin","title":"Admin","text":"<p>Administrative endpoints for moderation, stats, and audit logs.</p> <p>View Admin API \u2192</p> <p>Key Endpoints: - <code>GET /admin/moderation-queue</code> - Get moderation queue (moderator+) - <code>POST /admin/bulk-action</code> - Bulk operations (admin+) - <code>POST /admin/bulk-tag</code> - Bulk tagging (moderator+) - <code>GET /admin/stats/moderation</code> - Moderation statistics (moderator+) - <code>GET /admin/audit-log</code> - View audit logs (admin+) - <code>GET /admin/export</code> - Export data as CSV/JSON (admin+)</p>"},{"location":"api/overview/#response-format","title":"Response Format","text":"<p>All API responses follow a consistent format:</p>"},{"location":"api/overview/#success-response","title":"Success Response","text":"<pre><code>{\n  \"id\": \"uuid\",\n  \"body\": \"Question text\",\n  \"upvotes\": 5,\n  \"status\": \"OPEN\",\n  \"createdAt\": \"2025-10-05T12:00:00.000Z\"\n}\n</code></pre>"},{"location":"api/overview/#error-response","title":"Error Response","text":"<pre><code>{\n  \"error\": \"Error message\",\n  \"code\": \"ERROR_CODE\"\n}\n</code></pre>"},{"location":"api/overview/#list-response","title":"List Response","text":"<pre><code>{\n  \"questions\": [...],\n  \"total\": 42,\n  \"limit\": 100,\n  \"offset\": 0\n}\n</code></pre>"},{"location":"api/overview/#http-status-codes","title":"HTTP Status Codes","text":"Code Meaning Usage 200 OK Request succeeded 201 Created Resource created successfully 400 Bad Request Invalid input or validation error 401 Unauthorized Authentication required 403 Forbidden Insufficient permissions 404 Not Found Resource doesn't exist 409 Conflict Duplicate action (e.g., already upvoted) 500 Internal Server Error Server-side error"},{"location":"api/overview/#rate-limiting","title":"Rate Limiting","text":"<p>API requests are rate-limited per user and IP address:</p> <ul> <li>Per User: 100 requests per minute</li> <li>Per IP: 1000 requests per minute (for anonymous endpoints)</li> </ul> <p>Rate limit headers: <pre><code>X-RateLimit-Limit: 100\nX-RateLimit-Remaining: 95\nX-RateLimit-Reset: 1696512000\n</code></pre></p> <p>When rate limited, you'll receive a <code>429 Too Many Requests</code> response.</p>"},{"location":"api/overview/#csrf-protection","title":"CSRF Protection","text":"<p>State-changing endpoints (POST, PUT, DELETE) require a CSRF token:</p> <ol> <li>Get the token from the <code>_csrf</code> cookie (set on first request)</li> <li>Include it in the <code>x-csrf-token</code> header</li> </ol> <pre><code>X-CSRF-Token: your-csrf-token\n</code></pre>"},{"location":"api/overview/#real-time-updates-sse","title":"Real-Time Updates (SSE)","text":"<p>Connect to the SSE endpoint to receive real-time events:</p> <pre><code>const eventSource = new EventSource('/sse?tenantId=default');\n\neventSource.addEventListener('question:created', (event) =&gt; {\n  const question = JSON.parse(event.data);\n  console.log('New question:', question);\n});\n</code></pre> <p>Event Types: - <code>question:created</code> - New question submitted - <code>question:upvoted</code> - Question upvoted - <code>question:answered</code> - Question answered - <code>question:tagged</code> - Tag added to question - <code>question:untagged</code> - Tag removed from question - <code>question:pinned</code> - Question pinned/unpinned - <code>question:frozen</code> - Question frozen/unfrozen - <code>heartbeat</code> - Keep-alive event (every 30s)</p>"},{"location":"api/overview/#pagination","title":"Pagination","text":"<p>List endpoints support pagination via query parameters:</p> <pre><code>GET /questions?limit=20&amp;offset=40\n</code></pre> <ul> <li><code>limit</code>: Number of items per page (default: 100, max: 1000)</li> <li><code>offset</code>: Number of items to skip (default: 0)</li> </ul>"},{"location":"api/overview/#filtering-search","title":"Filtering &amp; Search","text":"<p>The questions endpoint supports advanced filtering:</p> <pre><code>GET /questions?\n  search=mobile+app&amp;\n  status=OPEN&amp;\n  teamId=team-uuid&amp;\n  tags=tag-uuid-1,tag-uuid-2&amp;\n  fromDate=2025-10-01&amp;\n  toDate=2025-10-05\n</code></pre> <p>Parameters: - <code>search</code>: Full-text search (supports prefix matching) - <code>status</code>: <code>OPEN</code> or <code>ANSWERED</code> - <code>teamId</code>: Filter by team - <code>tags</code>: Comma-separated tag IDs - <code>fromDate</code>: ISO date (YYYY-MM-DD) - <code>toDate</code>: ISO date (YYYY-MM-DD) - <code>sort</code>: <code>upvotes</code> (default) or <code>createdAt</code> - <code>order</code>: <code>desc</code> (default) or <code>asc</code></p>"},{"location":"api/overview/#security-headers","title":"Security Headers","text":"<p>All API responses include security headers:</p> <pre><code>Content-Security-Policy: default-src 'self'\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nReferrer-Policy: strict-origin-when-cross-origin\n</code></pre> <p>Learn more about security \u2192</p>"},{"location":"api/overview/#example-requests","title":"Example Requests","text":""},{"location":"api/overview/#submit-a-question","title":"Submit a Question","text":"<pre><code>curl -X POST http://localhost:3000/questions \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-Tenant-ID: default\" \\\n  -H \"X-Mock-SSO-User: user@example.com\" \\\n  -H \"X-CSRF-Token: your-csrf-token\" \\\n  -d '{\n    \"body\": \"What is our remote work policy?\",\n    \"teamId\": \"team-uuid\"\n  }'\n</code></pre>"},{"location":"api/overview/#search-questions","title":"Search Questions","text":"<pre><code>curl \"http://localhost:3000/questions?search=remote&amp;status=OPEN\" \\\n  -H \"X-Tenant-ID: default\" \\\n  -H \"X-Mock-SSO-User: user@example.com\"\n</code></pre>"},{"location":"api/overview/#upvote-a-question","title":"Upvote a Question","text":"<pre><code>curl -X POST http://localhost:3000/questions/{id}/upvote \\\n  -H \"X-Tenant-ID: default\" \\\n  -H \"X-Mock-SSO-User: user@example.com\" \\\n  -H \"X-CSRF-Token: your-csrf-token\"\n</code></pre>"},{"location":"api/overview/#sdk-client-libraries","title":"SDK &amp; Client Libraries","text":"<p>Currently, the web application includes a TypeScript API client (<code>web/src/lib/api.ts</code>) that can be used as a reference for building your own client.</p>"},{"location":"api/overview/#need-help","title":"Need Help?","text":"<ul> <li>Authentication issues: See Authentication</li> <li>Permission errors: See RBAC Documentation</li> <li>Rate limiting: Contact your admin</li> <li>Technical issues: Check our GitHub Issues</li> </ul>"},{"location":"api/overview/#next-steps","title":"Next Steps","text":"<p>Explore the detailed API documentation:</p> <ul> <li>Authentication - Understand SSO and session management</li> <li>Questions API - Submit, search, and manage questions</li> <li>Admin API - Administrative and moderation endpoints</li> <li>Security - Security features and best practices</li> </ul>"},{"location":"api/questions/","title":"Questions","text":"<p>Documentation coming soon...</p>"},{"location":"api/tags/","title":"Tags","text":"<p>Documentation coming soon...</p>"},{"location":"api/teams/","title":"Teams","text":"<p>Documentation coming soon...</p>"},{"location":"api/users/","title":"Users","text":"<p>Documentation coming soon...</p>"},{"location":"architecture/authentication/","title":"Authentication System","text":"<p>PulseStage implements a flexible, multi-mode authentication system designed to support different deployment scenarios: demo environments, self-hosted installations, and production deployments.</p>"},{"location":"architecture/authentication/#overview","title":"Overview","text":"<p>Authentication is required for all users. The authentication system automatically adapts based on <code>NODE_ENV</code>:</p> <p>Development Mode (<code>NODE_ENV=development</code>): - Demo Mode: Auto-enabled with pre-seeded users (<code>alice</code>, <code>bob</code>, <code>moderator</code>, <code>admin</code>) - Users must login via <code>/login</code> to select a demo user - OAuth (Optional): Can be configured for testing OAuth flows locally</p> <p>Production Mode (<code>NODE_ENV=production</code>): - Demo Mode: Disabled - OAuth: GitHub and/or Google OAuth required (users must authenticate to access any page) - Setup Wizard: First-time configuration for organization settings (accessible without auth for initial setup only)</p>"},{"location":"architecture/authentication/#architecture","title":"Architecture","text":""},{"location":"architecture/authentication/#backend-components","title":"Backend Components","text":"<pre><code>api/src/lib/auth/\n\u251c\u2500\u2500 types.ts        # TypeScript interfaces and types\n\u251c\u2500\u2500 demoMode.ts     # Demo mode implementation  \n\u251c\u2500\u2500 oauth.ts        # OAuth 2.0 flows (GitHub, Google)\n\u2514\u2500\u2500 index.ts        # AuthManager (orchestration layer)\n</code></pre>"},{"location":"architecture/authentication/#authmanager","title":"AuthManager","text":"<p>The <code>AuthManager</code> class orchestrates all authentication modes:</p> <pre><code>import { AuthManager } from './lib/auth'\n\nconst authManager = new AuthManager(prisma)\n\n// Check available modes\nconst modes = authManager.getEnabledModes()\n// Returns: ['demo', 'oauth']\n\n// Check if specific mode is enabled\nconst isDemoEnabled = authManager.isModeEnabled('demo')\n\n// Authenticate with demo mode\nconst user = await authManager.authenticateDemo(req, res)\n\n// Handle OAuth callbacks\nconst user = await authManager.handleGitHubCallback(req, res)\nconst user = await authManager.handleGoogleCallback(req, res)\n</code></pre>"},{"location":"architecture/authentication/#frontend-components","title":"Frontend Components","text":"<pre><code>web/src/\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 AuthSelector.tsx      # Landing page auth UI\n\u2502   \u2514\u2500\u2500 DemoModeBanner.tsx    # Banner for demo users\n\u2514\u2500\u2500 pages/\n    \u2514\u2500\u2500 LoginPage.tsx          # Standalone login page\n</code></pre>"},{"location":"architecture/authentication/#authselector","title":"AuthSelector","text":"<p>Responsive authentication UI that: - Auto-detects available auth modes from backend API (<code>/auth/modes</code>) - Displays demo user dropdown if demo mode is enabled - Shows OAuth buttons (GitHub, Google) if configured - Adapts to mobile and desktop layouts - Supports dark mode</p>"},{"location":"architecture/authentication/#demomodebanner","title":"DemoModeBanner","text":"<p>Persistent banner that: - Detects demo users by email domain (<code>@demo.pulsestage.dev</code>) - Displays \"data resets daily\" warning - Encourages upgrade to OAuth for permanent accounts - Dismissible per session</p>"},{"location":"architecture/authentication/#configuration","title":"Configuration","text":""},{"location":"architecture/authentication/#environment-variables","title":"Environment Variables","text":""},{"location":"architecture/authentication/#node_env-controls-auth-mode","title":"NODE_ENV (Controls Auth Mode)","text":"<pre><code># Development mode - Enables demo users with auto-seeding\nNODE_ENV=development\n\n# Production mode - Requires OAuth configuration\nNODE_ENV=production\n</code></pre> <p>Development Mode automatically: - Seeds demo users on startup (<code>alice</code>, <code>bob</code>, <code>moderator</code>, <code>admin</code> @ <code>demo.pulsestage.dev</code>) - Seeds default teams (General, Engineering, Product, People) - Seeds default tags - Enables <code>/auth/demo</code> endpoint for instant login - Disables OAuth requirement (but can be configured for testing)</p> <p>Production Mode requires: - OAuth configuration (GitHub and/or Google) - Setup wizard for first-time configuration - No demo users or auto-seeding</p>"},{"location":"architecture/authentication/#github-oauth","title":"GitHub OAuth","text":"<p>Setup Steps:</p> <ol> <li>Create a GitHub OAuth App:</li> <li>Go to GitHub Developer Settings</li> <li>Click \"New OAuth App\"</li> <li>Fill in:<ul> <li>Application name: PulseStage (Your Org)</li> <li>Homepage URL: <code>https://your-domain.com</code></li> <li>Authorization callback URL: <code>https://your-domain.com/api/auth/github/callback</code></li> </ul> </li> <li>Click \"Register application\"</li> <li> <p>Copy Client ID and Client Secret</p> </li> <li> <p>Configure environment variables:</p> </li> </ol> <pre><code># .env\nGITHUB_CLIENT_ID=your_client_id_here\nGITHUB_CLIENT_SECRET=your_client_secret_here\nGITHUB_CALLBACK_URL=https://your-domain.com/api/auth/github/callback\n\n# Frontend URL (for redirects after auth)\nFRONTEND_URL=https://your-domain.com\n</code></pre>"},{"location":"architecture/authentication/#google-oauth","title":"Google OAuth","text":"<p>Setup Steps:</p> <ol> <li>Create Google OAuth credentials:</li> <li>Go to Google Cloud Console</li> <li>Create a new project or select existing</li> <li>Navigate to APIs &amp; Services \u2192 Credentials</li> <li>Click Create Credentials \u2192 OAuth client ID</li> <li>Application type: Web application</li> <li>Add authorized redirect URI: <code>https://your-domain.com/api/auth/google/callback</code></li> <li> <p>Copy Client ID and Client Secret</p> </li> <li> <p>Configure environment variables:</p> </li> </ol> <pre><code># .env\nGOOGLE_CLIENT_ID=your_client_id_here.apps.googleusercontent.com\nGOOGLE_CLIENT_SECRET=your_client_secret_here\nGOOGLE_CALLBACK_URL=https://your-domain.com/api/auth/google/callback\n\n# Frontend URL (for redirects after auth)\nFRONTEND_URL=https://your-domain.com\n</code></pre>"},{"location":"architecture/authentication/#multi-mode-configuration","title":"Multi-Mode Configuration","text":"<p>You can enable multiple auth modes simultaneously:</p> <pre><code># .env - Production Example\n# Demo mode disabled for production\nAUTH_MODE_DEMO=false\n\n# GitHub OAuth for public-facing instance\nGITHUB_CLIENT_ID=...\nGITHUB_CLIENT_SECRET=...\nGITHUB_CALLBACK_URL=https://app.example.com/api/auth/github/callback\n\n# Google OAuth for enterprise SSO\nGOOGLE_CLIENT_ID=...\nGOOGLE_CLIENT_SECRET=...\nGOOGLE_CALLBACK_URL=https://app.example.com/api/auth/google/callback\n\nFRONTEND_URL=https://app.example.com\n</code></pre> <pre><code># .env - Self-Hosted Example\n# Enable demo mode for quick testing\n# (Demo users use @demo.pulsestage.dev emails)\n\n# GitHub OAuth for real users\nGITHUB_CLIENT_ID=...\nGITHUB_CLIENT_SECRET=...\nGITHUB_CALLBACK_URL=http://localhost:3000/api/auth/github/callback\n\nFRONTEND_URL=http://localhost:5173\n</code></pre>"},{"location":"architecture/authentication/#api-endpoints","title":"API Endpoints","text":""},{"location":"architecture/authentication/#authentication-modes-endpoint","title":"Authentication Modes Endpoint","text":"<p>GET /auth/modes</p> <p>Returns available authentication modes and configuration:</p> <pre><code>{\n  \"modes\": [\"demo\", \"oauth\"],\n  \"demo\": {\n    \"enabled\": true,\n    \"users\": [\"alice\", \"bob\", \"moderator\", \"admin\"]\n  },\n  \"oauth\": {\n    \"github\": true,\n    \"google\": false\n  }\n}\n</code></pre>"},{"location":"architecture/authentication/#demo-mode-endpoints","title":"Demo Mode Endpoints","text":"<p>GET /auth/demo</p> <p>Auto-login with demo user:</p> <p>Query Parameters: - <code>user</code> (required): Demo user identifier (<code>alice</code>, <code>bob</code>, <code>moderator</code>, <code>admin</code>) - <code>tenant</code> (optional): Tenant slug (defaults to <code>demo</code>)</p> <pre><code>curl \"http://localhost:3000/auth/demo?user=alice&amp;tenant=demo\"\n</code></pre> <p>Response: Redirects to <code>FRONTEND_URL</code> with session cookie</p>"},{"location":"architecture/authentication/#oauth-endpoints","title":"OAuth Endpoints","text":"<p>GET /auth/github</p> <p>Initiates GitHub OAuth flow:</p> <pre><code># Browser navigates to:\nhttps://your-domain.com/api/auth/github\n</code></pre> <p>Response: Redirects to GitHub authorization page</p> <p>GET /auth/github/callback</p> <p>Handles GitHub OAuth callback:</p> <pre><code># GitHub redirects to:\nhttps://your-domain.com/api/auth/github/callback?code=...&amp;state=...\n</code></pre> <p>Response: Redirects to <code>FRONTEND_URL</code> with session cookie</p> <p>GET /auth/google</p> <p>Initiates Google OAuth flow:</p> <pre><code># Browser navigates to:\nhttps://your-domain.com/api/auth/google\n</code></pre> <p>Response: Redirects to Google authorization page</p> <p>GET /auth/google/callback</p> <p>Handles Google OAuth callback:</p> <pre><code># Google redirects to:\nhttps://your-domain.com/api/auth/google/callback?code=...&amp;state=...\n</code></pre> <p>Response: Redirects to <code>FRONTEND_URL</code> with session cookie</p>"},{"location":"architecture/authentication/#session-management","title":"Session Management","text":"<p>Sessions are stored in Express session with the following structure:</p> <pre><code>req.session.user = {\n  id: string           // User UUID\n  email: string        // User email  \n  name: string         // Display name\n}\n\nreq.session.tenantSlug = string  // Current tenant context\n</code></pre>"},{"location":"architecture/authentication/#security-considerations","title":"Security Considerations","text":""},{"location":"architecture/authentication/#oauth-security","title":"OAuth Security","text":"<ol> <li>State Parameter: CSRF protection via random state tokens</li> <li>HTTPS Only: OAuth callbacks must use HTTPS in production</li> <li>Redirect URI Validation: Exact match required by OAuth providers</li> <li>Token Storage: Access tokens are not persisted (only used during auth flow)</li> </ol>"},{"location":"architecture/authentication/#session-security","title":"Session Security","text":"<p>Sessions are configured with secure defaults:</p> <pre><code>{\n  secret: process.env.SESSION_SECRET,  // Strong random secret required\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: process.env.NODE_ENV === 'production',  // HTTPS only in prod\n    httpOnly: true,                                  // No JavaScript access\n    sameSite: 'lax',                                 // CSRF protection\n    maxAge: 30 * 24 * 60 * 60 * 1000                // 30 days\n  }\n}\n</code></pre>"},{"location":"architecture/authentication/#demo-mode-security","title":"Demo Mode Security","text":"<p>\u26a0\ufe0f Demo mode is automatically disabled in production!</p> <p>When <code>NODE_ENV=production</code>, demo mode is disabled and OAuth is required. Demo mode only activates in development environments:</p> <pre><code># Development - demo mode enabled\nNODE_ENV=development\n\n# Production - demo mode disabled, OAuth required\nNODE_ENV=production\nGITHUB_CLIENT_ID=...\nGITHUB_CLIENT_SECRET=...\n</code></pre> <p>Demo mode is safe for: - Local development (<code>NODE_ENV=development</code>) - CI/CD testing environments - Public-facing demos (with ephemeral data)</p>"},{"location":"architecture/authentication/#user-experience","title":"User Experience","text":""},{"location":"architecture/authentication/#first-time-login-flow","title":"First-Time Login Flow","text":"<ol> <li>User visits application</li> <li>AuthSelector component detects available auth modes</li> <li>User chooses auth method:</li> <li>Demo: Select demo user from dropdown \u2192 instant access</li> <li>GitHub: Click \"Sign in with GitHub\" \u2192 OAuth flow \u2192 redirect back</li> <li>Google: Click \"Sign in with Google\" \u2192 OAuth flow \u2192 redirect back</li> <li>Session is created with user context</li> <li>User is redirected to application home page</li> </ol>"},{"location":"architecture/authentication/#demo-user-experience","title":"Demo User Experience","text":"<p>Demo users see a persistent banner on all pages:</p> <pre><code>\u2139\ufe0f  You're in demo mode. Data resets daily.\n    [Sign up to save your work]  [\u2715]\n</code></pre> <p>Banner characteristics: - Gradient blue background for visibility - Call-to-action button links to GitHub OAuth - Dismissible per session (not persisted) - Detects demo users by email domain</p>"},{"location":"architecture/authentication/#oauth-error-handling","title":"OAuth Error Handling","text":"<p>If OAuth fails, users are redirected to <code>/login?error=&lt;message&gt;</code>:</p> <pre><code>// Example error scenarios:\n- Missing authorization code\n- Invalid state parameter\n- OAuth provider API error\n- User account creation failure\n</code></pre> <p>The <code>LoginPage</code> component displays error messages in a prominent alert banner.</p>"},{"location":"architecture/authentication/#testing","title":"Testing","text":""},{"location":"architecture/authentication/#manual-testing-local-development","title":"Manual Testing (Local Development)","text":"<ol> <li> <p>Demo Mode:    <pre><code># Visit login page\nhttp://localhost:5173/login\n\n# Select demo user and click \"Continue\"\n# Should redirect to home page with demo banner\n</code></pre></p> </li> <li> <p>GitHub OAuth:    <pre><code># Set environment variables\nGITHUB_CLIENT_ID=...\nGITHUB_CLIENT_SECRET=...\nGITHUB_CALLBACK_URL=http://localhost:3000/api/auth/github/callback\nFRONTEND_URL=http://localhost:5173\n\n# Visit login page and click \"Sign in with GitHub\"\n# Complete OAuth flow on GitHub\n# Should redirect back to http://localhost:5173\n</code></pre></p> </li> <li> <p>Google OAuth (similar to GitHub):    <pre><code>GOOGLE_CLIENT_ID=...\nGOOGLE_CLIENT_SECRET=...\nGOOGLE_CALLBACK_URL=http://localhost:3000/api/auth/google/callback\nFRONTEND_URL=http://localhost:5173\n</code></pre></p> </li> </ol>"},{"location":"architecture/authentication/#automated-testing","title":"Automated Testing","text":"<p>Unit tests for authentication flows are located in: - <code>api/src/lib/auth/demoMode.test.ts</code> - <code>api/src/lib/auth/oauth.test.ts</code> - <code>api/src/lib/auth/index.test.ts</code></p> <p>Run tests:</p> <pre><code>cd api\nnpm test -- auth\n</code></pre>"},{"location":"architecture/authentication/#deployment","title":"Deployment","text":""},{"location":"architecture/authentication/#self-hosted-docker-compose","title":"Self-Hosted (Docker Compose)","text":"<ol> <li> <p>Copy <code>env.example</code> to <code>.env</code>:    <pre><code>cp env.example .env\n</code></pre></p> </li> <li> <p>Configure OAuth credentials in <code>.env</code></p> </li> <li> <p>Start services:    <pre><code>docker-compose up -d\n</code></pre></p> </li> <li> <p>Visit <code>http://localhost:5173</code> to verify login page</p> </li> </ol>"},{"location":"architecture/authentication/#cloud-deployment-render-heroku-etc","title":"Cloud Deployment (Render, Heroku, etc.)","text":"<ol> <li>Set environment variables in platform dashboard:</li> <li><code>GITHUB_CLIENT_ID</code></li> <li><code>GITHUB_CLIENT_SECRET</code></li> <li><code>GITHUB_CALLBACK_URL</code> (use your production domain)</li> <li><code>GOOGLE_CLIENT_ID</code> (optional)</li> <li><code>GOOGLE_CLIENT_SECRET</code> (optional)</li> <li><code>GOOGLE_CALLBACK_URL</code> (optional)</li> <li><code>FRONTEND_URL</code> (your production frontend URL)</li> <li> <p><code>SESSION_SECRET</code> (generate with <code>openssl rand -hex 32</code>)</p> </li> <li> <p>Deploy application</p> </li> <li> <p>Update OAuth app settings:</p> </li> <li>GitHub: Update callback URL to production domain</li> <li> <p>Google: Add production domain to authorized redirect URIs</p> </li> <li> <p>Test login flow on production domain</p> </li> </ol>"},{"location":"architecture/authentication/#https-requirement","title":"HTTPS Requirement","text":"<p>OAuth flows require HTTPS in production. Ensure your deployment has: - Valid TLS/SSL certificate - HTTPS redirect for HTTP traffic - Secure cookie flag enabled (<code>secure: true</code>)</p> <p>For local development, OAuth providers typically allow <code>http://localhost</code> callbacks.</p>"},{"location":"architecture/authentication/#troubleshooting","title":"Troubleshooting","text":""},{"location":"architecture/authentication/#oauth-state-mismatch-error","title":"\"OAuth state mismatch\" Error","text":"<p>Cause: Session not persisting between OAuth initiation and callback</p> <p>Solutions: 1. Verify <code>SESSION_SECRET</code> is set 2. Check session store is configured (Redis recommended for production) 3. Ensure cookies are being set (check browser dev tools) 4. Verify <code>sameSite</code> cookie setting is compatible with OAuth flow</p>"},{"location":"architecture/authentication/#githubgoogle-oauth-callback-error","title":"\"GitHub/Google OAuth callback error\"","text":"<p>Cause: Misconfigured callback URL</p> <p>Solutions: 1. Verify <code>*_CALLBACK_URL</code> matches OAuth app settings exactly 2. Check for typos (http vs https, trailing slash, etc.) 3. Ensure domain is accessible from OAuth provider 4. Check OAuth app is not restricted to specific organization</p>"},{"location":"architecture/authentication/#demo-user-not-found","title":"\"Demo user not found\"","text":"<p>Cause: Database not seeded with demo users</p> <p>Solutions: 1. Run seed script: <code>npm run seed:test-users</code> 2. Verify <code>.env</code> has correct <code>DATABASE_URL</code> 3. Check database is running and accessible</p>"},{"location":"architecture/authentication/#cannot-read-properties-of-undefined-useremail","title":"\"Cannot read properties of undefined (user.email)\"","text":"<p>Cause: Session not established or user not authenticated</p> <p>Solutions: 1. Verify OAuth flow completes successfully 2. Check session middleware is configured 3. Ensure user is created in database after OAuth 4. Check for errors in OAuth callback handler</p>"},{"location":"architecture/authentication/#testing_1","title":"Testing","text":""},{"location":"architecture/authentication/#mock-sso-test-only","title":"Mock SSO (Test-Only)","text":"<p>Mock SSO is a test-only authentication mechanism used by automated tests. It is not intended for user-facing development.</p> <p>For Testing (via <code>x-mock-sso-user</code> header): <pre><code>// In API tests\nconst response = await request(app)\n  .post('/questions')\n  .set('x-mock-sso-user', 'alice@demo.pulsestage.dev')\n  .send({ body: 'Test question' })\n</code></pre></p> <p>Security Safeguards: - \u2705 Only enabled in <code>development</code> and <code>test</code> environments - \u2705 Explicitly rejected in production with 403 error - \u2705 Requires <code>x-mock-sso-user</code> header (not user-facing)</p> <p>For Local Development: Use Demo Mode (<code>/auth/demo</code>) instead of Mock SSO. It provides a user-friendly login page with pre-seeded users.</p>"},{"location":"architecture/authentication/#migration-guide","title":"Migration Guide","text":""},{"location":"architecture/authentication/#from-demo-mode-to-production-oauth","title":"From Demo Mode to Production OAuth","text":"<p>When moving from demo to production:</p> <ol> <li> <p>Set environment to production (disables demo mode automatically):    <pre><code># .env\nNODE_ENV=production\n</code></pre></p> </li> <li> <p>Configure OAuth (required in production):    <pre><code># GitHub OAuth\nGITHUB_CLIENT_ID=your_github_client_id\nGITHUB_CLIENT_SECRET=your_github_client_secret\n\n# and/or Google OAuth\nGOOGLE_CLIENT_ID=your_google_client_id\nGOOGLE_CLIENT_SECRET=your_google_client_secret\n</code></pre></p> </li> <li> <p>Generate secure secrets:    <pre><code>cd api &amp;&amp; npm run generate-secrets\n</code></pre></p> </li> <li> <p>Update documentation for users</p> </li> <li>Communicate migration timeline if existing demo users need to create real accounts</li> </ol>"},{"location":"architecture/authentication/#best-practices","title":"Best Practices","text":"<ol> <li>Use OAuth for production: More secure than password-based auth (automatically enforced via <code>NODE_ENV</code>)</li> <li>Demo mode auto-disabled in production: Setting <code>NODE_ENV=production</code> automatically disables demo mode</li> <li>Generate strong secrets: Run <code>npm run generate-secrets</code> for production deployments</li> <li>Rotate session secrets: Change <code>SESSION_SECRET</code> periodically</li> <li>Monitor auth failures: Log OAuth errors for debugging</li> <li>Mock SSO is test-only: Never use <code>x-mock-sso-user</code> header outside of automated tests</li> <li>Test callback URLs: Verify exact match with OAuth provider settings</li> <li>Use HTTPS: Required for OAuth, improves security overall</li> <li>Implement rate limiting: Protect against brute force on auth endpoints (already implemented)</li> <li>Add MFA (future): Consider multi-factor authentication for sensitive deployments</li> </ol>"},{"location":"architecture/authentication/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> SAML/Enterprise SSO support</li> <li> Multi-factor authentication (MFA)</li> <li> Magic link authentication (passwordless)</li> <li> Social auth providers (Microsoft, LinkedIn, etc.)</li> <li> API key authentication for programmatic access</li> <li> JWT tokens for stateless authentication</li> <li> Role-based access control (RBAC) integration with OAuth</li> </ul>"},{"location":"architecture/authentication/#related-documentation","title":"Related Documentation","text":"<ul> <li>Session Management</li> <li>Security Overview</li> <li>RBAC &amp; Permissions</li> <li>Deployment Guide</li> </ul>"},{"location":"architecture/database-schema/","title":"Database Schema","text":"<p>This document provides a comprehensive overview of PulseStage's PostgreSQL database schema, relationships, and design decisions.</p>"},{"location":"architecture/database-schema/#entity-relationship-diagram-erd","title":"Entity Relationship Diagram (ERD)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Tenant    \u2502 (Organization)\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 id (PK)      \u2502\n\u2502 slug (UQ)    \u2502\n\u2502 name         \u2502\n\u2502 createdAt    \u2502\n\u2502 updatedAt    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502 1:N relationships\n       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502                        \u2502                         \u2502\n       \u25bc                        \u25bc                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Team     \u2502      \u2502   Question     \u2502      \u2502      Tag         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524      \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524      \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 id (PK)     \u2502      \u2502 id (PK)        \u2502      \u2502 id (PK)          \u2502\n\u2502 tenantId(FK)\u2502\u25c4\u2500\u2510   \u2502 tenantId (FK)  \u2502      \u2502 tenantId (FK)    \u2502\n\u2502 name        \u2502  \u2502   \u2502 body           \u2502      \u2502 name (UQ)        \u2502\n\u2502 slug (UQ)   \u2502  \u2502   \u2502 upvotes        \u2502      \u2502 description      \u2502\n\u2502 description \u2502  \u2502   \u2502 status         \u2502      \u2502 color            \u2502\n\u2502 isActive    \u2502  \u2502   \u2502 responseText   \u2502\u25c4\u2500\u2500\u2510  \u2502 createdAt        \u2502\n\u2502 createdAt   \u2502  \u2502   \u2502 respondedAt    \u2502   \u2502  \u2502 updatedAt        \u2502\n\u2502 updatedAt   \u2502  \u2502   \u2502 teamId (FK)    \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502 authorId (FK)  \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 isPinned       \u2502   \u2502           \u2502\n      \u2502 1:N      \u2502   \u2502 pinnedBy       \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 pinnedAt       \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 isFrozen       \u2502   \u2502           \u2502 N:M (via QuestionTag)\n      \u2502          \u2502   \u2502 frozenBy       \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 frozenAt       \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 reviewedBy     \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 reviewedAt     \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 createdAt      \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2502 updatedAt      \u2502   \u2502           \u2502\n      \u2502          \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502           \u2502\n      \u2502          \u2502            \u2502           \u2502           \u2502\n      \u2502          \u2502            \u2502 1:N       \u2502           \u2502\n      \u2502          \u2502            \u2502           \u2502           \u2502\n      \u25bc          \u2502            \u25bc           \u2502           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  User        \u2502\u2502   \u2502  Upvote        \u2502   \u2502  \u2502  QuestionTag     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u2502   \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 id (PK)      \u2502\u2502   \u2502 id (PK)        \u2502   \u2502  \u2502 id (PK)          \u2502\n\u2502 tenantId(FK) \u2502\u2502   \u2502 questionId(FK) \u2502\u2500\u2500\u2500\u2518  \u2502 questionId (FK)  \u2502\u2500\u2500\u2500\u2510\n\u2502 email (UQ)   \u2502\u2502   \u2502 userId (FK)    \u2502      \u2502 tagId (FK)       \u2502\u2500\u2500\u2500\u2524\n\u2502 name         \u2502\u2502   \u2502 createdAt      \u2502      \u2502 createdAt        \u2502   \u2502\n\u2502 ssoId (UQ)   \u2502\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502 createdAt    \u2502\u2502            \u2502                        \u2502             \u2502\n\u2502 updatedAt    \u2502\u2502            \u2502                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502            \u2502                                      \u2502\n       \u2502        \u2502            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n       \u2502 1:N    \u2502                                       \u2502           \u2502\n       \u2502        \u2502                                       \u2502           \u2502\n       \u25bc        \u2502                                       \u2502           \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502                                       \u2502           \u2502\n\u2502TeamMembership\u2502\u2502                                       \u2502           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u2502                                       \u2502           \u2502\n\u2502 id (PK)      \u2502\u2502                                       \u2502           \u2502\n\u2502 userId (FK)  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502 teamId (FK)  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502 role         \u2502\n\u2502 createdAt    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UserPreferences  \u2502        \u2502   AuditLog       \u2502        \u2502 TenantSettings   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524        \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524        \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 id (PK)          \u2502        \u2502 id (PK)          \u2502        \u2502 id (PK)          \u2502\n\u2502 tenantId (FK)    \u2502        \u2502 tenantId (FK)    \u2502        \u2502 tenantId (FK,UQ) \u2502\n\u2502 userId (FK,UQ)   \u2502        \u2502 userId (FK)      \u2502        \u2502 settings (JSON)  \u2502\n\u2502 favoriteTeams    \u2502        \u2502 action           \u2502        \u2502 createdAt        \u2502\n\u2502 defaultTeamId(FK)\u2502        \u2502 entityType       \u2502        \u2502 updatedAt        \u2502\n\u2502 createdAt        \u2502        \u2502 entityId         \u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502 updatedAt        \u2502        \u2502 before (JSON)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502 after (JSON)     \u2502\n                            \u2502 ipAddress        \u2502\n                            \u2502 userAgent        \u2502\n                            \u2502 metadata (JSON)  \u2502\n                            \u2502 createdAt        \u2502\n                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/database-schema/#core-tables","title":"Core Tables","text":""},{"location":"architecture/database-schema/#tenant","title":"Tenant","text":"<p>The root of the multi-tenant hierarchy. Every data entity belongs to a tenant.</p> <pre><code>CREATE TABLE \"Tenant\" (\n    \"id\"        TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"slug\"      TEXT NOT NULL UNIQUE,\n    \"name\"      TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\" TIMESTAMP DEFAULT NOW()\n);\n</code></pre> <p>Relationships: - One-to-many with: Team, Question, Tag, User, AuditLog - One-to-one with: TenantSettings</p> <p>Key Fields: - <code>slug</code>: URL-safe identifier (e.g., \"acme\", \"default\") - <code>name</code>: Display name (e.g., \"Acme Corp\")</p> <p>Indexes: - Primary key on <code>id</code> - Unique constraint on <code>slug</code></p>"},{"location":"architecture/database-schema/#team","title":"Team","text":"<p>Organizational units within a tenant (e.g., Engineering, Product, Marketing).</p> <pre><code>CREATE TABLE \"Team\" (\n    \"id\"          TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"    TEXT NOT NULL REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"name\"        TEXT NOT NULL,\n    \"slug\"        TEXT NOT NULL,\n    \"description\" TEXT,\n    \"isActive\"    BOOLEAN DEFAULT true,\n    \"createdAt\"   TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\"   TIMESTAMP DEFAULT NOW(),\n\n    CONSTRAINT \"Team_tenantId_slug_unique\" UNIQUE (\"tenantId\", \"slug\")\n);\n\nCREATE INDEX \"Team_tenantId_idx\" ON \"Team\"(\"tenantId\");\n</code></pre> <p>Relationships: - Belongs to: Tenant - Has many: Questions, TeamMemberships, UserPreferences</p> <p>Key Fields: - <code>slug</code>: URL-safe team identifier (unique per tenant) - <code>isActive</code>: Soft delete / archive teams</p> <p>Indexes: - Composite unique: <code>(tenantId, slug)</code> - Index on <code>tenantId</code> for queries</p>"},{"location":"architecture/database-schema/#question","title":"Question","text":"<p>User-submitted questions with voting, answers, and moderation features.</p> <pre><code>CREATE TABLE \"Question\" (\n    \"id\"           TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"     TEXT NOT NULL REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"body\"         TEXT NOT NULL,\n    \"upvotes\"      INTEGER DEFAULT 0,\n    \"status\"       TEXT NOT NULL DEFAULT 'OPEN',\n    \"responseText\" TEXT,\n    \"respondedAt\"  TIMESTAMP,\n    \"createdAt\"    TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\"    TIMESTAMP DEFAULT NOW(),\n    \"teamId\"       TEXT REFERENCES \"Team\"(\"id\") ON DELETE SET NULL,\n    \"authorId\"     TEXT REFERENCES \"User\"(\"id\") ON DELETE SET NULL,\n\n    -- Moderation fields\n    \"isPinned\"     BOOLEAN DEFAULT false,\n    \"pinnedBy\"     TEXT,\n    \"pinnedAt\"     TIMESTAMP,\n    \"isFrozen\"     BOOLEAN DEFAULT false,\n    \"frozenBy\"     TEXT,\n    \"frozenAt\"     TIMESTAMP,\n    \"reviewedBy\"   TEXT,\n    \"reviewedAt\"   TIMESTAMP,\n\n    CONSTRAINT \"Question_status_check\" CHECK (\"status\" IN ('OPEN', 'ANSWERED'))\n);\n\nCREATE INDEX \"Question_tenantId_idx\" ON \"Question\"(\"tenantId\");\nCREATE INDEX \"Question_tenantId_status_idx\" ON \"Question\"(\"tenantId\", \"status\");\nCREATE INDEX \"Question_tenantId_teamId_idx\" ON \"Question\"(\"tenantId\", \"teamId\");\nCREATE INDEX \"Question_isPinned_idx\" ON \"Question\"(\"isPinned\");\nCREATE INDEX \"Question_reviewedBy_idx\" ON \"Question\"(\"reviewedBy\");\n</code></pre> <p>Relationships: - Belongs to: Tenant, Team (optional), User (author, optional) - Has many: QuestionTags, Upvotes</p> <p>Key Fields: - <code>status</code>: Enum of <code>OPEN</code> or <code>ANSWERED</code> - <code>upvotes</code>: Cached count (source of truth is <code>Upvote</code> records) - <code>isPinned</code>, <code>isFrozen</code>: Moderation flags - <code>reviewedBy</code>: Last moderator who reviewed</p> <p>Indexes: - Composite: <code>(tenantId, status)</code> for filtered queries - Composite: <code>(tenantId, teamId)</code> for team-specific views - Single: <code>isPinned</code> for quick pinned question queries</p> <p>Full-Text Search: - <code>search_vector</code> column (tsvector, managed by PostgreSQL trigger) - GIN index on <code>search_vector</code> for fast text search</p>"},{"location":"architecture/database-schema/#tag","title":"Tag","text":"<p>Categorization and labeling system for questions.</p> <pre><code>CREATE TABLE \"Tag\" (\n    \"id\"          TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"    TEXT NOT NULL REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"name\"        TEXT NOT NULL,\n    \"description\" TEXT,\n    \"color\"       TEXT DEFAULT '#3B82F6',\n    \"createdAt\"   TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\"   TIMESTAMP DEFAULT NOW(),\n\n    CONSTRAINT \"Tag_tenantId_name_unique\" UNIQUE (\"tenantId\", \"name\")\n);\n\nCREATE INDEX \"Tag_tenantId_idx\" ON \"Tag\"(\"tenantId\");\n</code></pre> <p>Relationships: - Belongs to: Tenant - Many-to-many with: Questions (via QuestionTag)</p> <p>Key Fields: - <code>name</code>: Unique per tenant - <code>color</code>: Hex color code for UI display</p> <p>Indexes: - Composite unique: <code>(tenantId, name)</code></p>"},{"location":"architecture/database-schema/#questiontag","title":"QuestionTag","text":"<p>Junction table for many-to-many relationship between Questions and Tags.</p> <pre><code>CREATE TABLE \"QuestionTag\" (\n    \"id\"         TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"questionId\" TEXT NOT NULL REFERENCES \"Question\"(\"id\") ON DELETE CASCADE,\n    \"tagId\"      TEXT NOT NULL REFERENCES \"Tag\"(\"id\") ON DELETE CASCADE,\n    \"createdAt\"  TIMESTAMP DEFAULT NOW(),\n\n    CONSTRAINT \"QuestionTag_questionId_tagId_unique\" UNIQUE (\"questionId\", \"tagId\")\n);\n</code></pre> <p>Relationships: - Belongs to: Question, Tag</p> <p>Indexes: - Composite unique: <code>(questionId, tagId)</code> prevents duplicate tags</p>"},{"location":"architecture/database-schema/#user","title":"User","text":"<p>User accounts linked to SSO providers.</p> <pre><code>CREATE TABLE \"User\" (\n    \"id\"        TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"  TEXT NOT NULL REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"email\"     TEXT NOT NULL,\n    \"name\"      TEXT,\n    \"ssoId\"     TEXT,\n    \"createdAt\" TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\" TIMESTAMP DEFAULT NOW(),\n\n    CONSTRAINT \"User_tenantId_email_unique\" UNIQUE (\"tenantId\", \"email\"),\n    CONSTRAINT \"User_tenantId_ssoId_unique\" UNIQUE (\"tenantId\", \"ssoId\")\n);\n\nCREATE INDEX \"User_tenantId_idx\" ON \"User\"(\"tenantId\");\n</code></pre> <p>Relationships: - Belongs to: Tenant - Has many: TeamMemberships, Questions (authored), Upvotes, AuditLogs - Has one: UserPreferences</p> <p>Key Fields: - <code>email</code>: Unique per tenant - <code>ssoId</code>: External SSO provider user ID (unique per tenant)</p> <p>Indexes: - Composite unique: <code>(tenantId, email)</code> - Composite unique: <code>(tenantId, ssoId)</code></p>"},{"location":"architecture/database-schema/#teammembership","title":"TeamMembership","text":"<p>User roles and permissions within teams.</p> <pre><code>CREATE TABLE \"TeamMembership\" (\n    \"id\"        TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"userId\"    TEXT NOT NULL REFERENCES \"User\"(\"id\") ON DELETE CASCADE,\n    \"teamId\"    TEXT NOT NULL REFERENCES \"Team\"(\"id\") ON DELETE CASCADE,\n    \"role\"      TEXT DEFAULT 'member',\n    \"createdAt\" TIMESTAMP DEFAULT NOW(),\n\n    CONSTRAINT \"TeamMembership_userId_teamId_unique\" UNIQUE (\"userId\", \"teamId\")\n);\n</code></pre> <p>Relationships: - Belongs to: User, Team</p> <p>Key Fields: - <code>role</code>: One of: <code>viewer</code>, <code>member</code>, <code>moderator</code>, <code>admin</code>, <code>owner</code></p> <p>Indexes: - Composite unique: <code>(userId, teamId)</code> ensures one role per team</p>"},{"location":"architecture/database-schema/#userpreferences","title":"UserPreferences","text":"<p>User-specific settings and preferences.</p> <pre><code>CREATE TABLE \"UserPreferences\" (\n    \"id\"            TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"      TEXT NOT NULL REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"userId\"        TEXT NOT NULL UNIQUE REFERENCES \"User\"(\"id\") ON DELETE CASCADE,\n    \"favoriteTeams\" JSONB DEFAULT '[]',\n    \"defaultTeamId\" TEXT REFERENCES \"Team\"(\"id\") ON DELETE SET NULL,\n    \"createdAt\"     TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\"     TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX \"UserPreferences_tenantId_idx\" ON \"UserPreferences\"(\"tenantId\");\n</code></pre> <p>Relationships: - Belongs to: Tenant, User (one-to-one), Team (default team, optional)</p> <p>Key Fields: - <code>favoriteTeams</code>: JSON array of team slugs - <code>defaultTeamId</code>: Team to show by default</p>"},{"location":"architecture/database-schema/#upvote","title":"Upvote","text":"<p>Individual upvote tracking (not just counters).</p> <pre><code>CREATE TABLE \"Upvote\" (\n    \"id\"         TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"questionId\" TEXT NOT NULL REFERENCES \"Question\"(\"id\") ON DELETE CASCADE,\n    \"userId\"     TEXT REFERENCES \"User\"(\"id\") ON DELETE SET NULL,\n    \"createdAt\"  TIMESTAMP DEFAULT NOW(),\n\n    CONSTRAINT \"Upvote_questionId_userId_unique\" UNIQUE (\"questionId\", \"userId\")\n);\n\nCREATE INDEX \"Upvote_questionId_idx\" ON \"Upvote\"(\"questionId\");\n</code></pre> <p>Relationships: - Belongs to: Question, User (optional)</p> <p>Key Fields: - <code>userId</code>: Nullable to support anonymous upvotes (future feature)</p> <p>Indexes: - Composite unique: <code>(questionId, userId)</code> prevents duplicate upvotes - Index on <code>questionId</code> for counting votes</p>"},{"location":"architecture/database-schema/#auditlog","title":"AuditLog","text":"<p>Immutable audit trail of all administrative actions.</p> <pre><code>CREATE TABLE \"AuditLog\" (\n    \"id\"         TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"   TEXT NOT NULL REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"userId\"     TEXT REFERENCES \"User\"(\"id\") ON DELETE SET NULL,\n    \"action\"     TEXT NOT NULL,\n    \"entityType\" TEXT NOT NULL,\n    \"entityId\"   TEXT,\n    \"before\"     JSONB,\n    \"after\"      JSONB,\n    \"ipAddress\"  TEXT,\n    \"userAgent\"  TEXT,\n    \"metadata\"   JSONB,\n    \"createdAt\"  TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX \"AuditLog_tenantId_createdAt_idx\" ON \"AuditLog\"(\"tenantId\", \"createdAt\" DESC);\nCREATE INDEX \"AuditLog_tenantId_userId_idx\" ON \"AuditLog\"(\"tenantId\", \"userId\");\nCREATE INDEX \"AuditLog_tenantId_action_idx\" ON \"AuditLog\"(\"tenantId\", \"action\");\nCREATE INDEX \"AuditLog_tenantId_entityType_entityId_idx\" ON \"AuditLog\"(\"tenantId\", \"entityType\", \"entityId\");\n</code></pre> <p>Relationships: - Belongs to: Tenant, User (actor, optional)</p> <p>Key Fields: - <code>action</code>: Action performed (e.g., \"question.answer\", \"team.create\") - <code>entityType</code>: Type of entity affected - <code>before</code>, <code>after</code>: State before/after (JSON) - <code>metadata</code>: Additional context (JSON)</p> <p>Indexes: - Composite: <code>(tenantId, createdAt DESC)</code> for recent logs - Composite: <code>(tenantId, userId)</code> for per-user audit trails - Composite: <code>(tenantId, entityType, entityId)</code> for entity history</p>"},{"location":"architecture/database-schema/#tenantsettings","title":"TenantSettings","text":"<p>Per-tenant configuration stored as JSON.</p> <pre><code>CREATE TABLE \"TenantSettings\" (\n    \"id\"        TEXT PRIMARY KEY DEFAULT gen_random_uuid()::text,\n    \"tenantId\"  TEXT NOT NULL UNIQUE REFERENCES \"Tenant\"(\"id\") ON DELETE CASCADE,\n    \"settings\"  JSONB DEFAULT '{}',\n    \"createdAt\" TIMESTAMP DEFAULT NOW(),\n    \"updatedAt\" TIMESTAMP DEFAULT NOW()\n);\n\nCREATE INDEX \"TenantSettings_tenantId_idx\" ON \"TenantSettings\"(\"tenantId\");\n</code></pre> <p>Relationships: - Belongs to: Tenant (one-to-one)</p> <p>Key Fields: - <code>settings</code>: JSON object with per-tenant configuration</p>"},{"location":"architecture/database-schema/#data-types","title":"Data Types","text":""},{"location":"architecture/database-schema/#enums","title":"Enums","text":"<p>QuestionStatus: - <code>OPEN</code> - Question has not been answered - <code>ANSWERED</code> - Question has been answered by a moderator</p> <p>UserRole (not in database, enforced in application): - <code>viewer</code> - Read-only access - <code>member</code> - Can submit and upvote - <code>moderator</code> - Can answer, tag, pin, freeze (team-scoped) - <code>admin</code> - Full access (global) - <code>owner</code> - Complete control (global)</p>"},{"location":"architecture/database-schema/#uuids","title":"UUIDs","text":"<p>All primary keys use UUIDs (v4) for: - Globally unique identifiers - No sequential patterns (security) - Easier distributed systems (future)</p>"},{"location":"architecture/database-schema/#timestamps","title":"Timestamps","text":"<p>All timestamps use <code>TIMESTAMP WITHOUT TIME ZONE</code>: - Stored in UTC - Application handles timezone conversions</p>"},{"location":"architecture/database-schema/#indexes-and-performance","title":"Indexes and Performance","text":""},{"location":"architecture/database-schema/#composite-indexes","title":"Composite Indexes","text":"<p>All tenant-scoped queries benefit from composite indexes:</p> <pre><code>-- Most common query pattern\nWHERE tenantId = $1 AND status = $2\n\u2193\nINDEX ON (tenantId, status)\n\n-- Team-specific queries\nWHERE tenantId = $1 AND teamId = $2\n\u2193\nINDEX ON (tenantId, teamId)\n</code></pre>"},{"location":"architecture/database-schema/#full-text-search","title":"Full-Text Search","text":"<p>PostgreSQL's built-in full-text search with GIN indexes:</p> <pre><code>-- Managed by database trigger (not in Prisma schema)\nALTER TABLE \"Question\" ADD COLUMN \"search_vector\" tsvector;\n\nUPDATE \"Question\" SET \"search_vector\" = \n  to_tsvector('english', COALESCE(body, ''));\n\nCREATE INDEX \"Question_search_vector_idx\" ON \"Question\" \n  USING GIN(\"search_vector\");\n\n-- Trigger to auto-update search_vector\nCREATE TRIGGER question_search_vector_update \n  BEFORE INSERT OR UPDATE ON \"Question\"\n  FOR EACH ROW EXECUTE FUNCTION \n    tsvector_update_trigger(search_vector, 'pg_catalog.english', body);\n</code></pre> <p>Query Pattern: <pre><code>SELECT * FROM \"Question\"\nWHERE search_vector @@ plainto_tsquery('english', 'mobile app')\nAND tenantId = $1;\n</code></pre></p>"},{"location":"architecture/database-schema/#migrations","title":"Migrations","text":"<p>Migrations are managed by Prisma:</p> <pre><code># Generate migration\nnpx prisma migrate dev --name add_feature\n\n# Apply migrations\nnpx prisma migrate deploy\n\n# Reset database (dev only)\nnpx prisma migrate reset\n</code></pre> <p>Migration Files: - Located in <code>api/prisma/migrations/</code> - Each migration has timestamp + description - SQL files for each migration step</p>"},{"location":"architecture/database-schema/#data-integrity","title":"Data Integrity","text":""},{"location":"architecture/database-schema/#foreign-keys","title":"Foreign Keys","text":"<p>All relationships use foreign keys with appropriate actions:</p> <p>CASCADE DELETE: - Tenant deletion cascades to all tenant data - Team deletion cascades to memberships - Question deletion cascades to upvotes, tags</p> <p>SET NULL: - User deletion sets <code>authorId</code> to NULL (preserve questions) - Team deletion sets <code>teamId</code> to NULL (preserve questions)</p>"},{"location":"architecture/database-schema/#constraints","title":"Constraints","text":"<p>Unique Constraints: - <code>(tenantId, email)</code> - Email unique per tenant - <code>(tenantId, slug)</code> - Slug unique per tenant - <code>(questionId, userId)</code> - One upvote per user per question</p> <p>Check Constraints: - <code>status IN ('OPEN', 'ANSWERED')</code> - Valid question status</p>"},{"location":"architecture/database-schema/#backup-and-recovery","title":"Backup and Recovery","text":""},{"location":"architecture/database-schema/#backup-strategy","title":"Backup Strategy","text":"<pre><code># Full database backup\npg_dump -U app -d ama &gt; backup_$(date +%Y%m%d).sql\n\n# Tenant-specific backup\npg_dump -U app -d ama --table=Question --where=\"tenantId='acme'\" &gt; acme_questions.sql\n</code></pre>"},{"location":"architecture/database-schema/#point-in-time-recovery","title":"Point-in-Time Recovery","text":"<p>PostgreSQL WAL (Write-Ahead Logging) enabled for PITR: - Continuous archiving - Recovery to specific timestamp</p>"},{"location":"architecture/database-schema/#security","title":"Security","text":""},{"location":"architecture/database-schema/#row-level-security-future","title":"Row-Level Security (Future)","text":"<p>Consider PostgreSQL RLS for additional tenant isolation:</p> <pre><code>ALTER TABLE \"Question\" ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY tenant_isolation ON \"Question\"\n  USING (tenantId = current_setting('app.current_tenant')::text);\n</code></pre> <p>Currently using application-level enforcement (Prisma middleware).</p>"},{"location":"architecture/database-schema/#query-patterns","title":"Query Patterns","text":""},{"location":"architecture/database-schema/#common-queries","title":"Common Queries","text":"<p>Get open questions for a team: <pre><code>SELECT * FROM \"Question\"\nWHERE \"tenantId\" = $1 \n  AND \"teamId\" = $2 \n  AND \"status\" = 'OPEN'\nORDER BY \"upvotes\" DESC, \"createdAt\" DESC;\n</code></pre></p> <p>Search questions: <pre><code>SELECT * FROM \"Question\"\nWHERE \"tenantId\" = $1\n  AND \"search_vector\" @@ plainto_tsquery('english', $2)\nORDER BY ts_rank(\"search_vector\", plainto_tsquery('english', $2)) DESC;\n</code></pre></p> <p>Get user's team memberships: <pre><code>SELECT t.*, tm.\"role\"\nFROM \"Team\" t\nINNER JOIN \"TeamMembership\" tm ON tm.\"teamId\" = t.\"id\"\nWHERE tm.\"userId\" = $1 AND t.\"tenantId\" = $2;\n</code></pre></p>"},{"location":"architecture/database-schema/#related-documentation","title":"Related Documentation","text":"<ul> <li>System Design - Overall architecture</li> <li>Multi-Tenancy Architecture - Tenant isolation details</li> <li>API Reference - API endpoints and usage</li> </ul>"},{"location":"architecture/database-schema/#schema-visualization-tools","title":"Schema Visualization Tools","text":"<p>To generate visual ERDs:</p> <pre><code># Using Prisma\nnpx prisma generate\n\n# Using SchemaSpy\njava -jar schemaspy.jar -t pgsql -db ama -u app -p app\n\n# Using DBeaver (GUI)\n# File \u2192 Export \u2192 ERD\n</code></pre>"},{"location":"architecture/multi-tenancy/","title":"Multi-Tenancy Architecture","text":"<p>PulseStage is built as a multi-tenant application from the ground up. This document explains the design, implementation, and best practices for tenant isolation.</p>"},{"location":"architecture/multi-tenancy/#what-is-multi-tenancy","title":"What is Multi-Tenancy?","text":"<p>Multi-tenancy allows a single application instance to serve multiple customers (tenants) with complete data isolation. Each tenant has:</p> <ul> <li>Separate data: Questions, teams, users, tags</li> <li>Separate configuration: Tenant-specific settings</li> <li>Isolated access: No cross-tenant data visibility</li> <li>Shared infrastructure: Single database, single application</li> </ul>"},{"location":"architecture/multi-tenancy/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Users/Requests                       \u2502\n\u2502        (Tenant A: acme.com, Tenant B: widgets.io)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Tenant Resolver Middleware                   \u2502\n\u2502   \u2022 Resolve tenant from: subdomain, header, or session   \u2502\n\u2502   \u2022 Store tenant context in AsyncLocalStorage            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Application Middleware                    \u2502\n\u2502      \u2022 Auth \u2022 RBAC \u2022 CSRF \u2022 Rate Limiting \u2022 Audit        \u2502\n\u2502         (All tenant-aware via context)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Prisma ORM Middleware                    \u2502\n\u2502    \u2022 Automatically inject tenantId in all queries        \u2502\n\u2502    \u2022 Prevent cross-tenant data access                    \u2502\n\u2502    \u2022 Enforce tenant filtering at ORM level               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  PostgreSQL Database                      \u2502\n\u2502        \u2022 All tables have tenantId column                 \u2502\n\u2502        \u2022 Indexes include tenantId for performance        \u2502\n\u2502        \u2022 No foreign keys across tenants                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/multi-tenancy/#tenant-data-model","title":"Tenant Data Model","text":"<p>Every tenant-scoped table includes a <code>tenantId</code> foreign key:</p> <pre><code>model Tenant {\n  id        String   @id @default(uuid())\n  slug      String   @unique\n  name      String\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Relationships (all tenant-scoped)\n  teams             Team[]\n  questions         Question[]\n  tags              Tag[]\n  users             User[]\n  userPreferences   UserPreferences[]\n  auditLogs         AuditLog[]\n  settings          TenantSettings?\n}\n\nmodel Question {\n  id        String   @id @default(uuid())\n  tenantId  String   // \ud83d\udc48 Tenant isolation\n  body      String\n  // ... other fields\n\n  tenant    Tenant   @relation(fields: [tenantId], references: [id])\n\n  @@index([tenantId])          // \ud83d\udc48 Performance\n  @@index([tenantId, status])  // \ud83d\udc48 Composite index\n}\n</code></pre>"},{"location":"architecture/multi-tenancy/#tenant-resolution-strategy","title":"Tenant Resolution Strategy","text":"<p>PulseStage resolves tenants using multiple strategies (in priority order):</p>"},{"location":"architecture/multi-tenancy/#1-query-parameter-highest-priority","title":"1. Query Parameter (Highest Priority)","text":"<p>Used for SSE connections where headers can't be modified: <pre><code>GET /sse?tenantId=acme\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#2-request-header-medium-priority","title":"2. Request Header (Medium Priority)","text":"<p>Used by the frontend for all API requests: <pre><code>X-Tenant-Id: acme\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#3-admin-session-low-priority","title":"3. Admin Session (Low Priority)","text":"<p>Admins authenticated via session have tenant stored in session data: <pre><code>req.session.tenantId = 'acme'\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#4-default-tenant-fallback","title":"4. Default Tenant (Fallback)","text":"<p>If no tenant specified, use default: <pre><code>tenantId = 'default'\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#implementation-details","title":"Implementation Details","text":""},{"location":"architecture/multi-tenancy/#tenant-context-storage","title":"Tenant Context Storage","text":"<p>We use Node.js AsyncLocalStorage to maintain tenant context throughout the request lifecycle:</p> <pre><code>// tenantContext.ts\nimport { AsyncLocalStorage } from 'async_hooks';\n\nexport interface TenantContext {\n  tenantId: string;\n  tenantSlug: string;\n}\n\nconst asyncLocalStorage = new AsyncLocalStorage&lt;TenantContext&gt;();\n\nexport function getTenantContext(): TenantContext {\n  const context = asyncLocalStorage.getStore();\n  if (!context) {\n    throw new Error('Tenant context not set');\n  }\n  return context;\n}\n\nexport function setTenantContext(context: TenantContext) {\n  return asyncLocalStorage.enterWith(context);\n}\n</code></pre> <p>Benefits: - No need to pass <code>tenantId</code> through function parameters - Automatic context propagation through async operations - Thread-safe (each request has isolated context)</p>"},{"location":"architecture/multi-tenancy/#tenant-resolver-middleware","title":"Tenant Resolver Middleware","text":"<p>Resolves tenant and stores in AsyncLocalStorage:</p> <pre><code>// tenantResolver.ts\nexport function createTenantResolverMiddleware(prisma: PrismaClient) {\n  return async (req: Request, res: Response, next: NextFunction) =&gt; {\n    let tenantId: string | undefined;\n\n    // Priority 1: Query parameter (for SSE)\n    tenantId = req.query.tenantId as string;\n\n    // Priority 2: Header (for API requests)\n    if (!tenantId) {\n      tenantId = req.headers['x-tenant-id'] as string;\n    }\n\n    // Priority 3: Session (for admin)\n    if (!tenantId &amp;&amp; req.session?.tenantId) {\n      tenantId = req.session.tenantId;\n    }\n\n    // Priority 4: Default fallback\n    if (!tenantId) {\n      tenantId = 'default';\n    }\n\n    // Resolve tenant from database\n    const tenant = await prisma.tenant.findUnique({\n      where: { slug: tenantId }\n    });\n\n    if (!tenant) {\n      return res.status(404).json({ \n        error: 'Tenant not found' \n      });\n    }\n\n    // Store in AsyncLocalStorage\n    setTenantContext({\n      tenantId: tenant.id,\n      tenantSlug: tenant.slug\n    });\n\n    next();\n  };\n}\n</code></pre>"},{"location":"architecture/multi-tenancy/#prisma-middleware-for-automatic-filtering","title":"Prisma Middleware for Automatic Filtering","text":"<p>Critical: This middleware automatically injects <code>tenantId</code> in all queries:</p> <pre><code>// prismaMiddleware.ts\nexport function applyTenantMiddleware(prisma: PrismaClient) {\n  prisma.$use(async (params, next) =&gt; {\n    // Get tenant context (throws if not set)\n    const tenantContext = tryGetTenantContext();\n\n    if (!tenantContext) {\n      // No tenant context = likely a setup operation\n      return next(params);\n    }\n\n    const tenantId = tenantContext.tenantId;\n\n    // Models that require tenant filtering\n    const tenantedModels = [\n      'Question',\n      'Team', \n      'Tag',\n      'QuestionTag',\n      'User',\n      'TeamMembership',\n      'UserPreferences',\n      'Upvote',\n      'AuditLog',\n      'TenantSettings'\n    ];\n\n    if (!tenantedModels.includes(params.model || '')) {\n      return next(params);\n    }\n\n    // Inject tenantId into WHERE clause\n    if (params.action === 'findUnique' || \n        params.action === 'findFirst' ||\n        params.action === 'findMany' ||\n        params.action === 'count' ||\n        params.action === 'aggregate') {\n      params.args = params.args || {};\n      params.args.where = params.args.where || {};\n      params.args.where.tenantId = tenantId;\n    }\n\n    // Inject tenantId into CREATE\n    if (params.action === 'create') {\n      params.args = params.args || {};\n      params.args.data = params.args.data || {};\n      params.args.data.tenantId = tenantId;\n    }\n\n    // Inject tenantId into UPDATE/DELETE\n    if (params.action === 'update' || \n        params.action === 'updateMany' ||\n        params.action === 'delete' ||\n        params.action === 'deleteMany') {\n      params.args = params.args || {};\n      params.args.where = params.args.where || {};\n      params.args.where.tenantId = tenantId;\n    }\n\n    return next(params);\n  });\n}\n</code></pre> <p>This is the magic: You never need to manually add <code>tenantId</code> filters in your application code!</p>"},{"location":"architecture/multi-tenancy/#example-creating-a-question","title":"Example: Creating a Question","text":"<p>Without tenant middleware (manual filtering): <pre><code>// \u274c Manual approach (error-prone)\nconst question = await prisma.question.create({\n  data: {\n    body: 'What is your favorite color?',\n    tenantId: req.user.tenantId,  // Easy to forget!\n    status: 'OPEN'\n  }\n});\n</code></pre></p> <p>With tenant middleware (automatic): <pre><code>// \u2705 Automatic tenant injection\nconst question = await prisma.question.create({\n  data: {\n    body: 'What is your favorite color?',\n    status: 'OPEN'\n    // tenantId automatically injected by middleware!\n  }\n});\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#example-querying-questions","title":"Example: Querying Questions","text":"<pre><code>// \u2705 Automatic tenant filtering\nconst questions = await prisma.question.findMany({\n  where: {\n    status: 'OPEN'\n    // tenantId automatically added by middleware!\n  },\n  orderBy: { upvotes: 'desc' }\n});\n\n// Results only include questions from current tenant\n</code></pre>"},{"location":"architecture/multi-tenancy/#tenant-settings","title":"Tenant Settings","text":"<p>Per-tenant configuration is stored in the <code>TenantSettings</code> model:</p> <pre><code>model TenantSettings {\n  id        String   @id @default(uuid())\n  tenantId  String   @unique\n  tenant    Tenant   @relation(fields: [tenantId], references: [id])\n\n  // JSON field for flexibility\n  settings  Json     @default(\"{}\")\n\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n}\n</code></pre> <p>Settings Schema: <pre><code>{\n  \"questions\": {\n    \"minLength\": 10,\n    \"maxLength\": 2000,\n    \"requireTeam\": true,\n    \"allowAnonymous\": false\n  },\n  \"users\": {\n    \"autoApprove\": true,\n    \"defaultRole\": \"member\"\n  },\n  \"security\": {\n    \"requireEmailVerification\": false,\n    \"sessionTimeout\": 1800000\n  },\n  \"branding\": {\n    \"primaryColor\": \"#3B82F6\",\n    \"logoUrl\": null\n  },\n  \"features\": {\n    \"enableComments\": false,\n    \"enableVoting\": true,\n    \"enableTags\": true\n  }\n}\n</code></pre></p> <p>Accessing Settings: <pre><code>import { settingsService } from './lib/settingsService';\n\n// Get tenant settings (with defaults)\nconst settings = await settingsService.getTenantSettings();\n\n// Get specific setting\nconst maxLength = settings.questions?.maxLength || 2000;\n\n// Update settings\nawait settingsService.updateTenantSettings({\n  questions: {\n    maxLength: 1500\n  }\n});\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#tenant-isolation-guarantees","title":"Tenant Isolation Guarantees","text":""},{"location":"architecture/multi-tenancy/#1-database-level","title":"1. Database Level","text":"<ul> <li>\u2705 All queries automatically filtered by <code>tenantId</code></li> <li>\u2705 Indexes include <code>tenantId</code> for performance</li> <li>\u2705 Foreign keys prevent cross-tenant references</li> <li>\u2705 Cascading deletes maintain referential integrity</li> </ul>"},{"location":"architecture/multi-tenancy/#2-application-level","title":"2. Application Level","text":"<ul> <li>\u2705 Tenant context required for all authenticated routes</li> <li>\u2705 AsyncLocalStorage ensures context propagation</li> <li>\u2705 Middleware validates tenant existence</li> <li>\u2705 Rate limiting is per-tenant</li> </ul>"},{"location":"architecture/multi-tenancy/#3-api-level","title":"3. API Level","text":"<ul> <li>\u2705 All endpoints validate tenant context</li> <li>\u2705 SSE connections are tenant-scoped</li> <li>\u2705 Audit logs include tenant information</li> <li>\u2705 Exports filtered by tenant</li> </ul>"},{"location":"architecture/multi-tenancy/#4-frontend-level","title":"4. Frontend Level","text":"<ul> <li>\u2705 API client sends <code>X-Tenant-Id</code> header</li> <li>\u2705 SSE connections include <code>tenantId</code> query param</li> <li>\u2705 User can only access their tenant's data</li> <li>\u2705 Team selector shows only tenant's teams</li> </ul>"},{"location":"architecture/multi-tenancy/#security-considerations","title":"Security Considerations","text":""},{"location":"architecture/multi-tenancy/#preventing-tenant-leakage","title":"Preventing Tenant Leakage","text":"<p>\u2705 Safe Patterns: <pre><code>// Prisma middleware handles filtering automatically\nconst questions = await prisma.question.findMany({\n  where: { status: 'OPEN' }\n});\n\n// Context-aware audit logging\nawait auditService.log({\n  action: 'question.created',\n  entityType: 'Question',\n  entityId: question.id\n  // tenantId automatically added\n});\n</code></pre></p> <p>\u274c Unsafe Patterns: <pre><code>// NEVER bypass tenant filtering\nconst allQuestions = await prisma.$queryRaw`\n  SELECT * FROM \"Question\"\n`;  // No tenant filter!\n\n// NEVER use raw queries without tenant filter\nconst results = await prisma.$executeRaw`\n  UPDATE \"Question\" SET status = 'ANSWERED'\n`;  // Updates ALL tenants!\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#testing-tenant-isolation","title":"Testing Tenant Isolation","text":"<pre><code>// Test: Ensure cross-tenant access is blocked\ntest('should not return questions from other tenants', async () =&gt; {\n  // Create question in tenant A\n  setTenantContext({ tenantId: 'tenant-a', tenantSlug: 'tenant-a' });\n  await prisma.question.create({\n    data: { body: 'Tenant A question' }\n  });\n\n  // Try to access from tenant B\n  setTenantContext({ tenantId: 'tenant-b', tenantSlug: 'tenant-b' });\n  const questions = await prisma.question.findMany();\n\n  // Should be empty (no cross-tenant access)\n  expect(questions).toHaveLength(0);\n});\n</code></pre>"},{"location":"architecture/multi-tenancy/#tenant-lifecycle","title":"Tenant Lifecycle","text":""},{"location":"architecture/multi-tenancy/#creating-a-tenant","title":"Creating a Tenant","text":"<pre><code>// Auto-bootstrap (on first startup)\nconst tenant = await prisma.tenant.create({\n  data: {\n    name: 'Acme Corp',\n    slug: 'acme'\n  }\n});\n\n// Create default settings\nawait prisma.tenantSettings.create({\n  data: {\n    tenantId: tenant.id,\n    settings: {} // Uses defaults\n  }\n});\n</code></pre>"},{"location":"architecture/multi-tenancy/#setup-wizard-flow","title":"Setup Wizard Flow","text":"<ol> <li>User visits app \u2192 No teams exist</li> <li>Setup wizard displays \u2192 Two options:</li> <li>Load demo data (creates <code>acme</code> tenant)</li> <li>Create custom organization (creates tenant with custom name)</li> <li>Tenant created \u2192 Auto-restart to load new tenant</li> <li>User navigates to <code>/sso-test.html</code> \u2192 Sign in with new account</li> </ol>"},{"location":"architecture/multi-tenancy/#tenant-deletion","title":"Tenant Deletion","text":"<pre><code>// Cascade delete (removes all tenant data)\nawait prisma.tenant.delete({\n  where: { id: tenantId }\n});\n\n// Automatically deletes:\n// - All teams\n// - All questions\n// - All users\n// - All tags\n// - All audit logs\n// - Tenant settings\n</code></pre>"},{"location":"architecture/multi-tenancy/#performance-optimizations","title":"Performance Optimizations","text":""},{"location":"architecture/multi-tenancy/#indexing-strategy","title":"Indexing Strategy","text":"<p>All tenant-scoped tables have composite indexes:</p> <pre><code>-- Single-column index\nCREATE INDEX \"Question_tenantId_idx\" ON \"Question\"(\"tenantId\");\n\n-- Composite indexes (tenant + filter)\nCREATE INDEX \"Question_tenantId_status_idx\" \n  ON \"Question\"(\"tenantId\", \"status\");\n\nCREATE INDEX \"Question_tenantId_teamId_idx\" \n  ON \"Question\"(\"tenantId\", \"teamId\");\n\n-- Audit log (descending for recent logs)\nCREATE INDEX \"AuditLog_tenantId_createdAt_idx\" \n  ON \"AuditLog\"(\"tenantId\", \"createdAt\" DESC);\n</code></pre>"},{"location":"architecture/multi-tenancy/#query-optimization","title":"Query Optimization","text":"<pre><code>// \u2705 Efficient: Uses composite index\nconst openQuestions = await prisma.question.findMany({\n  where: {\n    // tenantId: auto-injected (uses index)\n    status: 'OPEN'\n  },\n  orderBy: { createdAt: 'desc' }\n});\n\n// \u2705 Efficient: Prisma generates optimized query\nSELECT * FROM \"Question\" \nWHERE \"tenantId\" = $1 AND \"status\" = 'OPEN'\nORDER BY \"createdAt\" DESC;\n</code></pre>"},{"location":"architecture/multi-tenancy/#multi-tenant-sse-broadcasting","title":"Multi-Tenant SSE Broadcasting","text":"<p>Real-time events are tenant-scoped:</p> <pre><code>// EventBus maintains per-tenant connections\nclass EventBus {\n  private clients: Map&lt;string, SSEClient[]&gt; = new Map();\n\n  addClient(tenantId: string, res: Response): string {\n    if (!this.clients.has(tenantId)) {\n      this.clients.set(tenantId, []);\n    }\n    this.clients.get(tenantId)!.push(client);\n  }\n\n  publish(event: SSEEvent) {\n    const tenantClients = this.clients.get(event.tenantId);\n    // Only sends to clients in the same tenant\n    for (const client of tenantClients) {\n      client.res.write(eventData);\n    }\n  }\n}\n</code></pre>"},{"location":"architecture/multi-tenancy/#scaling-considerations","title":"Scaling Considerations","text":""},{"location":"architecture/multi-tenancy/#single-database-approach-current","title":"Single-Database Approach (Current)","text":"<p>Advantages: - \u2705 Simple deployment - \u2705 Easy backups - \u2705 Cross-tenant reporting possible - \u2705 Lower operational overhead</p> <p>Limitations: - \u26a0\ufe0f Noisy neighbor problem (one tenant can impact others) - \u26a0\ufe0f Harder to scale beyond ~100 tenants - \u26a0\ufe0f Single point of failure</p>"},{"location":"architecture/multi-tenancy/#database-per-tenant-future","title":"Database-per-Tenant (Future)","text":"<p>For very large deployments, consider:</p> <pre><code>Tenant Router\n    \u251c\u2500\u2500 Tenant A \u2192 Database A\n    \u251c\u2500\u2500 Tenant B \u2192 Database B\n    \u2514\u2500\u2500 Tenant C \u2192 Database C\n</code></pre> <p>Advantages: - \u2705 Complete isolation - \u2705 Per-tenant scaling - \u2705 Better security (physical separation)</p> <p>Challenges: - \u274c Complex deployment - \u274c Difficult cross-tenant features - \u274c Higher operational cost</p>"},{"location":"architecture/multi-tenancy/#best-practices","title":"Best Practices","text":""},{"location":"architecture/multi-tenancy/#dos","title":"\u2705 Do's","text":"<ol> <li>Always use Prisma ORM - Let middleware handle filtering</li> <li>Test tenant isolation - Verify no cross-tenant access</li> <li>Include tenantId in logs - For debugging and auditing</li> <li>Monitor per-tenant metrics - Track usage and performance</li> <li>Set tenant context early - In middleware, before any DB access</li> </ol>"},{"location":"architecture/multi-tenancy/#donts","title":"\u274c Don'ts","text":"<ol> <li>Don't use raw SQL - Bypasses tenant middleware</li> <li>Don't hardcode tenant IDs - Always use context</li> <li>Don't skip tenant validation - Always verify tenant exists</li> <li>Don't share sessions across tenants - Each tenant = separate context</li> <li>Don't forget indexes - All queries should use composite indexes</li> </ol>"},{"location":"architecture/multi-tenancy/#troubleshooting","title":"Troubleshooting","text":""},{"location":"architecture/multi-tenancy/#tenant-context-not-set-error","title":"\"Tenant context not set\" Error","text":"<p>Cause: Accessing database before tenant context established</p> <p>Solution: Ensure tenant resolver middleware runs first <pre><code>app.use(createTenantResolverMiddleware(prisma));  // Must be early!\napp.use('/questions', questionsRouter);\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#cross-tenant-data-visible","title":"Cross-Tenant Data Visible","text":"<p>Cause: Raw query bypassing Prisma middleware</p> <p>Solution: Use Prisma ORM or manually filter <pre><code>// \u274c Bad\nconst results = await prisma.$queryRaw`SELECT * FROM \"Question\"`;\n\n// \u2705 Good\nconst results = await prisma.question.findMany();\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#slow-queries","title":"Slow Queries","text":"<p>Cause: Missing composite index on <code>tenantId</code></p> <p>Solution: Add index in Prisma schema <pre><code>@@index([tenantId, status])\n</code></pre></p>"},{"location":"architecture/multi-tenancy/#related-documentation","title":"Related Documentation","text":"<ul> <li>System Design - Overall architecture</li> <li>Database Schema - ERD and table details</li> <li>Security Overview - Security features</li> </ul>"},{"location":"architecture/multi-tenancy/#references","title":"References","text":"<ul> <li>Prisma Middleware Docs</li> <li>AsyncLocalStorage</li> <li>Multi-Tenant SaaS Patterns</li> </ul>"},{"location":"architecture/real-time/","title":"Real-Time Architecture","text":"<p>PulseStage uses Server-Sent Events (SSE) to provide real-time updates for questions, answers, and moderation actions. This document explains the implementation, design decisions, and best practices.</p>"},{"location":"architecture/real-time/#why-server-sent-events","title":"Why Server-Sent Events?","text":"<p>We chose SSE over WebSockets for several reasons:</p> Feature SSE WebSockets Direction Server \u2192 Client (one-way) Bidirectional Protocol HTTP TCP (with HTTP upgrade) Reconnection Automatic Manual implementation Browser Support Excellent Excellent Firewall/Proxy Works everywhere Sometimes blocked Complexity Simple More complex Use Case Push updates Chat, real-time bidirectional <p>Perfect for PulseStage: - We only need server\u2192client updates (questions, upvotes, answers) - Automatic reconnection is built-in - Simpler implementation and debugging - Better compatibility with corporate firewalls - HTTP-based = works with existing infrastructure</p>"},{"location":"architecture/real-time/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Client (Browser)                     \u2502\n\u2502  EventSource('/sse?tenantId=acme')                     \u2502\n\u2502    \u2193                                                    \u2502\n\u2502  \u2022 Auto-reconnect on disconnect                        \u2502\n\u2502  \u2022 Receives events: question:created, upvoted, etc.    \u2502\n\u2502  \u2022 Updates React state \u2192 UI re-renders                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502 HTTP GET /sse\n                      \u2502 (Long-lived connection)\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   API Server (Express)                  \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502          SSE Endpoint (/sse)                    \u2502  \u2502\n\u2502  \u2502  \u2022 Resolve tenant (from query param)           \u2502  \u2502\n\u2502  \u2502  \u2022 Register client with EventBus               \u2502  \u2502\n\u2502  \u2502  \u2022 Keep connection open                        \u2502  \u2502\n\u2502  \u2502  \u2022 Send heartbeat every 30s                    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                      \u2502                                  \u2502\n\u2502                      \u25bc                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502           EventBus (Singleton)                  \u2502  \u2502\n\u2502  \u2502  \u2022 Map&lt;tenantId, SSEClient[]&gt;                  \u2502  \u2502\n\u2502  \u2502  \u2022 addClient(tenantId, response)               \u2502  \u2502\n\u2502  \u2502  \u2022 removeClient(tenantId, clientId)            \u2502  \u2502\n\u2502  \u2502  \u2022 publish(SSEEvent) \u2192 all tenant clients      \u2502  \u2502\n\u2502  \u2502  \u2022 sendHeartbeat() every 30s                   \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                      \u25b2                                  \u2502\n\u2502                      \u2502 eventBus.publish()              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502        API Route Handlers                       \u2502  \u2502\n\u2502  \u2502  \u2022 POST /questions \u2192 publish('question:created')\u2502  \u2502\n\u2502  \u2502  \u2022 POST /upvote \u2192 publish('question:upvoted')  \u2502  \u2502\n\u2502  \u2502  \u2022 POST /answer \u2192 publish('question:answered') \u2502  \u2502\n\u2502  \u2502  \u2022 POST /tag \u2192 publish('question:tagged')      \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/real-time/#implementation-details","title":"Implementation Details","text":""},{"location":"architecture/real-time/#server-side-eventbus","title":"Server-Side: EventBus","text":"<p>Central singleton that manages SSE connections and broadcasts events.</p> <p>File: <code>api/src/lib/eventBus.ts</code></p> <pre><code>import { Response } from 'express';\n\nexport type SSEEventType =\n  | 'question:created'\n  | 'question:upvoted'\n  | 'question:answered'\n  | 'question:tagged'\n  | 'question:untagged'\n  | 'question:pinned'\n  | 'question:frozen'\n  | 'heartbeat';\n\nexport interface SSEEvent {\n  type: SSEEventType;\n  tenantId: string;\n  data: any;\n  timestamp: number;\n}\n\nexport interface SSEClient {\n  id: string;\n  tenantId: string;\n  res: Response;\n  connectedAt: number;\n}\n\nclass EventBus {\n  // Per-tenant client tracking\n  private clients: Map&lt;string, SSEClient[]&gt; = new Map();\n  private heartbeatInterval: NodeJS.Timeout | null = null;\n  private connectionCounter = 0;\n\n  constructor() {\n    this.startHeartbeat();\n  }\n\n  /**\n   * Add a client connection for a specific tenant\n   */\n  addClient(tenantId: string, res: Response): string {\n    const clientId = `client-${++this.connectionCounter}-${Date.now()}`;\n    const client: SSEClient = {\n      id: clientId,\n      tenantId,\n      res,\n      connectedAt: Date.now(),\n    };\n\n    if (!this.clients.has(tenantId)) {\n      this.clients.set(tenantId, []);\n    }\n\n    this.clients.get(tenantId)!.push(client);\n\n    console.log(`\ud83d\udce1 SSE: Client ${clientId} connected to tenant ${tenantId}`);\n    return clientId;\n  }\n\n  /**\n   * Remove a client connection\n   */\n  removeClient(tenantId: string, clientId: string) {\n    const tenantClients = this.clients.get(tenantId);\n    if (!tenantClients) return;\n\n    const index = tenantClients.findIndex(c =&gt; c.id === clientId);\n    if (index !== -1) {\n      tenantClients.splice(index, 1);\n\n      if (tenantClients.length === 0) {\n        this.clients.delete(tenantId);\n      }\n\n      console.log(`\ud83d\udce1 SSE: Client ${clientId} disconnected from tenant ${tenantId}`);\n    }\n  }\n\n  /**\n   * Publish an event to all clients in a specific tenant\n   */\n  publish(event: SSEEvent) {\n    const tenantClients = this.clients.get(event.tenantId);\n    if (!tenantClients || tenantClients.length === 0) {\n      return; // No clients to send to\n    }\n\n    const eventData = `data: ${JSON.stringify(event)}\\n\\n`;\n    const deadClients: string[] = [];\n\n    for (const client of tenantClients) {\n      try {\n        client.res.write(eventData);\n      } catch (error) {\n        // Connection is dead, mark for removal\n        deadClients.push(client.id);\n      }\n    }\n\n    // Clean up dead connections\n    for (const clientId of deadClients) {\n      this.removeClient(event.tenantId, clientId);\n    }\n  }\n\n  /**\n   * Send heartbeat to all connected clients\n   */\n  private sendHeartbeat() {\n    const now = Date.now();\n\n    for (const [tenantId, tenantClients] of this.clients.entries()) {\n      const heartbeatEvent: SSEEvent = {\n        type: 'heartbeat',\n        tenantId,\n        data: { timestamp: now },\n        timestamp: now,\n      };\n\n      this.publish(heartbeatEvent);\n    }\n  }\n\n  /**\n   * Start periodic heartbeat\n   */\n  private startHeartbeat() {\n    this.heartbeatInterval = setInterval(() =&gt; {\n      this.sendHeartbeat();\n    }, 30000); // 30 seconds\n  }\n\n  /**\n   * Get metrics for monitoring\n   */\n  getMetrics() {\n    const tenantMetrics: Record&lt;string, number&gt; = {};\n    for (const [tenantId, clients] of this.clients.entries()) {\n      tenantMetrics[tenantId] = clients.length;\n    }\n\n    return {\n      totalConnections: this.getTotalClientCount(),\n      tenantConnections: tenantMetrics,\n      tenantCount: this.clients.size,\n    };\n  }\n}\n\n// Singleton instance\nexport const eventBus = new EventBus();\n</code></pre>"},{"location":"architecture/real-time/#server-side-sse-endpoint","title":"Server-Side: SSE Endpoint","text":"<p>Handles client connections and maintains open connections.</p> <p>File: <code>api/src/app.ts</code> (excerpt)</p> <pre><code>import { eventBus } from './lib/eventBus.js';\nimport { createTenantResolverMiddleware } from './middleware/tenantResolver.js';\n\n// SSE endpoint for real-time updates\napp.get('/sse', async (req: Request, res: Response) =&gt; {\n  // Resolve tenant (from query parameter)\n  let tenantSlug = req.query.tenantId as string || 'default';\n\n  const tenant = await prisma.tenant.findUnique({\n    where: { slug: tenantSlug }\n  });\n\n  if (!tenant) {\n    return res.status(404).json({ error: 'Tenant not found' });\n  }\n\n  // Set headers for SSE\n  res.setHeader('Content-Type', 'text/event-stream');\n  res.setHeader('Cache-Control', 'no-cache');\n  res.setHeader('Connection', 'keep-alive');\n  res.setHeader('X-Accel-Buffering', 'no'); // Disable nginx buffering\n\n  // Register client with EventBus\n  const clientId = eventBus.addClient(tenant.id, res);\n\n  // Send initial connection confirmation\n  res.write(`data: ${JSON.stringify({\n    type: 'connected',\n    tenantId: tenant.id,\n    timestamp: Date.now()\n  })}\\n\\n`);\n\n  // Handle client disconnect\n  req.on('close', () =&gt; {\n    eventBus.removeClient(tenant.id, clientId);\n  });\n});\n</code></pre>"},{"location":"architecture/real-time/#server-side-publishing-events","title":"Server-Side: Publishing Events","text":"<p>Route handlers publish events after database updates.</p> <pre><code>// Example: Question creation\napp.post('/questions', async (req: Request, res: Response) =&gt; {\n  // ... validate input ...\n\n  const question = await prisma.question.create({\n    data: {\n      body: req.body.body,\n      status: 'OPEN',\n      teamId: req.body.teamId\n    }\n  });\n\n  // Broadcast event to all connected clients\n  eventBus.publish({\n    type: 'question:created',\n    tenantId: getTenantContext().tenantId,\n    data: question,\n    timestamp: Date.now()\n  });\n\n  res.json(question);\n});\n\n// Example: Upvote\napp.post('/questions/:id/upvote', async (req: Request, res: Response) =&gt; {\n  // ... validate and create upvote ...\n\n  const question = await prisma.question.update({\n    where: { id: req.params.id },\n    data: { upvotes: { increment: 1 } }\n  });\n\n  eventBus.publish({\n    type: 'question:upvoted',\n    tenantId: getTenantContext().tenantId,\n    data: { questionId: question.id, upvotes: question.upvotes },\n    timestamp: Date.now()\n  });\n\n  res.json(question);\n});\n</code></pre>"},{"location":"architecture/real-time/#client-side-ssecontext","title":"Client-Side: SSEContext","text":"<p>React context that manages SSE connection and distributes events.</p> <p>File: <code>web/src/contexts/SSEContext.tsx</code></p> <pre><code>import { createContext, useContext, useEffect, useState, useRef } from 'react';\n\ninterface SSEContextType {\n  connected: boolean;\n  lastEvent: SSEEvent | null;\n}\n\nconst SSEContext = createContext&lt;SSEContextType&gt;({\n  connected: false,\n  lastEvent: null\n});\n\nexport function SSEProvider({ children, tenantId }: { \n  children: React.ReactNode; \n  tenantId: string;\n}) {\n  const [connected, setConnected] = useState(false);\n  const [lastEvent, setLastEvent] = useState&lt;SSEEvent | null&gt;(null);\n  const eventSourceRef = useRef&lt;EventSource | null&gt;(null);\n\n  useEffect(() =&gt; {\n    // Create SSE connection\n    const eventSource = new EventSource(\n      `${API_URL}/sse?tenantId=${tenantId}`\n    );\n\n    eventSource.onopen = () =&gt; {\n      console.log('\ud83d\udce1 SSE: Connected');\n      setConnected(true);\n    };\n\n    eventSource.onmessage = (event) =&gt; {\n      try {\n        const data = JSON.parse(event.data);\n\n        // Ignore heartbeats (handled internally)\n        if (data.type === 'heartbeat') {\n          return;\n        }\n\n        console.log('\ud83d\udce1 SSE: Event received', data.type);\n        setLastEvent(data);\n      } catch (error) {\n        console.error('\ud83d\udce1 SSE: Failed to parse event', error);\n      }\n    };\n\n    eventSource.onerror = () =&gt; {\n      console.log('\ud83d\udce1 SSE: Disconnected, will reconnect...');\n      setConnected(false);\n      // EventSource automatically reconnects\n    };\n\n    eventSourceRef.current = eventSource;\n\n    // Cleanup on unmount\n    return () =&gt; {\n      eventSource.close();\n      eventSourceRef.current = null;\n    };\n  }, [tenantId]);\n\n  return (\n    &lt;SSEContext.Provider value={{ connected, lastEvent }}&gt;\n      {children}\n    &lt;/SSEContext.Provider&gt;\n  );\n}\n\nexport const useSSE = () =&gt; useContext(SSEContext);\n</code></pre>"},{"location":"architecture/real-time/#client-side-using-sse-events","title":"Client-Side: Using SSE Events","text":"<p>Components subscribe to SSE events and update state.</p> <pre><code>import { useSSE } from '../contexts/SSEContext';\nimport { useEffect } from 'react';\n\nexport function QuestionsPage() {\n  const [questions, setQuestions] = useState&lt;Question[]&gt;([]);\n  const { lastEvent } = useSSE();\n\n  // Load initial questions\n  useEffect(() =&gt; {\n    fetchQuestions().then(setQuestions);\n  }, []);\n\n  // Handle SSE events\n  useEffect(() =&gt; {\n    if (!lastEvent) return;\n\n    switch (lastEvent.type) {\n      case 'question:created':\n        // Add new question to list\n        setQuestions(prev =&gt; [lastEvent.data, ...prev]);\n        break;\n\n      case 'question:upvoted':\n        // Update upvote count\n        setQuestions(prev =&gt; prev.map(q =&gt; \n          q.id === lastEvent.data.questionId\n            ? { ...q, upvotes: lastEvent.data.upvotes }\n            : q\n        ));\n        break;\n\n      case 'question:answered':\n        // Move to answered list or update status\n        setQuestions(prev =&gt; prev.map(q =&gt;\n          q.id === lastEvent.data.id\n            ? { ...q, status: 'ANSWERED', responseText: lastEvent.data.responseText }\n            : q\n        ));\n        break;\n\n      case 'question:tagged':\n        // Update tags\n        setQuestions(prev =&gt; prev.map(q =&gt;\n          q.id === lastEvent.data.questionId\n            ? { ...q, tags: lastEvent.data.tags }\n            : q\n        ));\n        break;\n    }\n  }, [lastEvent]);\n\n  return (\n    &lt;div&gt;\n      {questions.map(q =&gt; &lt;QuestionCard key={q.id} question={q} /&gt;)}\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"architecture/real-time/#event-types","title":"Event Types","text":""},{"location":"architecture/real-time/#questioncreated","title":"question:created","text":"<p>New question submitted.</p> <pre><code>{\n  \"type\": \"question:created\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"id\": \"question-uuid\",\n    \"body\": \"What is the roadmap for Q2?\",\n    \"upvotes\": 0,\n    \"status\": \"OPEN\",\n    \"teamId\": \"engineering-uuid\",\n    \"createdAt\": \"2025-10-08T10:30:00Z\"\n  },\n  \"timestamp\": 1696765800000\n}\n</code></pre>"},{"location":"architecture/real-time/#questionupvoted","title":"question:upvoted","text":"<p>Question received an upvote.</p> <pre><code>{\n  \"type\": \"question:upvoted\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"questionId\": \"question-uuid\",\n    \"upvotes\": 15\n  },\n  \"timestamp\": 1696765800000\n}\n</code></pre>"},{"location":"architecture/real-time/#questionanswered","title":"question:answered","text":"<p>Moderator answered a question.</p> <pre><code>{\n  \"type\": \"question:answered\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"id\": \"question-uuid\",\n    \"responseText\": \"We're planning to launch feature X in Q2.\",\n    \"respondedAt\": \"2025-10-08T10:35:00Z\",\n    \"status\": \"ANSWERED\"\n  },\n  \"timestamp\": 1696766100000\n}\n</code></pre>"},{"location":"architecture/real-time/#questiontagged","title":"question:tagged","text":"<p>Tag added to question.</p> <pre><code>{\n  \"type\": \"question:tagged\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"questionId\": \"question-uuid\",\n    \"tags\": [\n      { \"id\": \"tag-1\", \"name\": \"Product\", \"color\": \"#3B82F6\" },\n      { \"id\": \"tag-2\", \"name\": \"Roadmap\", \"color\": \"#10B981\" }\n    ]\n  },\n  \"timestamp\": 1696766200000\n}\n</code></pre>"},{"location":"architecture/real-time/#questionpinned","title":"question:pinned","text":"<p>Question pinned by moderator.</p> <pre><code>{\n  \"type\": \"question:pinned\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"questionId\": \"question-uuid\",\n    \"isPinned\": true,\n    \"pinnedBy\": \"user-uuid\",\n    \"pinnedAt\": \"2025-10-08T10:40:00Z\"\n  },\n  \"timestamp\": 1696766400000\n}\n</code></pre>"},{"location":"architecture/real-time/#questionfrozen","title":"question:frozen","text":"<p>Question frozen (no more upvotes/responses).</p> <pre><code>{\n  \"type\": \"question:frozen\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"questionId\": \"question-uuid\",\n    \"isFrozen\": true,\n    \"frozenBy\": \"user-uuid\",\n    \"frozenAt\": \"2025-10-08T10:45:00Z\"\n  },\n  \"timestamp\": 1696766700000\n}\n</code></pre>"},{"location":"architecture/real-time/#heartbeat","title":"heartbeat","text":"<p>Keepalive signal (sent every 30 seconds).</p> <pre><code>{\n  \"type\": \"heartbeat\",\n  \"tenantId\": \"acme-tenant-id\",\n  \"data\": {\n    \"timestamp\": 1696766900000\n  },\n  \"timestamp\": 1696766900000\n}\n</code></pre>"},{"location":"architecture/real-time/#connection-management","title":"Connection Management","text":""},{"location":"architecture/real-time/#automatic-reconnection","title":"Automatic Reconnection","text":"<p>EventSource automatically reconnects on disconnect:</p> <pre><code>// Browser's EventSource handles reconnection\nconst eventSource = new EventSource('/sse?tenantId=acme');\n\neventSource.onerror = () =&gt; {\n  console.log('Disconnected, will reconnect automatically...');\n  // EventSource retries with exponential backoff\n};\n</code></pre> <p>Retry Behavior: - Retry 1: 1 second - Retry 2: 2 seconds - Retry 3: 4 seconds - Max: 10 seconds</p>"},{"location":"architecture/real-time/#dead-connection-cleanup","title":"Dead Connection Cleanup","text":"<p>Server detects and removes dead connections:</p> <pre><code>publish(event: SSEEvent) {\n  const deadClients: string[] = [];\n\n  for (const client of tenantClients) {\n    try {\n      client.res.write(eventData);\n    } catch (error) {\n      // Connection is dead\n      deadClients.push(client.id);\n    }\n  }\n\n  // Clean up dead connections\n  for (const clientId of deadClients) {\n    this.removeClient(event.tenantId, clientId);\n  }\n}\n</code></pre>"},{"location":"architecture/real-time/#heartbeat-mechanism","title":"Heartbeat Mechanism","text":"<p>Server sends heartbeat every 30 seconds:</p> <ul> <li>Keeps connection alive through proxies/firewalls</li> <li>Helps detect dead connections</li> <li>Client can ignore heartbeat events</li> </ul> <pre><code>setInterval(() =&gt; {\n  eventBus.publish({\n    type: 'heartbeat',\n    tenantId: tenantId,\n    data: { timestamp: Date.now() },\n    timestamp: Date.now()\n  });\n}, 30000); // 30 seconds\n</code></pre>"},{"location":"architecture/real-time/#tenant-isolation","title":"Tenant Isolation","text":"<p>SSE connections are tenant-scoped:</p> <ul> <li>Each client connects to specific tenant</li> <li>EventBus maintains per-tenant connection lists</li> <li>Events only sent to clients in same tenant</li> <li>No cross-tenant event leakage</li> </ul> <pre><code>// Client specifies tenant in connection\nGET /sse?tenantId=acme\n\n// Server stores tenant with connection\neventBus.addClient('acme-tenant-id', response);\n\n// Events filtered by tenant\neventBus.publish({\n  tenantId: 'acme-tenant-id', // Only sent to acme clients\n  type: 'question:created',\n  data: question\n});\n</code></pre>"},{"location":"architecture/real-time/#performance-considerations","title":"Performance Considerations","text":""},{"location":"architecture/real-time/#connection-limits","title":"Connection Limits","text":"<p>Each SSE connection holds one HTTP connection open:</p> <ul> <li>Modern browsers: 6-8 connections per domain</li> <li>Server: Depends on Node.js ulimit (default: 1024)</li> <li>Recommendation: Use HTTP/2 for multiplexing</li> </ul>"},{"location":"architecture/real-time/#memory-usage","title":"Memory Usage","text":"<p>Each client connection consumes: - ~50KB per connection (HTTP overhead) - ~10KB per client object (JavaScript) - Total: ~60KB per connection</p> <p>For 1,000 concurrent clients: - Memory: ~60MB (negligible) - File descriptors: 1,000 (monitor ulimit)</p>"},{"location":"architecture/real-time/#scaling-beyond-single-instance","title":"Scaling Beyond Single Instance","text":"<p>Current limitation: SSE connections are in-memory per API instance.</p> <p>Solution: Use Redis Pub/Sub for multi-instance broadcasting:</p> <pre><code>// Publisher (any API instance)\nawait redis.publish('sse-events', JSON.stringify(event));\n\n// Subscriber (all API instances)\nredis.subscribe('sse-events');\nredis.on('message', (channel, message) =&gt; {\n  const event = JSON.parse(message);\n  eventBus.publish(event); // Broadcast to local clients\n});\n</code></pre> <p>This allows horizontal scaling with load balancer.</p>"},{"location":"architecture/real-time/#security-considerations","title":"Security Considerations","text":""},{"location":"architecture/real-time/#authentication","title":"Authentication","text":"<p>SSE endpoint validates tenant but doesn't require authentication: - Read-only events (safe to broadcast) - No sensitive data in events - Tenant isolation prevents cross-tenant access</p> <p>Future: Add authentication if needed: <pre><code>app.get('/sse', requireAuth, async (req, res) =&gt; {\n  // Only authenticated users can connect\n});\n</code></pre></p>"},{"location":"architecture/real-time/#rate-limiting","title":"Rate Limiting","text":"<p>SSE connections are exempt from rate limiting: - Long-lived connections - Not counted as separate requests - Heartbeats don't count towards rate limit</p>"},{"location":"architecture/real-time/#cors","title":"CORS","text":"<p>SSE respects CORS headers: <pre><code>res.setHeader('Access-Control-Allow-Origin', CORS_ORIGIN);\nres.setHeader('Access-Control-Allow-Credentials', 'true');\n</code></pre></p>"},{"location":"architecture/real-time/#monitoring-debugging","title":"Monitoring &amp; Debugging","text":""},{"location":"architecture/real-time/#connection-metrics","title":"Connection Metrics","text":"<pre><code>// Get current metrics\nconst metrics = eventBus.getMetrics();\n\nconsole.log({\n  totalConnections: metrics.totalConnections,\n  tenantConnections: metrics.tenantConnections,\n  tenantCount: metrics.tenantCount\n});\n\n// Example output:\n// {\n//   totalConnections: 156,\n//   tenantConnections: {\n//     'acme-tenant-id': 89,\n//     'widgets-tenant-id': 67\n//   },\n//   tenantCount: 2\n// }\n</code></pre>"},{"location":"architecture/real-time/#health-dashboard-future","title":"Health Dashboard (Future)","text":"<p>Add SSE metrics to health dashboard: - Active connections per tenant - Connection duration - Event publishing rate - Heartbeat health</p>"},{"location":"architecture/real-time/#logging","title":"Logging","text":"<p>Development logs for debugging:</p> <pre><code>console.log('\ud83d\udce1 SSE: Client connected', clientId);\nconsole.log('\ud83d\udce1 SSE: Event published', event.type);\nconsole.log('\ud83d\udce1 SSE: Client disconnected', clientId);\n</code></pre> <p>Production: Use structured logging (JSON).</p>"},{"location":"architecture/real-time/#troubleshooting","title":"Troubleshooting","text":""},{"location":"architecture/real-time/#eventsource-failed-error","title":"\"EventSource failed\" Error","text":"<p>Cause: CORS or network issue</p> <p>Solution: 1. Check CORS headers on <code>/sse</code> endpoint 2. Verify tenant exists 3. Check network tab for HTTP errors</p>"},{"location":"architecture/real-time/#events-not-received","title":"Events Not Received","text":"<p>Cause: Client not subscribed to events</p> <p>Solution: 1. Verify SSE connection is established (check <code>connected</code> state) 2. Check browser console for event logs 3. Verify event type matches handler</p>"},{"location":"architecture/real-time/#connection-drops-frequently","title":"Connection Drops Frequently","text":"<p>Cause: Proxy/firewall closing idle connections</p> <p>Solution: 1. Reduce heartbeat interval (currently 30s) 2. Add proxy configuration for long-lived connections 3. Use HTTP/2 (better at keeping connections alive)</p>"},{"location":"architecture/real-time/#high-memory-usage","title":"High Memory Usage","text":"<p>Cause: Too many SSE connections</p> <p>Solution: 1. Check <code>eventBus.getMetrics()</code> for connection count 2. Implement connection limits per tenant 3. Monitor Node.js memory usage 4. Scale horizontally with Redis Pub/Sub</p>"},{"location":"architecture/real-time/#future-enhancements","title":"Future Enhancements","text":""},{"location":"architecture/real-time/#1-redis-pubsub-for-multi-instance","title":"1. Redis Pub/Sub for Multi-Instance","text":"<p>Enable horizontal scaling: - Broadcast events via Redis - All API instances subscribe - Each instance handles own SSE clients</p>"},{"location":"architecture/real-time/#2-binary-protocol","title":"2. Binary Protocol","text":"<p>Consider using WebSocket for efficiency: - Smaller payload size - Lower latency - Bidirectional (for future features)</p>"},{"location":"architecture/real-time/#3-event-filtering","title":"3. Event Filtering","text":"<p>Allow clients to subscribe to specific events: <pre><code>GET /sse?tenantId=acme&amp;events=question:created,question:upvoted\n</code></pre></p>"},{"location":"architecture/real-time/#4-compression","title":"4. Compression","text":"<p>Compress SSE payloads for bandwidth savings: <pre><code>res.setHeader('Content-Encoding', 'gzip');\n</code></pre></p>"},{"location":"architecture/real-time/#related-documentation","title":"Related Documentation","text":"<ul> <li>System Design - Overall architecture</li> <li>Multi-Tenancy Architecture - Tenant isolation</li> <li>API Reference - API endpoints</li> </ul>"},{"location":"architecture/real-time/#references","title":"References","text":"<ul> <li>MDN: Server-Sent Events</li> <li>EventSource API</li> <li>SSE Specification</li> </ul>"},{"location":"architecture/system-design/","title":"System Design","text":"<p>This document provides a comprehensive overview of PulseStage's architecture, design decisions, and technical implementation.</p>"},{"location":"architecture/system-design/#overview","title":"Overview","text":"<p>PulseStage is a production-ready, multi-tenant Q&amp;A platform designed for organizational town halls and all-hands meetings. It follows a three-tier architecture with modern best practices for security, scalability, and maintainability.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Users/Clients                         \u2502\n\u2502              (Browsers, Mobile, Integrations)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Presentation Layer                       \u2502\n\u2502                  React 19 + TypeScript + Vite                \u2502\n\u2502     \u2022 Real-time SSE \u2022 Dark Mode \u2022 Responsive Design         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Application Layer                       \u2502\n\u2502                 Node.js 24 + Express + TypeScript            \u2502\n\u2502   \u2022 RBAC Middleware \u2022 Multi-tenant Context \u2022 Rate Limiting   \u2502\n\u2502   \u2022 CSRF Protection \u2022 Audit Logging \u2022 SSE Broadcasting       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u25bc                       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Data Layer          \u2502  \u2502    Cache Layer      \u2502\n\u2502  PostgreSQL 16 + Prisma  \u2502  \u2502      Redis 7        \u2502\n\u2502  \u2022 Multi-tenant          \u2502  \u2502  \u2022 Rate Limits      \u2502\n\u2502  \u2022 Full-text Search      \u2502  \u2502  \u2022 Sessions         \u2502\n\u2502  \u2022 Audit Logs            \u2502  \u2502                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/system-design/#core-design-principles","title":"Core Design Principles","text":""},{"location":"architecture/system-design/#1-security-first","title":"1. Security First","text":"<p>Every layer implements defense-in-depth: - Authentication &amp; authorization at multiple layers - CSRF protection on all state-changing operations - Comprehensive audit logging - Security headers (CSP, HSTS, X-Frame-Options) - Rate limiting per tenant and per IP</p>"},{"location":"architecture/system-design/#2-multi-tenancy-by-default","title":"2. Multi-Tenancy by Default","text":"<p>Complete tenant isolation: - Automatic tenant context injection via middleware - Prisma middleware enforces tenant filtering on all queries - No cross-tenant data leakage - Per-tenant configuration and settings</p>"},{"location":"architecture/system-design/#3-real-time-first","title":"3. Real-Time First","text":"<p>Built for live collaboration: - Server-Sent Events (SSE) for instant updates - Per-tenant event broadcasting - Automatic connection management and cleanup - Heartbeat mechanism for connection health</p>"},{"location":"architecture/system-design/#4-developer-experience","title":"4. Developer Experience","text":"<p>Optimized for maintainability: - Type safety throughout (TypeScript strict mode) - Comprehensive test coverage (243+ tests) - Automated CI/CD with security scanning - Docker-based development workflow</p>"},{"location":"architecture/system-design/#system-components","title":"System Components","text":""},{"location":"architecture/system-design/#frontend-react-application","title":"Frontend (React Application)","text":"<p>Technology Stack: - React 19 with Hooks and Context API - TypeScript 5.9 (strict mode) - Tailwind CSS for styling - Vite 7 for build tooling - React Router 7 for navigation</p> <p>Key Features: - Component-based architecture with reusable UI components - Context providers for state management (Auth, Team, Theme, SSE) - Real-time updates via EventSource (SSE) - Dark mode with system preference detection - Responsive design (mobile-first)</p> <p>State Management: <pre><code>AuthContext \u2192 User authentication state\nTeamContext \u2192 Current team and available teams\nThemeContext \u2192 Dark/light mode preference\nSSEContext \u2192 Real-time event connection\n</code></pre></p>"},{"location":"architecture/system-design/#backend-api-server","title":"Backend (API Server)","text":"<p>Technology Stack: - Node.js 24 LTS - Express 4 web framework - TypeScript 5.9 (strict mode) - Prisma ORM for database access - Redis for caching and sessions</p> <p>Middleware Stack: <pre><code>Request Flow:\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  1. CORS &amp; Security Headers (Helmet)   \u2502\n  \u2502  2. Body Parser &amp; Cookie Parser         \u2502\n  \u2502  3. Tenant Resolver                     \u2502\n  \u2502  4. Session Management                  \u2502\n  \u2502  5. Mock Auth (dev) / SSO (prod)       \u2502\n  \u2502  6. CSRF Token Validation              \u2502\n  \u2502  7. Rate Limiting                       \u2502\n  \u2502  8. Permission Check (RBAC)            \u2502\n  \u2502  9. Team Scoping (for moderators)      \u2502\n  \u2502  10. Route Handler                      \u2502\n  \u2502  11. Audit Logging (on write ops)      \u2502\n  \u2502  12. SSE Event Broadcasting            \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"architecture/system-design/#database-postgresql","title":"Database (PostgreSQL)","text":"<p>Schema Design: - Normalized schema with proper foreign keys - Tenant-scoped data model (all tables include <code>tenantId</code>) - Full-text search with GIN indexes and tsvector - Audit log as append-only table - Cascading deletes for data integrity</p> <p>Key Tables: - <code>Tenant</code> - Organization/tenant isolation - <code>Team</code> - Departments or groups within a tenant - <code>Question</code> - User-submitted questions - <code>User</code> - User accounts (linked to SSO) - <code>TeamMembership</code> - User roles per team - <code>Tag</code> - Question categorization - <code>Upvote</code> - Individual upvote tracking (not just counts) - <code>AuditLog</code> - Immutable log of all admin actions</p> <p>Indexing Strategy: - Primary keys (UUID) - Foreign key indexes (automatic cascades) - Composite indexes: <code>(tenantId, status)</code>, <code>(tenantId, teamId)</code> - Full-text search: GIN index on <code>search_vector</code> column - Audit log: Descending index on <code>(tenantId, createdAt)</code></p>"},{"location":"architecture/system-design/#cache-layer-redis","title":"Cache Layer (Redis)","text":"<p>Usage: - Rate Limiting: Sliding window counters per tenant+IP - Session Storage: Server-side session data - Future: Cache frequently accessed data (teams, tags)</p> <p>Configuration: - Graceful degradation (memory fallback if Redis unavailable) - TTL-based expiration - Connection pooling</p>"},{"location":"architecture/system-design/#key-architectural-patterns","title":"Key Architectural Patterns","text":""},{"location":"architecture/system-design/#1-multi-tenant-context-pattern","title":"1. Multi-Tenant Context Pattern","text":"<p>Every request carries a tenant context:</p> <pre><code>// Tenant resolution (from subdomain, header, or session)\nRequest \u2192 Tenant Resolver Middleware \u2192 AsyncLocalStorage\n\n// Automatic tenant filtering in Prisma\nPrisma Middleware \u2192 Inject tenantId in all queries \u2192 Database\n</code></pre> <p>Benefits: - No manual tenant filtering in application code - Impossible to forget tenant checks - Centralized tenant context management</p>"},{"location":"architecture/system-design/#2-role-based-access-control-rbac","title":"2. Role-Based Access Control (RBAC)","text":"<p>Five-role hierarchy with permissions:</p> <pre><code>Viewer \u2192 Member \u2192 Moderator \u2192 Admin \u2192 Owner\n  \u2193        \u2193          \u2193          \u2193       \u2193\n Read    Submit    Answer+    Global   Full\n         Upvote    Tag+Pin     Admin   Control\n                   (Team-\n                   Scoped)\n</code></pre> <p>Permission Enforcement: - Middleware: <code>requirePermission('question.answer')</code> - Route-level: <code>requireRole('admin')</code> - Frontend: Conditional UI rendering based on role</p> <p>Team Scoping: - Moderators limited to assigned teams - Admins and Owners have global access - Team membership tracked in <code>TeamMembership</code> table</p>"},{"location":"architecture/system-design/#3-event-driven-real-time-updates","title":"3. Event-Driven Real-Time Updates","text":"<p>Server-Sent Events (SSE) for push updates:</p> <pre><code>// Event flow\nUser Action \u2192 API Handler \u2192 Database Update \u2192 \n  \u2192 eventBus.publish() \u2192 All Connected Clients (per tenant)\n\n// Event types\n- question:created\n- question:upvoted  \n- question:answered\n- question:tagged\n- question:pinned\n- question:frozen\n- heartbeat (keepalive)\n</code></pre> <p>Connection Management: - Per-tenant client tracking - Automatic dead connection cleanup - Periodic heartbeat (30s default) - Reconnection handling on client side</p>"},{"location":"architecture/system-design/#4-audit-logging-pattern","title":"4. Audit Logging Pattern","text":"<p>Immutable audit trail for compliance:</p> <pre><code>// Logged on every admin/moderator action\n{\n  actor: userId,\n  action: \"question.answer\",\n  entityType: \"Question\",\n  entityId: \"uuid\",\n  before: { status: \"OPEN\", responseText: null },\n  after: { status: \"ANSWERED\", responseText: \"Here's the answer...\" },\n  ipAddress: \"192.168.1.1\",\n  userAgent: \"Mozilla/5.0...\",\n  metadata: { teamName: \"Engineering\", questionPreview: \"...\" }\n}\n</code></pre> <p>Audit Log Uses: - Compliance and security tracking - Debug and troubleshooting - Moderation analytics - User activity reports</p>"},{"location":"architecture/system-design/#5-input-validation-pattern","title":"5. Input Validation Pattern","text":"<p>Zod schemas for type-safe validation:</p> <pre><code>// Shared validation schemas\nconst QuestionSchema = z.object({\n  body: z.string().min(3).max(2000),\n  teamId: z.string().uuid().optional()\n});\n\n// Runtime validation + TypeScript types\nconst validatedData = QuestionSchema.parse(req.body);\n</code></pre>"},{"location":"architecture/system-design/#scalability-considerations","title":"Scalability Considerations","text":""},{"location":"architecture/system-design/#current-capacity","title":"Current Capacity","text":"<p>Designed for: - 1,000+ concurrent users per tenant - 10,000+ questions per tenant - 100+ teams per tenant - 10+ tenants on shared infrastructure</p>"},{"location":"architecture/system-design/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>What scales: - \u2705 API servers (stateless, no shared memory) - \u2705 Database read replicas (PostgreSQL streaming replication) - \u2705 Redis cluster (distributed caching)</p> <p>What doesn't scale (yet): - \u26a0\ufe0f SSE connections (in-memory per API instance)   - Solution: Redis Pub/Sub for multi-instance broadcasting - \u26a0\ufe0f File uploads (if added in future)   - Solution: Object storage (S3, MinIO)</p>"},{"location":"architecture/system-design/#performance-optimizations","title":"Performance Optimizations","text":"<p>Current: - Database connection pooling - Prepared statements via Prisma - Indexed queries (all tenant-scoped queries use indexes) - Debounced search (client-side)</p> <p>Future: - Redis caching for read-heavy data (teams, tags) - CDN for static assets - Database query optimization (EXPLAIN ANALYZE) - Response compression (gzip/brotli)</p>"},{"location":"architecture/system-design/#security-architecture","title":"Security Architecture","text":""},{"location":"architecture/system-design/#defense-in-depth","title":"Defense in Depth","text":"<p>Layer 1: Network - HTTPS-only in production (HSTS header) - CORS restrictions - Rate limiting (per-tenant + per-IP)</p> <p>Layer 2: Application - Session-based authentication - CSRF token validation - Input validation (Zod schemas) - Output encoding (React XSS protection)</p> <p>Layer 3: Authorization - Role-based access control - Team-scoped permissions for moderators - Tenant isolation (automatic Prisma middleware)</p> <p>Layer 4: Data - Parameterized queries (Prisma ORM) - Audit logging (immutable records) - Database encryption at rest (hosting-dependent)</p>"},{"location":"architecture/system-design/#threat-model","title":"Threat Model","text":"<p>Mitigated Threats: - \u2705 SQL Injection (Prisma ORM) - \u2705 XSS (React escaping + CSP headers) - \u2705 CSRF (Double-submit cookie pattern) - \u2705 Clickjacking (X-Frame-Options: DENY) - \u2705 MIME sniffing (X-Content-Type-Options: nosniff) - \u2705 Privilege escalation (RBAC enforcement) - \u2705 Data leakage (tenant isolation) - \u2705 Brute force (rate limiting)</p> <p>Out of Scope: - DDoS protection (use CDN/load balancer) - Physical security (hosting provider responsibility) - Insider threats (organizational policies)</p>"},{"location":"architecture/system-design/#deployment-architecture","title":"Deployment Architecture","text":""},{"location":"architecture/system-design/#development","title":"Development","text":"<pre><code>Docker Compose (docker-compose.override.yaml):\n  - PostgreSQL (local)\n  - Redis (local)\n  - API (local build, hot reload)\n  - Web (local build, hot reload)\n</code></pre>"},{"location":"architecture/system-design/#production","title":"Production","text":"<pre><code>Docker Compose (docker-compose.yaml):\n  - PostgreSQL (persistent volume)\n  - Redis (persistent volume)\n  - API (ghcr.io/seanmdalton/pulsestage-api:latest)\n  - Web (ghcr.io/seanmdalton/pulsestage-web:latest)\n</code></pre> <p>Container Images: - Published to GitHub Container Registry - Multi-stage builds for minimal image size - Security scanning in CI (Trivy) - SBOM generation (SPDX + CycloneDX)</p>"},{"location":"architecture/system-design/#environment-variables","title":"Environment Variables","text":"<p>Required: - <code>DATABASE_URL</code> - PostgreSQL connection string - <code>REDIS_URL</code> - Redis connection string - <code>SESSION_SECRET</code> - Session encryption key - <code>ADMIN_KEY</code> - Admin authentication key - <code>CORS_ORIGIN</code> - Frontend URL</p> <p>Optional: - <code>NODE_ENV</code> - Environment (development/production) - <code>PORT</code> - API server port (default: 3000) - <code>SSE_HEARTBEAT_INTERVAL</code> - SSE heartbeat interval (ms)</p>"},{"location":"architecture/system-design/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"architecture/system-design/#current-capabilities","title":"Current Capabilities","text":"<p>Health Checks: - <code>/health</code> - Basic liveness probe - Future: <code>/admin/health</code> - Detailed metrics</p> <p>Logging: - Console logging (structured) - Audit logs in database - Future: OpenTelemetry tracing</p> <p>Metrics: - SSE connection counts - Rate limit hits - Database query performance - Future: Prometheus metrics</p>"},{"location":"architecture/system-design/#future-architecture-enhancements","title":"Future Architecture Enhancements","text":""},{"location":"architecture/system-design/#short-term-1-3-months","title":"Short-Term (1-3 months)","text":"<ol> <li>Redis Pub/Sub for SSE - Multi-instance SSE support</li> <li>Database Read Replicas - Scale read-heavy workloads</li> <li>Caching Layer - Redis cache for teams, tags, user data</li> <li>Health Dashboard - Real-time system metrics UI</li> </ol>"},{"location":"architecture/system-design/#medium-term-3-6-months","title":"Medium-Term (3-6 months)","text":"<ol> <li>OpenTelemetry Tracing - Distributed tracing and metrics</li> <li>Webhook System - Event-driven integrations</li> <li>Background Job Queue - Email, notifications, exports</li> <li>CDN Integration - Static asset distribution</li> </ol>"},{"location":"architecture/system-design/#long-term-6-12-months","title":"Long-Term (6-12 months)","text":"<ol> <li>Microservices Split - Separate auth, notifications, exports</li> <li>Multi-Region Deployment - Global edge presence</li> <li>GraphQL API - Flexible querying for integrations</li> <li>Event Sourcing - Complete audit trail with replay</li> </ol>"},{"location":"architecture/system-design/#technology-choices-rationale","title":"Technology Choices &amp; Rationale","text":"Technology Why We Chose It TypeScript Type safety, better DX, catch bugs at compile time React 19 Component model, hooks, large ecosystem Node.js 24 LTS JavaScript everywhere, non-blocking I/O, active LTS Express Mature, flexible, large middleware ecosystem Prisma Type-safe ORM, migrations, great DX PostgreSQL 16 Robust, full-text search, JSON support, mature Redis Fast in-memory cache, pub/sub, session storage Tailwind CSS Utility-first, fast development, consistent design Vite Fast HMR, modern build tool, great DX Docker Compose Simple orchestration, reproducible environments"},{"location":"architecture/system-design/#related-documentation","title":"Related Documentation","text":"<ul> <li>Multi-Tenancy Architecture - Detailed multi-tenant implementation</li> <li>Database Schema - ERD and schema details</li> <li>Real-Time Architecture - SSE implementation details</li> <li>Security Overview - Comprehensive security guide</li> <li>API Reference - REST API documentation</li> </ul>"},{"location":"architecture/system-design/#questions","title":"Questions?","text":"<p>For technical questions or suggestions, please: - Open a GitHub Issue - Start a Discussion - Check our Development Guide</p>"},{"location":"deployment/docker-compose/","title":"Docker Compose","text":"<p>Documentation coming soon...</p>"},{"location":"deployment/email-configuration/","title":"Email Configuration","text":"<p>PulseStage includes a flexible email notification system that supports multiple providers. This guide covers production email setup for real deployments.</p>"},{"location":"deployment/email-configuration/#overview","title":"Overview","text":"<p>Email notifications are sent when: - A user's question is answered by a moderator - Future: Welcome emails, moderator digests, weekly summaries (planned)</p> <p>Users can opt out of email notifications via their profile settings.</p>"},{"location":"deployment/email-configuration/#email-system-architecture","title":"Email System Architecture","text":"<pre><code>Question Answered\n       \u2193\n  Queue Email Job (Redis BullMQ)\n       \u2193\n  Email Worker (Background)\n       \u2193\n  Render React Email Template\n       \u2193\n  Send via Provider (SMTP/Resend)\n       \u2193\n  Audit Log (Success/Failure)\n</code></pre> <p>Key Components: - Queue: Redis BullMQ for reliable background processing - Worker: Processes 5 concurrent emails with 3 retry attempts - Templates: React Email components for type-safe, maintainable emails - Providers: Pluggable abstraction (SMTP, Resend, AWS SES, SendGrid)</p>"},{"location":"deployment/email-configuration/#supported-email-providers","title":"Supported Email Providers","text":""},{"location":"deployment/email-configuration/#1-resend-recommended-for-production","title":"1. Resend (Recommended for Production)","text":"<p>Best for: Modern SaaS deployments, easy setup, great developer experience</p> <p>Pros: - Simple API key authentication - Built-in domain verification - Excellent deliverability - Generous free tier (3,000 emails/month) - React Email native support</p> <p>Setup:</p> <ol> <li> <p>Sign up at resend.com</p> </li> <li> <p>Add and verify your domain:</p> </li> <li>Go to Domains \u2192 Add Domain</li> <li>Add DNS records (SPF, DKIM, DMARC) provided by Resend</li> <li> <p>Wait for verification (usually &lt; 5 minutes)</p> </li> <li> <p>Generate API key:</p> </li> <li>Go to API Keys \u2192 Create API Key</li> <li> <p>Copy the key (starts with <code>re_</code>)</p> </li> <li> <p>Configure environment variables:</p> </li> </ol> <pre><code># Email Provider\nEMAIL_PROVIDER=resend\nRESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxx\n\n# Email Sender (must be from your verified domain)\nEMAIL_FROM=noreply@yourdomain.com\nEMAIL_FROM_NAME=PulseStage\n\n# Frontend URL (for email links)\nFRONTEND_URL=https://yourdomain.com\n\n# Redis (required for email queue)\nREDIS_URL=redis://your-redis-server:6379\n</code></pre> <ol> <li>Test your configuration:</li> </ol> <pre><code># Restart the API service to pick up new environment variables\ndocker compose restart api\n\n# Check logs to verify email worker started\ndocker compose logs api | grep \"\ud83d\udce7 Email worker started\"\n</code></pre>"},{"location":"deployment/email-configuration/#2-smtp-sendgrid-aws-ses-custom","title":"2. SMTP (SendGrid, AWS SES, Custom)","text":"<p>Best for: Existing email infrastructure, enterprise compliance requirements</p> <p>Pros: - Works with any SMTP provider - Enterprise-friendly - Full control over infrastructure</p>"},{"location":"deployment/email-configuration/#option-a-sendgrid","title":"Option A: SendGrid","text":"<p>Setup:</p> <ol> <li> <p>Sign up at sendgrid.com</p> </li> <li> <p>Verify your sender identity:</p> </li> <li>Settings \u2192 Sender Authentication</li> <li> <p>Either verify a single email address (for testing) or your domain (for production)</p> </li> <li> <p>Create an API key:</p> </li> <li>Settings \u2192 API Keys \u2192 Create API Key</li> <li>Choose \"Full Access\" or \"Restricted Access\" with Mail Send permission</li> <li> <p>Copy the API key (starts with <code>SG.</code>)</p> </li> <li> <p>Configure environment variables:</p> </li> </ol> <pre><code># Email Provider\nEMAIL_PROVIDER=smtp\n\n# SMTP Configuration (SendGrid)\nSMTP_HOST=smtp.sendgrid.net\nSMTP_PORT=587\nSMTP_SECURE=true\nSMTP_USER=apikey\nSMTP_PASS=SG.xxxxxxxxxxxxxxxxxxxx\n\n# Email Sender\nEMAIL_FROM=noreply@yourdomain.com\nEMAIL_FROM_NAME=PulseStage\n\n# Frontend URL\nFRONTEND_URL=https://yourdomain.com\n\n# Redis\nREDIS_URL=redis://your-redis-server:6379\n</code></pre>"},{"location":"deployment/email-configuration/#option-b-aws-ses","title":"Option B: AWS SES","text":"<p>Setup:</p> <ol> <li>Verify your domain in AWS SES:</li> <li>AWS Console \u2192 SES \u2192 Verified Identities \u2192 Create Identity</li> <li> <p>Add DNS records (DKIM, SPF) to your domain</p> </li> <li> <p>Create SMTP credentials:</p> </li> <li>Account Dashboard \u2192 SMTP Settings \u2192 Create SMTP Credentials</li> <li> <p>Save the username and password</p> </li> <li> <p>Request production access (removes 200 emails/day limit):</p> </li> <li> <p>Account Dashboard \u2192 Sending Statistics \u2192 Request Production Access</p> </li> <li> <p>Configure environment variables:</p> </li> </ol> <pre><code># Email Provider\nEMAIL_PROVIDER=smtp\n\n# SMTP Configuration (AWS SES)\nSMTP_HOST=email-smtp.us-east-1.amazonaws.com  # Use your region\nSMTP_PORT=587\nSMTP_SECURE=true\nSMTP_USER=AKIAIOSFODNN7EXAMPLE  # Your SMTP username\nSMTP_PASS=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY  # Your SMTP password\n\n# Email Sender (must be verified in SES)\nEMAIL_FROM=noreply@yourdomain.com\nEMAIL_FROM_NAME=PulseStage\n\n# Frontend URL\nFRONTEND_URL=https://yourdomain.com\n\n# Redis\nREDIS_URL=redis://your-redis-server:6379\n</code></pre>"},{"location":"deployment/email-configuration/#option-c-generic-smtp-gmail-outlook-etc","title":"Option C: Generic SMTP (Gmail, Outlook, etc.)","text":"<p>\u26a0\ufe0f Not recommended for production - Use for development/testing only.</p> <pre><code># Email Provider\nEMAIL_PROVIDER=smtp\n\n# SMTP Configuration (Gmail example)\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_SECURE=true\nSMTP_USER=your-email@gmail.com\nSMTP_PASS=your-app-specific-password\n\n# Email Sender\nEMAIL_FROM=your-email@gmail.com\nEMAIL_FROM_NAME=PulseStage\n\n# Frontend URL\nFRONTEND_URL=https://yourdomain.com\n\n# Redis\nREDIS_URL=redis://your-redis-server:6379\n</code></pre> <p>Note: Gmail requires an \"App Password\" (not your regular password). Go to Google Account \u2192 Security \u2192 2-Step Verification \u2192 App Passwords.</p>"},{"location":"deployment/email-configuration/#environment-variables-reference","title":"Environment Variables Reference","text":""},{"location":"deployment/email-configuration/#required-for-all-providers","title":"Required for All Providers","text":"Variable Description Example <code>EMAIL_PROVIDER</code> Email service to use <code>smtp</code> or <code>resend</code> <code>EMAIL_FROM</code> Sender email address <code>noreply@yourdomain.com</code> <code>EMAIL_FROM_NAME</code> Sender display name <code>PulseStage</code> <code>FRONTEND_URL</code> Your frontend URL (for email links) <code>https://yourdomain.com</code> <code>REDIS_URL</code> or <code>REDIS_HOST</code> Redis connection for email queue <code>redis://redis:6379</code>"},{"location":"deployment/email-configuration/#smtp-specific-when-email_providersmtp","title":"SMTP-Specific (when <code>EMAIL_PROVIDER=smtp</code>)","text":"Variable Description Example Required <code>SMTP_HOST</code> SMTP server hostname <code>smtp.sendgrid.net</code> Yes <code>SMTP_PORT</code> SMTP server port <code>587</code> Yes <code>SMTP_SECURE</code> Use TLS (true for 465, false for 587) <code>true</code> or <code>false</code> Yes <code>SMTP_USER</code> SMTP username <code>apikey</code> No* <code>SMTP_PASS</code> SMTP password <code>SG.xxxxx</code> No* <p>*Required for authenticated SMTP. Leave empty for local Mailpit testing.</p>"},{"location":"deployment/email-configuration/#resend-specific-when-email_providerresend","title":"Resend-Specific (when <code>EMAIL_PROVIDER=resend</code>)","text":"Variable Description Example Required <code>RESEND_API_KEY</code> Resend API key <code>re_xxxxx</code> Yes"},{"location":"deployment/email-configuration/#optional","title":"Optional","text":"Variable Description Default <code>REDIS_PORT</code> Redis port <code>6379</code> <code>REDIS_PASSWORD</code> Redis password (empty)"},{"location":"deployment/email-configuration/#dns-configuration-for-email-deliverability","title":"DNS Configuration for Email Deliverability","text":"<p>To ensure your emails reach inboxes (not spam), configure these DNS records:</p>"},{"location":"deployment/email-configuration/#spf-sender-policy-framework","title":"SPF (Sender Policy Framework)","text":"<p>Authorizes your email provider to send on your behalf.</p> <p>Example for Resend: <pre><code>Type: TXT\nName: @\nValue: v=spf1 include:_spf.resend.com ~all\n</code></pre></p> <p>Example for SendGrid: <pre><code>Type: TXT\nName: @\nValue: v=spf1 include:sendgrid.net ~all\n</code></pre></p> <p>Example for AWS SES: <pre><code>Type: TXT\nName: @\nValue: v=spf1 include:amazonses.com ~all\n</code></pre></p>"},{"location":"deployment/email-configuration/#dkim-domainkeys-identified-mail","title":"DKIM (DomainKeys Identified Mail)","text":"<p>Cryptographically signs your emails.</p> <p>Your provider will give you specific DKIM records. Example from Resend: <pre><code>Type: TXT\nName: resend._domainkey\nValue: p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC...\n</code></pre></p>"},{"location":"deployment/email-configuration/#dmarc-domain-based-message-authentication","title":"DMARC (Domain-based Message Authentication)","text":"<p>Tells recipients what to do with emails that fail SPF/DKIM.</p> <p>Basic DMARC record: <pre><code>Type: TXT\nName: _dmarc\nValue: v=DMARC1; p=none; rua=mailto:dmarc@yourdomain.com\n</code></pre></p> <p>Production DMARC record (after testing): <pre><code>Type: TXT\nName: _dmarc\nValue: v=DMARC1; p=quarantine; rua=mailto:dmarc@yourdomain.com; pct=100\n</code></pre></p>"},{"location":"deployment/email-configuration/#testing-your-configuration","title":"Testing Your Configuration","text":""},{"location":"deployment/email-configuration/#1-verify-services-are-running","title":"1. Verify Services are Running","text":"<pre><code># Check API logs for email worker\ndocker compose logs api | grep \"\ud83d\udce7 Email worker started\"\n\n# Check Redis connectivity\ndocker compose exec api node -e \"const Redis = require('ioredis'); const r = new Redis({host:'redis'}); r.ping().then(console.log)\"\n</code></pre>"},{"location":"deployment/email-configuration/#2-send-a-test-email","title":"2. Send a Test Email","text":"<ol> <li>Log in to PulseStage as a regular user</li> <li>Submit a question in any team</li> <li>Log in as a moderator/admin</li> <li>Answer the question</li> <li>Check your email inbox (or your email provider's logs)</li> </ol>"},{"location":"deployment/email-configuration/#3-monitor-the-email-queue","title":"3. Monitor the Email Queue","text":"<p>Via API: <pre><code>curl https://yourdomain.com/admin/email-queue \\\n  -H \"X-Admin-Key: your-admin-key\"\n</code></pre></p> <p>Via Health Dashboard: - Log in as an admin - Navigate to Admin \u2192 Health Dashboard - View \"Email Queue\" section</p> <p>Expected healthy state: <pre><code>{\n  \"waiting\": 0,\n  \"active\": 0,\n  \"completed\": 150,\n  \"failed\": 0,\n  \"delayed\": 0,\n  \"paused\": false\n}\n</code></pre></p>"},{"location":"deployment/email-configuration/#4-check-logs","title":"4. Check Logs","text":"<pre><code># Watch for email activity\ndocker compose logs api -f | grep -E \"\ud83d\udce7|\u2705.*sent\"\n\n# Look for errors\ndocker compose logs api --tail 100 | grep -E \"error|Error|ERROR\"\n</code></pre>"},{"location":"deployment/email-configuration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/email-configuration/#emails-not-sending","title":"Emails Not Sending","text":"<p>Symptom: Questions are answered but no emails arrive.</p> <p>Diagnosis:</p> <ol> <li> <p>Check email worker started: <pre><code>docker compose logs api | grep \"\ud83d\udce7 Email worker started\"\n</code></pre>    If missing: Check <code>REDIS_URL</code> environment variable.</p> </li> <li> <p>Check if jobs are queued: <pre><code>curl https://yourdomain.com/admin/email-queue -H \"X-Admin-Key: your-key\"\n</code></pre>    If <code>waiting</code> &gt; 0: Jobs queued but not processing (worker issue).    If <code>failed</code> &gt; 0: Jobs failed (check logs for errors).</p> </li> <li> <p>Check for SMTP authentication errors: <pre><code>docker compose logs api --tail 100 | grep -i \"auth\"\n</code></pre>    Common issue: Wrong <code>SMTP_USER</code> or <code>SMTP_PASS</code>.</p> </li> <li> <p>Verify provider credentials:</p> </li> <li>Resend: Test API key at resend.com/api-keys</li> <li>SendGrid: Check key hasn't expired</li> <li>AWS SES: Verify SMTP credentials are correct</li> </ol>"},{"location":"deployment/email-configuration/#emails-going-to-spam","title":"Emails Going to Spam","text":"<p>Symptom: Emails arrive but in spam folder.</p> <p>Fix:</p> <ol> <li>Add SPF, DKIM, DMARC records (see DNS Configuration above)</li> <li>Verify your domain with your email provider</li> <li>Use a real domain (not <code>localhost</code>, <code>example.com</code>, etc.)</li> <li>Warm up your domain by sending gradually increasing volumes</li> <li>Check your sender reputation at mail-tester.com</li> </ol>"},{"location":"deployment/email-configuration/#high-email-failure-rate","title":"High Email Failure Rate","text":"<p>Symptom: Many jobs in <code>failed</code> status.</p> <p>Diagnosis:</p> <pre><code># Check recent failed jobs\ndocker compose exec redis redis-cli LRANGE \"bull:email:failed\" 0 10\n</code></pre> <p>Common causes: - Invalid recipient email addresses - Rate limiting by email provider (throttle sending) - Domain not verified - Quota exceeded</p> <p>Fix: - For transient errors: Jobs auto-retry 3 times with backoff - For permanent errors: Check audit logs and fix root cause</p>"},{"location":"deployment/email-configuration/#user-not-receiving-emails","title":"User Not Receiving Emails","text":"<p>Symptom: Some users report not getting notifications.</p> <p>Diagnosis:</p> <ol> <li>Check user's email preferences:</li> <li>User Profile \u2192 Settings \u2192 Email Notifications</li> <li> <p>Ensure \"Receive email notifications\" is enabled</p> </li> <li> <p>Verify email address is correct: <pre><code>docker compose exec db psql -U postgres -d ama \\\n  -c \"SELECT id, email FROM \\\"User\\\" WHERE email = 'user@example.com';\"\n</code></pre></p> </li> <li> <p>Check if email was sent: <pre><code>docker compose logs api | grep \"user@example.com\"\n</code></pre>    Should see: <code>\ud83d\udce7 Queued email notification for user@example.com</code></p> </li> </ol>"},{"location":"deployment/email-configuration/#monitoring-in-production","title":"Monitoring in Production","text":""},{"location":"deployment/email-configuration/#metrics-to-watch","title":"Metrics to Watch","text":"<ol> <li>Email Queue Size (<code>waiting</code>, <code>active</code>)</li> <li>Should typically be 0-5</li> <li> <p>Alert if &gt; 100 (backlog building up)</p> </li> <li> <p>Failed Email Rate (<code>failed</code> / <code>completed</code>)</p> </li> <li>Should be &lt; 1%</li> <li> <p>Alert if &gt; 5%</p> </li> <li> <p>Processing Time</p> </li> <li>Most emails should send within 5 seconds</li> <li>Alert if average &gt; 30 seconds</li> </ol>"},{"location":"deployment/email-configuration/#recommended-monitoring-setup","title":"Recommended Monitoring Setup","text":"<p>Option 1: Health Dashboard - Admin \u2192 Health Dashboard - Auto-refreshes every 5 seconds - Shows queue status, counts, and error rates</p> <p>Option 2: API Endpoint <pre><code># Add to your monitoring tool (Datadog, New Relic, etc.)\nGET /admin/email-queue\nGET /admin/health\n</code></pre></p> <p>Option 3: Logs <pre><code># Export logs to your log aggregation service\ndocker compose logs api -f | grep \"\ud83d\udce7\\|\u2705.*sent\\|\u274c.*failed\"\n</code></pre></p>"},{"location":"deployment/email-configuration/#user-email-preferences","title":"User Email Preferences","text":"<p>Users can control email notifications via their profile:</p> <ol> <li>Navigate to Profile</li> <li> <p>Click user menu (top right) \u2192 Profile</p> </li> <li> <p>Email Notifications Section</p> </li> <li>Toggle \"Receive email notifications when your questions are answered\"</li> <li>Changes save automatically</li> </ol> <p>Technical Implementation: - Stored in <code>UserPreferences</code> table (<code>emailNotifications</code> field) - Defaults to <code>true</code> for new users - Checked before queuing email jobs</p>"},{"location":"deployment/email-configuration/#adding-custom-email-templates","title":"Adding Custom Email Templates","text":"<p>See Development Guide: Email Templates for instructions on creating new email templates with React Email.</p>"},{"location":"deployment/email-configuration/#security-considerations","title":"Security Considerations","text":"<ol> <li>Protect API Keys:</li> <li>Never commit API keys to version control</li> <li>Use environment variables or secrets management (e.g., AWS Secrets Manager)</li> <li> <p>Rotate keys periodically</p> </li> <li> <p>Rate Limiting:</p> </li> <li>PulseStage automatically queues emails (no unbounded sending)</li> <li>BullMQ worker processes 5 concurrent emails max</li> <li> <p>Configure your email provider's rate limits</p> </li> <li> <p>Email Content:</p> </li> <li>All email content is HTML-escaped by React Email</li> <li>User input (question/answer text) is sanitized</li> <li> <p>Links include full URLs (no relative paths)</p> </li> <li> <p>Unsubscribe:</p> </li> <li>All emails include unsubscribe link (profile settings)</li> <li>Consider adding one-click unsubscribe header (future)</li> </ol>"},{"location":"deployment/email-configuration/#faq","title":"FAQ","text":"<p>Q: Can I use multiple email providers? A: No, only one provider can be active at a time. Set <code>EMAIL_PROVIDER</code> to either <code>smtp</code> or <code>resend</code>.</p> <p>Q: Does PulseStage support email attachments? A: Not currently. All emails are HTML + plain text only.</p> <p>Q: What happens if Redis goes down? A: New email jobs cannot be queued. Existing jobs remain in Redis and process when it recovers. No emails are lost.</p> <p>Q: Can I customize email templates? A: Yes! Email templates are React components in <code>api/src/emails/</code>. See development docs for details.</p> <p>Q: How do I test email without sending real emails? A: Use Mailpit for local development (see Email Testing Guide).</p> <p>Q: What's the maximum email throughput? A: BullMQ worker processes 5 concurrent emails. Typical rate: 50-100 emails/minute. Configurable in <code>emailQueue.ts</code>.</p> <p>Q: Are emails sent synchronously or asynchronously? A: Asynchronously. When a question is answered, the API queues the email and returns immediately. A background worker sends it within 1-5 seconds.</p> <p>Q: Can I see sent email history? A: Yes, via audit logs. Future: Admin UI for email history/analytics.</p>"},{"location":"deployment/email-configuration/#next-steps","title":"Next Steps","text":"<ul> <li>\u2705 Configure your email provider</li> <li>\u2705 Add DNS records for deliverability</li> <li>\u2705 Test with a few users</li> <li>\u2705 Monitor email queue in production</li> <li>\ud83d\udd1c Add custom email templates (future)</li> <li>\ud83d\udd1c Configure weekly digest emails (future)</li> <li>\ud83d\udd1c Set up email analytics dashboard (future)</li> </ul>"},{"location":"deployment/email-configuration/#resources","title":"Resources","text":"<ul> <li>React Email Documentation</li> <li>Resend Documentation</li> <li>SendGrid Documentation</li> <li>AWS SES Documentation</li> <li>BullMQ Documentation</li> <li>Mail Tester (Check Email Deliverability)</li> </ul>"},{"location":"deployment/environment/","title":"Environment Variables","text":"<p>This document provides a comprehensive reference for all environment variables used by PulseStage.</p>"},{"location":"deployment/environment/#quick-start","title":"Quick Start","text":"<p>Copy the example environment file and customize it for your deployment:</p> <pre><code>cp env.example .env\n</code></pre> <p>Then edit <code>.env</code> with your specific values.</p>"},{"location":"deployment/environment/#core-configuration","title":"Core Configuration","text":""},{"location":"deployment/environment/#database","title":"Database","text":"Variable Description Required Default Example <code>DATABASE_URL</code> PostgreSQL connection string \u2705 Yes - <code>postgresql://user:pass@host:5432/dbname</code> <p>Format: <code>postgresql://[user]:[password]@[host]:[port]/[database]?schema=[schema]</code></p> <p>Production recommendations: - Use connection pooling (e.g., PgBouncer) - Enable SSL: Add <code>?sslmode=require</code> to the URL - Use a dedicated database user with minimal permissions - Separate read replicas for analytics queries (future)</p>"},{"location":"deployment/environment/#redis","title":"Redis","text":"Variable Description Required Default Example <code>REDIS_URL</code> Full Redis connection string \u26a0\ufe0f One of <code>REDIS_URL</code> or <code>REDIS_HOST</code> - <code>redis://redis:6379</code> <code>REDIS_HOST</code> Redis hostname \u26a0\ufe0f One of <code>REDIS_URL</code> or <code>REDIS_HOST</code> <code>localhost</code> <code>redis</code> <code>REDIS_PORT</code> Redis port No <code>6379</code> <code>6379</code> <code>REDIS_PASSWORD</code> Redis authentication password No - <code>your-redis-password</code> <p>Used for: - Session storage - Rate limiting - Email queue (BullMQ)</p> <p>Production recommendations: - Enable authentication (<code>requirepass</code> in redis.conf) - Use Redis 7+ for best performance - Consider Redis Cluster for high availability - Monitor memory usage (set <code>maxmemory</code> policy)</p>"},{"location":"deployment/environment/#api-server","title":"API Server","text":"Variable Description Required Default Example <code>PORT</code> API server port No <code>3000</code> <code>3000</code> <code>NODE_ENV</code> Environment mode No <code>development</code> <code>production</code> <code>CORS_ORIGIN</code> Allowed CORS origins (comma-separated) \u2705 Yes <code>http://localhost:5173</code> <code>https://app.yourdomain.com,https://admin.yourdomain.com</code> <p><code>NODE_ENV</code> behavior: - <code>development</code>: Rate limiting disabled, verbose logging - <code>production</code>: Rate limiting enabled, error logging only</p> <p>CORS configuration: - Development: Use <code>http://localhost:5173</code> - Production: Use your actual frontend domain(s) - Multiple origins: Separate with commas (no spaces)</p>"},{"location":"deployment/environment/#admin-authentication","title":"Admin Authentication","text":"Variable Description Required Default Example <code>ADMIN_KEY</code> Admin API key for protected endpoints \u2705 Yes - <code>your-secure-random-string-min-32-chars</code> <p>\u26a0\ufe0f Security: - Generate a secure random string: <code>openssl rand -hex 32</code> - Never commit this to version control - Rotate periodically (every 90 days recommended) - Use your secrets manager in production (AWS Secrets Manager, HashiCorp Vault, etc.)</p> <p>Used for: - <code>/admin/*</code> endpoints - Health dashboard - Email queue status - System metrics</p>"},{"location":"deployment/environment/#multi-tenancy","title":"Multi-Tenancy","text":"Variable Description Required Default Example <code>MULTI_TENANT_MODE</code> Enable multi-tenant subdomain routing No <code>false</code> <code>true</code> or <code>false</code> <code>BASE_DOMAIN</code> Base domain for tenant resolution \u26a0\ufe0f Required if <code>MULTI_TENANT_MODE=true</code> - <code>pulsestage.com</code> <code>TENANT_HEADER</code> Header name for tenant override No <code>x-tenant-id</code> <code>x-tenant-slug</code> <p>Single-tenant mode (<code>MULTI_TENANT_MODE=false</code>): - One organization per deployment - Simpler setup, perfect for most use cases - Default tenant automatically created on first startup</p> <p>Multi-tenant mode (<code>MULTI_TENANT_MODE=true</code>): - Multiple organizations on one deployment - Subdomain-based routing: <code>acme.pulsestage.com</code> \u2192 ACME tenant - Requires <code>BASE_DOMAIN</code> to be set - See Multi-Tenancy Architecture for details</p> <p>Tenant resolution order (when <code>MULTI_TENANT_MODE=true</code>): 1. <code>x-tenant-id</code> or <code>x-tenant-slug</code> header (if present) 2. Subdomain extraction from <code>Host</code> header 3. Falls back to default tenant</p>"},{"location":"deployment/environment/#email-configuration","title":"Email Configuration","text":"<p>See Email Configuration Guide for complete setup instructions.</p>"},{"location":"deployment/environment/#core-email-settings","title":"Core Email Settings","text":"Variable Description Required Default Example <code>EMAIL_PROVIDER</code> Email service to use \u2705 Yes - <code>smtp</code> or <code>resend</code> <code>EMAIL_FROM</code> Sender email address \u2705 Yes - <code>noreply@yourdomain.com</code> <code>EMAIL_FROM_NAME</code> Sender display name No <code>PulseStage</code> <code>Your Company AMA</code> <code>FRONTEND_URL</code> Frontend URL for email links \u2705 Yes - <code>https://yourdomain.com</code>"},{"location":"deployment/environment/#smtp-configuration","title":"SMTP Configuration","text":"<p>Only required when <code>EMAIL_PROVIDER=smtp</code>.</p> Variable Description Required Default Example <code>SMTP_HOST</code> SMTP server hostname \u2705 Yes - <code>smtp.sendgrid.net</code> <code>SMTP_PORT</code> SMTP server port \u2705 Yes - <code>587</code> <code>SMTP_SECURE</code> Use TLS (true for 465, false for 587) \u2705 Yes - <code>true</code> or <code>false</code> <code>SMTP_USER</code> SMTP username \u26a0\ufe0f Usually required - <code>apikey</code> <code>SMTP_PASS</code> SMTP password \u26a0\ufe0f Usually required - <code>SG.xxxxx</code> <p>Common SMTP providers: - SendGrid: <code>smtp.sendgrid.net:587</code>, user=<code>apikey</code>, pass=<code>SG.xxxxx</code> - AWS SES: <code>email-smtp.us-east-1.amazonaws.com:587</code>, SMTP credentials from IAM - Mailgun: <code>smtp.mailgun.org:587</code>, username/password from Mailgun - Gmail (dev only): <code>smtp.gmail.com:587</code>, use App Password</p>"},{"location":"deployment/environment/#resend-configuration","title":"Resend Configuration","text":"<p>Only required when <code>EMAIL_PROVIDER=resend</code>.</p> Variable Description Required Default Example <code>RESEND_API_KEY</code> Resend API key \u2705 Yes - <code>re_xxxxxxxxxxxxx</code> <p>Setup: 1. Sign up at resend.com 2. Verify your sending domain 3. Generate API key (starts with <code>re_</code>)</p>"},{"location":"deployment/environment/#server-sent-events-sse","title":"Server-Sent Events (SSE)","text":"Variable Description Required Default Example <code>SSE_HEARTBEAT_INTERVAL</code> Heartbeat interval in milliseconds No <code>30000</code> (30s) <code>15000</code> <p>Purpose: Keep SSE connections alive through proxies/load balancers.</p> <p>Recommendations: - Default (30s) works for most deployments - Lower (15s) if connections drop frequently - Higher (60s) to reduce server load (if stable network)</p>"},{"location":"deployment/environment/#frontend-configuration","title":"Frontend Configuration","text":"Variable Description Required Default Example <code>WEBSITE_TITLE</code> Browser tab title No <code>PulseStage</code> <code>Your Company AMA</code> <p>Note: Frontend-specific variables are configured in <code>web/.env</code> (not shown here). See <code>web/README.md</code>.</p>"},{"location":"deployment/environment/#development-only-variables","title":"Development-Only Variables","text":"<p>These are used for local development and testing. Do not use in production.</p> Variable Description Default Example <code>MOCK_AUTH</code> Enable mock SSO authentication <code>false</code> <code>true</code> <code>LOG_LEVEL</code> Logging verbosity <code>info</code> <code>debug</code>"},{"location":"deployment/environment/#example-configurations","title":"Example Configurations","text":""},{"location":"deployment/environment/#local-development-docker-composeoverrideyaml","title":"Local Development (docker-compose.override.yaml)","text":"<pre><code>environment:\n  DATABASE_URL: postgresql://app:app@db:5432/ama\n  REDIS_URL: redis://redis:6379\n  CORS_ORIGIN: http://localhost:5173\n  NODE_ENV: development\n  ADMIN_KEY: dev-admin-key\n\n  # Email (Mailpit)\n  EMAIL_PROVIDER: smtp\n  SMTP_HOST: mailpit\n  SMTP_PORT: 1025\n  SMTP_SECURE: false\n  EMAIL_FROM: noreply@pulsestage.local\n  FRONTEND_URL: http://localhost:5173\n\n  # Single-tenant mode\n  MULTI_TENANT_MODE: false\n</code></pre>"},{"location":"deployment/environment/#production-awsdigitaloceanetc","title":"Production (AWS/DigitalOcean/etc.)","text":"<pre><code># Database\nDATABASE_URL=postgresql://pulsestage:SECURE_PASSWORD@db.internal:5432/pulsestage?sslmode=require\n\n# Redis\nREDIS_URL=redis://:SECURE_REDIS_PASSWORD@redis.internal:6379\n\n# API\nPORT=3000\nNODE_ENV=production\nCORS_ORIGIN=https://ama.yourcompany.com\nADMIN_KEY=&lt;generated-with-openssl-rand-hex-32&gt;\n\n# Email (Resend)\nEMAIL_PROVIDER=resend\nRESEND_API_KEY=re_xxxxxxxxxxxx\nEMAIL_FROM=noreply@yourcompany.com\nEMAIL_FROM_NAME=Company AMA\nFRONTEND_URL=https://ama.yourcompany.com\n\n# Single-tenant\nMULTI_TENANT_MODE=false\n</code></pre>"},{"location":"deployment/environment/#production-multi-tenant-saas","title":"Production Multi-Tenant (SaaS)","text":"<pre><code># Database\nDATABASE_URL=postgresql://pulsestage:SECURE_PASSWORD@db.internal:5432/pulsestage?sslmode=require\n\n# Redis\nREDIS_URL=redis://:SECURE_REDIS_PASSWORD@redis.internal:6379\n\n# API\nPORT=3000\nNODE_ENV=production\nCORS_ORIGIN=https://*.pulsestage.com\nADMIN_KEY=&lt;generated-with-openssl-rand-hex-32&gt;\n\n# Email (Resend)\nEMAIL_PROVIDER=resend\nRESEND_API_KEY=re_xxxxxxxxxxxx\nEMAIL_FROM=noreply@pulsestage.com\nEMAIL_FROM_NAME=PulseStage\nFRONTEND_URL=https://pulsestage.com\n\n# Multi-tenant\nMULTI_TENANT_MODE=true\nBASE_DOMAIN=pulsestage.com\n</code></pre>"},{"location":"deployment/environment/#security-best-practices","title":"Security Best Practices","text":""},{"location":"deployment/environment/#1-never-commit-secrets","title":"1. Never Commit Secrets","text":"<pre><code># \u274c Bad: Committed .env file\ngit add .env\ngit commit -m \"Add config\"\n\n# \u2705 Good: .env is in .gitignore\ngit add env.example\ngit commit -m \"Add example config\"\n</code></pre>"},{"location":"deployment/environment/#2-use-secrets-management","title":"2. Use Secrets Management","text":"<p>Development: - Store in <code>.env</code> file (already ignored by git) - Share securely via 1Password, LastPass, etc.</p> <p>Production: - AWS: Secrets Manager, Systems Manager Parameter Store - Kubernetes: Secrets, External Secrets Operator - Docker Swarm: Docker Secrets - Ansible: Ansible Vault</p>"},{"location":"deployment/environment/#3-rotate-credentials-regularly","title":"3. Rotate Credentials Regularly","text":"Credential Rotation Frequency <code>ADMIN_KEY</code> Every 90 days Database password Every 180 days Redis password Every 180 days Email API keys Every 180 days or on compromise"},{"location":"deployment/environment/#4-principle-of-least-privilege","title":"4. Principle of Least Privilege","text":"<ul> <li>Database user: Only <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> (no <code>DROP</code>, <code>ALTER</code>)</li> <li>Redis: Use ACLs if available (Redis 6+)</li> <li>Email API keys: Restricted to \"Mail Send\" permission only</li> </ul>"},{"location":"deployment/environment/#validation","title":"Validation","text":"<p>Check your configuration is correct:</p> <pre><code># Check API starts without errors\ndocker compose up -d api\ndocker compose logs api --tail 50\n\n# Verify database connection\ndocker compose exec api npx prisma db pull\n\n# Verify Redis connection\ndocker compose exec api node -e \"const Redis = require('ioredis'); const r = new Redis({host:'redis'}); r.ping().then(console.log)\"\n\n# Verify email configuration\ncurl http://localhost:3000/admin/email-queue \\\n  -H \"X-Admin-Key: your-admin-key\"\n</code></pre>"},{"location":"deployment/environment/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/environment/#api-wont-start","title":"API won't start","text":"<p>Check logs: <pre><code>docker compose logs api --tail 100\n</code></pre></p> <p>Common issues: - <code>DATABASE_URL</code> malformed \u2192 Check syntax - Can't connect to Redis \u2192 Verify <code>REDIS_URL</code> and Redis is running - <code>ADMIN_KEY</code> not set \u2192 Add to environment variables</p>"},{"location":"deployment/environment/#cors-errors-in-browser","title":"CORS errors in browser","text":"<p>Symptom: Console shows \"CORS policy: No 'Access-Control-Allow-Origin' header\"</p> <p>Fix: Ensure <code>CORS_ORIGIN</code> matches your frontend URL exactly.</p> <pre><code># Development\nCORS_ORIGIN=http://localhost:5173\n\n# Production\nCORS_ORIGIN=https://ama.yourcompany.com\n</code></pre>"},{"location":"deployment/environment/#emails-not-sending","title":"Emails not sending","text":"<p>See Email Configuration Guide.</p>"},{"location":"deployment/environment/#reference","title":"Reference","text":"<p>For more information: - Production Deployment Guide - Email Configuration - Multi-Tenancy Architecture - Security Overview</p>"},{"location":"deployment/monitoring/","title":"Monitoring","text":"<p>Documentation coming soon...</p>"},{"location":"deployment/production-checklist/","title":"Production Deployment Checklist","text":"<p>This checklist ensures all security and operational requirements are met before deploying PulseStage to production.</p>"},{"location":"deployment/production-checklist/#security-secrets","title":"\ud83d\udd10 Security &amp; Secrets","text":""},{"location":"deployment/production-checklist/#required-secrets","title":"Required Secrets","text":"<ul> <li> Generate secure secrets: <code>cd api &amp;&amp; npm run generate-secrets</code></li> <li> <code>SESSION_SECRET</code> set (min 32 characters)</li> <li> <code>CSRF_SECRET</code> set (min 32 characters)</li> <li> <code>ADMIN_KEY</code> set (min 32 characters)</li> <li> All secrets stored in secure secrets manager (e.g., Vault, AWS Secrets Manager)</li> <li> No default/example secrets in use (<code>change-me</code>, <code>test</code>, etc.)</li> <li> Secrets rotated from development/staging environments</li> </ul>"},{"location":"deployment/production-checklist/#environment-configuration","title":"Environment Configuration","text":"<ul> <li> <code>NODE_ENV=production</code> set</li> <li> <code>DATABASE_URL</code> configured with production credentials</li> <li> Database password changed from default (<code>app:app</code>)</li> <li> Connection pool parameters configured in <code>DATABASE_URL</code>:   <pre><code>?connection_limit=20&amp;pool_timeout=60&amp;connect_timeout=10\n</code></pre></li> </ul>"},{"location":"deployment/production-checklist/#cors-networking","title":"CORS &amp; Networking","text":"<ul> <li> <code>CORS_ORIGINS</code> set to comma-separated allowlist (no wildcard <code>*</code>)</li> <li> <code>CORS_ORIGIN</code> removed or matches first <code>CORS_ORIGINS</code> entry</li> <li> Frontend URL configured in <code>FRONTEND_URL</code></li> <li> All URLs use HTTPS (no HTTP in production)</li> </ul>"},{"location":"deployment/production-checklist/#authentication","title":"Authentication","text":"<ul> <li> OAuth credentials configured (GitHub and/or Google)</li> <li> <code>GITHUB_CLIENT_ID</code> and <code>GITHUB_CLIENT_SECRET</code> set</li> <li> <code>GITHUB_CALLBACK_URL</code> points to production domain</li> <li> <code>GOOGLE_CLIENT_ID</code> and <code>GOOGLE_CLIENT_SECRET</code> set (if using Google)</li> <li> <code>GOOGLE_CALLBACK_URL</code> points to production domain</li> <li> Demo mode disabled (automatic in <code>NODE_ENV=production</code>)</li> </ul>"},{"location":"deployment/production-checklist/#infrastructure","title":"\ud83d\uddc4\ufe0f Infrastructure","text":""},{"location":"deployment/production-checklist/#redis","title":"Redis","text":"<ul> <li> Redis server deployed and accessible</li> <li> <code>REDIS_URL</code> configured (not localhost)</li> <li> Redis password set (if applicable)</li> <li> Redis persistence enabled (AOF or RDB)</li> <li> Redis memory limits configured</li> <li> Redis monitoring enabled</li> </ul>"},{"location":"deployment/production-checklist/#database","title":"Database","text":"<ul> <li> PostgreSQL 14+ deployed</li> <li> Database backups configured (automated daily)</li> <li> Point-in-time recovery enabled</li> <li> Database connection limits configured</li> <li> Database monitoring enabled</li> <li> Migrations run: <code>cd api &amp;&amp; npx prisma migrate deploy</code></li> </ul>"},{"location":"deployment/production-checklist/#email-optional","title":"Email (Optional)","text":"<ul> <li> Email provider configured (<code>EMAIL_PROVIDER=smtp</code> or <code>resend</code>)</li> <li> SMTP credentials set (if using SMTP)</li> <li> Resend API key set (if using Resend)</li> <li> <code>EMAIL_FROM</code> and <code>EMAIL_FROM_NAME</code> configured</li> <li> Test email sent successfully</li> </ul>"},{"location":"deployment/production-checklist/#application","title":"\ud83c\udfd7\ufe0f Application","text":""},{"location":"deployment/production-checklist/#docker-deployment","title":"Docker &amp; Deployment","text":"<ul> <li> Docker images built from main branch</li> <li> Images scanned for vulnerabilities (Trivy)</li> <li> Images pushed to container registry</li> <li> Health check endpoints configured:</li> <li>Liveness: <code>GET /health/live</code></li> <li>Readiness: <code>GET /health/ready</code></li> <li> Resource limits set (CPU, memory)</li> <li> Horizontal Pod Autoscaling configured (if using Kubernetes)</li> </ul>"},{"location":"deployment/production-checklist/#monitoring-observability","title":"Monitoring &amp; Observability","text":"<ul> <li> Application logs forwarded to centralized logging</li> <li> Error tracking configured (e.g., Sentry)</li> <li> Uptime monitoring configured</li> <li> Alerts configured for:</li> <li>High error rate (&gt;5%)</li> <li>High response time (&gt;2s p95)</li> <li>Database connection failures</li> <li>Redis connection failures</li> <li>High memory usage (&gt;80%)</li> <li> Dashboards created for key metrics</li> </ul>"},{"location":"deployment/production-checklist/#performance","title":"Performance","text":"<ul> <li> CDN configured for static assets (if applicable)</li> <li> Compression enabled (gzip/brotli)</li> <li> Rate limiting tested and verified</li> <li> Database indexes verified</li> <li> Slow query monitoring enabled</li> </ul>"},{"location":"deployment/production-checklist/#testing","title":"\ud83e\uddea Testing","text":""},{"location":"deployment/production-checklist/#pre-deployment-tests","title":"Pre-Deployment Tests","text":"<ul> <li> Run pre-flight check: <code>cd api &amp;&amp; npm run preflight-check</code></li> <li> All tests passing: <code>cd api &amp;&amp; npm test</code></li> <li> Linting passing: <code>cd api &amp;&amp; npm run lint</code></li> <li> Security scan passing: <code>npm run security</code></li> <li> Load testing completed (if applicable)</li> </ul>"},{"location":"deployment/production-checklist/#smoke-tests-post-deployment","title":"Smoke Tests (Post-Deployment)","text":"<ul> <li> Health endpoints responding:   <pre><code>curl https://api.yourdomain.com/health/live\ncurl https://api.yourdomain.com/health/ready\n</code></pre></li> <li> OAuth login flow working</li> <li> Question submission working</li> <li> Email notifications working (if configured)</li> <li> SSE events delivering</li> <li> Admin dashboard accessible</li> </ul>"},{"location":"deployment/production-checklist/#deployment-process","title":"\ud83d\udd04 Deployment Process","text":""},{"location":"deployment/production-checklist/#before-deployment","title":"Before Deployment","text":"<ol> <li> Review all changes since last deployment</li> <li> Run full test suite locally</li> <li> Create database backup</li> <li> Notify team of deployment window</li> <li> Have rollback plan ready</li> </ol>"},{"location":"deployment/production-checklist/#during-deployment","title":"During Deployment","text":"<ol> <li> Deploy database migrations first (if any)</li> <li> Deploy API service with zero-downtime strategy</li> <li> Deploy frontend service</li> <li> Monitor error rates and response times</li> <li> Verify health checks passing</li> </ol>"},{"location":"deployment/production-checklist/#after-deployment","title":"After Deployment","text":"<ol> <li> Run smoke tests</li> <li> Monitor logs for errors (15 minutes)</li> <li> Verify user traffic flowing normally</li> <li> Update deployment documentation</li> <li> Notify team of successful deployment</li> </ol>"},{"location":"deployment/production-checklist/#rollback-plan","title":"\ud83d\udea8 Rollback Plan","text":"<p>If issues are detected:</p> <ol> <li> <p>Immediate Rollback <pre><code># Roll back to previous Docker images\nkubectl rollout undo deployment/pulsestage-api\nkubectl rollout undo deployment/pulsestage-web\n</code></pre></p> </li> <li> <p>Database Rollback</p> </li> <li>If migrations were applied, restore from backup</li> <li> <p>Document rollback procedure in incident report</p> </li> <li> <p>Communication</p> </li> <li>Notify team of rollback</li> <li>Create incident report</li> <li>Schedule post-mortem</li> </ol>"},{"location":"deployment/production-checklist/#success-criteria","title":"\ud83d\udcca Success Criteria","text":"<p>Deployment is considered successful when:</p> <ul> <li> All health checks passing for 15 minutes</li> <li> Error rate &lt; 1%</li> <li> p95 response time &lt; 500ms</li> <li> No critical errors in logs</li> <li> User traffic flowing normally</li> <li> All smoke tests passing</li> </ul>"},{"location":"deployment/production-checklist/#helpful-commands","title":"\ud83d\udd17 Helpful Commands","text":"<pre><code># Generate production secrets\ncd api &amp;&amp; npm run generate-secrets\n\n# Run pre-flight checks\ncd api &amp;&amp; npm run preflight-check\n\n# Test database connection\npsql \"$DATABASE_URL\" -c \"SELECT 1\"\n\n# Test Redis connection\nredis-cli -u \"$REDIS_URL\" ping\n\n# Check health endpoints\ncurl https://api.yourdomain.com/health/live\ncurl https://api.yourdomain.com/health/ready\n\n# View application logs\nkubectl logs -f deployment/pulsestage-api --tail=100\ndocker compose logs -f api --tail=100\n\n# Database backup\npg_dump \"$DATABASE_URL\" &gt; backup-$(date +%Y%m%d-%H%M%S).sql\n\n# Database restore\npsql \"$DATABASE_URL\" &lt; backup-YYYYMMDD-HHMMSS.sql\n</code></pre>"},{"location":"deployment/production-checklist/#support-contacts","title":"\ud83d\udcde Support Contacts","text":"<ul> <li>On-Call Engineer: [Contact Info]</li> <li>Database Admin: [Contact Info]</li> <li>Infrastructure Team: [Contact Info]</li> <li>Security Team: [Contact Info]</li> </ul>"},{"location":"deployment/production-checklist/#additional-resources","title":"\ud83d\udcda Additional Resources","text":"<ul> <li>Architecture Documentation</li> <li>Security Guidelines</li> <li>Monitoring Setup</li> <li>Troubleshooting Guide</li> </ul> <p>Last Updated: 2025-01-14 Next Review: 2025-04-14 (Quarterly)</p>"},{"location":"deployment/production-runbook/","title":"Production Runbook","text":"<p>Quick reference guide for common production operations and incident response.</p>"},{"location":"deployment/production-runbook/#quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"deployment/production-runbook/#check-system-status","title":"Check System Status","text":"<pre><code># Health checks\ncurl https://api.yourdomain.com/health/live\ncurl https://api.yourdomain.com/health/ready\n\n# Detailed metrics (requires admin authentication)\ncurl -H \"Authorization: Bearer $ADMIN_KEY\" \\\n  https://api.yourdomain.com/admin/health\n</code></pre>"},{"location":"deployment/production-runbook/#view-logs","title":"View Logs","text":"<pre><code># Kubernetes\nkubectl logs -f deployment/pulsestage-api --tail=100\nkubectl logs -f deployment/pulsestage-web --tail=100\n\n# Docker Compose\ndocker compose logs -f api --tail=100\ndocker compose logs -f web --tail=100\n\n# Follow errors only\nkubectl logs -f deployment/pulsestage-api | grep ERROR\n</code></pre>"},{"location":"deployment/production-runbook/#common-operations","title":"\ud83d\udd27 Common Operations","text":""},{"location":"deployment/production-runbook/#restart-services","title":"Restart Services","text":"<pre><code># Kubernetes - rolling restart (zero downtime)\nkubectl rollout restart deployment/pulsestage-api\nkubectl rollout restart deployment/pulsestage-web\n\n# Docker Compose\ndocker compose restart api\ndocker compose restart web\n\n# Full redeploy\ndocker compose down &amp;&amp; docker compose up -d\n</code></pre>"},{"location":"deployment/production-runbook/#scale-services","title":"Scale Services","text":"<pre><code># Kubernetes - scale to 3 replicas\nkubectl scale deployment/pulsestage-api --replicas=3\n\n# Check scaling status\nkubectl get pods -w\n</code></pre>"},{"location":"deployment/production-runbook/#database-operations","title":"Database Operations","text":"<pre><code># Create backup\npg_dump \"$DATABASE_URL\" | gzip &gt; backup-$(date +%Y%m%d-%H%M%S).sql.gz\n\n# List recent backups\nls -lth backup-*.sql.gz | head -10\n\n# Restore from backup\ngunzip -c backup-YYYYMMDD-HHMMSS.sql.gz | psql \"$DATABASE_URL\"\n\n# Run migrations\ncd api &amp;&amp; npx prisma migrate deploy\n\n# Check migration status\ncd api &amp;&amp; npx prisma migrate status\n\n# Check database connections\npsql \"$DATABASE_URL\" -c \"SELECT count(*) FROM pg_stat_activity WHERE datname = current_database()\"\n</code></pre>"},{"location":"deployment/production-runbook/#redis-operations","title":"Redis Operations","text":"<pre><code># Check Redis connection\nredis-cli -u \"$REDIS_URL\" ping\n\n# Monitor Redis commands\nredis-cli -u \"$REDIS_URL\" monitor\n\n# Check memory usage\nredis-cli -u \"$REDIS_URL\" info memory\n\n# Flush all keys (DANGEROUS - only for emergencies)\nredis-cli -u \"$REDIS_URL\" flushall\n\n# Check specific session\nredis-cli -u \"$REDIS_URL\" keys \"ama-session:*\" | head -10\n</code></pre>"},{"location":"deployment/production-runbook/#secret-rotation","title":"Secret Rotation","text":"<pre><code># 1. Generate new secrets\ncd api &amp;&amp; npm run generate-secrets\n\n# 2. Update secrets in secrets manager\n# (AWS Secrets Manager, Vault, etc.)\n\n# 3. Update deployment configuration\nkubectl edit secret pulsestage-secrets\n\n# 4. Rolling restart to pick up new secrets\nkubectl rollout restart deployment/pulsestage-api\n\n# 5. Verify no authentication errors\nkubectl logs deployment/pulsestage-api | grep -i \"session\\|csrf\" | tail -50\n</code></pre>"},{"location":"deployment/production-runbook/#incident-response","title":"\ud83d\udea8 Incident Response","text":""},{"location":"deployment/production-runbook/#high-error-rate","title":"High Error Rate","text":"<pre><code># 1. Check recent errors\nkubectl logs deployment/pulsestage-api --since=10m | grep ERROR | tail -50\n\n# 2. Check error distribution\nkubectl logs deployment/pulsestage-api --since=1h | grep ERROR | \\\n  awk '{print $NF}' | sort | uniq -c | sort -rn\n\n# 3. Check health status\ncurl https://api.yourdomain.com/health/ready\n\n# 4. If database issue - check connections\npsql \"$DATABASE_URL\" -c \"SELECT * FROM pg_stat_activity WHERE state = 'active'\"\n\n# 5. If Redis issue - check Redis\nredis-cli -u \"$REDIS_URL\" info stats\n</code></pre>"},{"location":"deployment/production-runbook/#high-response-times","title":"High Response Times","text":"<pre><code># 1. Check slow queries in last hour\nkubectl logs deployment/pulsestage-api --since=1h | grep \"Slow query\"\n\n# 2. Check database query times\npsql \"$DATABASE_URL\" -c \"\n  SELECT query, mean_exec_time, calls \n  FROM pg_stat_statements \n  ORDER BY mean_exec_time DESC \n  LIMIT 10\n\"\n\n# 3. Check memory usage\nkubectl top pods | grep pulsestage\n\n# 4. Check CPU usage\nkubectl top nodes\n</code></pre>"},{"location":"deployment/production-runbook/#database-connection-failures","title":"Database Connection Failures","text":"<pre><code># 1. Check if database is accessible\npsql \"$DATABASE_URL\" -c \"SELECT 1\"\n\n# 2. Check current connections\npsql \"$DATABASE_URL\" -c \"\n  SELECT count(*), state \n  FROM pg_stat_activity \n  GROUP BY state\n\"\n\n# 3. Check connection limits\npsql \"$DATABASE_URL\" -c \"SHOW max_connections\"\n\n# 4. Terminate idle connections (if at limit)\npsql \"$DATABASE_URL\" -c \"\n  SELECT pg_terminate_backend(pid)\n  FROM pg_stat_activity\n  WHERE state = 'idle'\n  AND query_start &lt; NOW() - INTERVAL '10 minutes'\n\"\n\n# 5. Restart API to reset connection pool\nkubectl rollout restart deployment/pulsestage-api\n</code></pre>"},{"location":"deployment/production-runbook/#redis-connection-failures","title":"Redis Connection Failures","text":"<pre><code># 1. Check Redis availability\nredis-cli -u \"$REDIS_URL\" ping\n\n# 2. Check Redis memory\nredis-cli -u \"$REDIS_URL\" info memory\n\n# 3. If Redis is down - restart Redis\ndocker compose restart redis  # or kubectl restart\n\n# 4. After Redis is back - restart API\nkubectl rollout restart deployment/pulsestage-api\n\n# 5. Monitor for reconnection\nkubectl logs -f deployment/pulsestage-api | grep -i redis\n</code></pre>"},{"location":"deployment/production-runbook/#out-of-memory-oom","title":"Out of Memory (OOM)","text":"<pre><code># 1. Check current memory usage\nkubectl top pods | grep pulsestage\n\n# 2. Check memory limits\nkubectl describe pod &lt;pod-name&gt; | grep -A 5 \"Limits\"\n\n# 3. Review application logs for memory leaks\nkubectl logs deployment/pulsestage-api | grep \"heap\\|memory\"\n\n# 4. Restart pod to recover\nkubectl delete pod &lt;pod-name&gt;\n\n# 5. Increase memory limits if needed\nkubectl edit deployment pulsestage-api\n# Update resources.limits.memory\n</code></pre>"},{"location":"deployment/production-runbook/#session-issues-users-logged-out","title":"Session Issues / Users Logged Out","text":"<pre><code># 1. Check Redis session store\nredis-cli -u \"$REDIS_URL\" keys \"ama-session:*\" | wc -l\n\n# 2. Check session TTL\nredis-cli -u \"$REDIS_URL\" ttl \"ama-session:&lt;session-id&gt;\"\n\n# 3. Verify SESSION_SECRET hasn't changed\nkubectl get secret pulsestage-secrets -o jsonpath='{.data.SESSION_SECRET}' | base64 -d | wc -c\n# Should be 32+ characters\n\n# 4. Check for Redis flushall events\nredis-cli -u \"$REDIS_URL\" info stats | grep total_commands_processed\n</code></pre>"},{"location":"deployment/production-runbook/#rate-limiting-issues","title":"Rate Limiting Issues","text":"<pre><code># 1. Check rate limit keys in Redis\nredis-cli -u \"$REDIS_URL\" keys \"rate:*\"\n\n# 2. Check specific user's rate limits\nredis-cli -u \"$REDIS_URL\" keys \"rate:*:&lt;ip-address&gt;\"\n\n# 3. Clear rate limits for specific IP (emergency)\nredis-cli -u \"$REDIS_URL\" del \"rate:/questions:*:&lt;ip-address&gt;\"\n\n# 4. Monitor rate limit hits\nkubectl logs deployment/pulsestage-api | grep \"rate limit\" | tail -50\n</code></pre>"},{"location":"deployment/production-runbook/#performance-tuning","title":"\ud83d\udcca Performance Tuning","text":""},{"location":"deployment/production-runbook/#database-optimization","title":"Database Optimization","text":"<pre><code># Analyze table statistics\npsql \"$DATABASE_URL\" -c \"ANALYZE\"\n\n# Check index usage\npsql \"$DATABASE_URL\" -c \"\n  SELECT schemaname, tablename, indexname, idx_scan\n  FROM pg_stat_user_indexes\n  WHERE idx_scan &lt; 100\n  ORDER BY idx_scan\n\"\n\n# Check table bloat\npsql \"$DATABASE_URL\" -c \"\n  SELECT schemaname, tablename,\n    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename))\n  FROM pg_tables\n  WHERE schemaname NOT IN ('pg_catalog', 'information_schema')\n  ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC\n\"\n</code></pre>"},{"location":"deployment/production-runbook/#redis-optimization","title":"Redis Optimization","text":"<pre><code># Check Redis slow log\nredis-cli -u \"$REDIS_URL\" slowlog get 10\n\n# Check key space\nredis-cli -u \"$REDIS_URL\" --bigkeys\n\n# Check eviction stats\nredis-cli -u \"$REDIS_URL\" info stats | grep evicted\n</code></pre>"},{"location":"deployment/production-runbook/#security-operations","title":"\ud83d\udd10 Security Operations","text":""},{"location":"deployment/production-runbook/#audit-log-review","title":"Audit Log Review","text":"<pre><code># Check recent admin actions\ncurl -H \"Authorization: Bearer $ADMIN_KEY\" \\\n  \"https://api.yourdomain.com/admin/audit?limit=50\" | jq '.'\n\n# Check failed authentication attempts\nkubectl logs deployment/pulsestage-api | \\\n  grep \"Unauthorized\\|Forbidden\" | tail -50\n</code></pre>"},{"location":"deployment/production-runbook/#security-scan","title":"Security Scan","text":"<pre><code># Run Trivy scan on current image\ntrivy image ghcr.io/yourusername/pulsestage-api:latest\n\n# Run Semgrep on codebase\ncd api &amp;&amp; npx semgrep --config=auto .\n</code></pre>"},{"location":"deployment/production-runbook/#monitoring-queries","title":"\ud83d\udcc8 Monitoring Queries","text":""},{"location":"deployment/production-runbook/#key-metrics","title":"Key Metrics","text":"<pre><code># Active users (last 15 minutes)\npsql \"$DATABASE_URL\" -c \"\n  SELECT COUNT(DISTINCT author_id)\n  FROM questions\n  WHERE created_at &gt; NOW() - INTERVAL '15 minutes'\n\"\n\n# Questions per hour\npsql \"$DATABASE_URL\" -c \"\n  SELECT date_trunc('hour', created_at) as hour, COUNT(*)\n  FROM questions\n  WHERE created_at &gt; NOW() - INTERVAL '24 hours'\n  GROUP BY hour\n  ORDER BY hour DESC\n\"\n\n# Average response time (from logs)\nkubectl logs deployment/pulsestage-api --since=1h | \\\n  grep \"responded in\" | awk '{print $(NF-1)}' | \\\n  awk '{sum+=$1; count++} END {print sum/count \"ms\"}'\n</code></pre>"},{"location":"deployment/production-runbook/#deployment-rollback","title":"\ud83d\udd04 Deployment Rollback","text":""},{"location":"deployment/production-runbook/#quick-rollback","title":"Quick Rollback","text":"<pre><code># 1. Rollback API\nkubectl rollout undo deployment/pulsestage-api\n\n# 2. Rollback Web\nkubectl rollout undo deployment/pulsestage-web\n\n# 3. Check rollback status\nkubectl rollout status deployment/pulsestage-api\nkubectl rollout status deployment/pulsestage-web\n\n# 4. Verify health\ncurl https://api.yourdomain.com/health/ready\n</code></pre>"},{"location":"deployment/production-runbook/#database-rollback","title":"Database Rollback","text":"<pre><code># 1. Stop application\nkubectl scale deployment/pulsestage-api --replicas=0\n\n# 2. Restore database\ngunzip -c backup-YYYYMMDD-HHMMSS.sql.gz | psql \"$DATABASE_URL\"\n\n# 3. Run migrations (if needed)\ncd api &amp;&amp; npx prisma migrate deploy\n\n# 4. Restart application\nkubectl scale deployment/pulsestage-api --replicas=3\n</code></pre>"},{"location":"deployment/production-runbook/#escalation-contacts","title":"\ud83d\udcde Escalation Contacts","text":"Issue Type Contact Response Time Critical Outage On-Call Engineer Immediate Database Issues Database Team 15 minutes Security Incident Security Team Immediate Network Issues Infrastructure Team 30 minutes"},{"location":"deployment/production-runbook/#additional-resources","title":"\ud83d\udcda Additional Resources","text":"<ul> <li>Troubleshooting Guide</li> <li>Architecture Documentation</li> <li>Monitoring Setup</li> <li>Security Guidelines</li> </ul> <p>Last Updated: 2025-01-14 Maintained By: DevOps Team</p>"},{"location":"deployment/production/","title":"Production","text":"<p>Documentation coming soon...</p>"},{"location":"development/code-review/","title":"PulseStage - Comprehensive Code Review","text":"<p>Date: October 6, 2025 Version: 0.1.x Status: Pre-feature-development audit</p>"},{"location":"development/code-review/#executive-summary","title":"Executive Summary","text":"<p>This document provides a comprehensive review of the PulseStage codebase to establish a solid foundation before adding new features.</p>"},{"location":"development/code-review/#1-architecture-overview","title":"1. Architecture Overview","text":""},{"location":"development/code-review/#system-components","title":"System Components","text":"<ul> <li>API: Node.js 24 + Express + TypeScript + Prisma</li> <li>Web: React 19 + TypeScript + Vite + Tailwind CSS</li> <li>Database: PostgreSQL 16 with full-text search</li> <li>Cache: Redis 7 for rate limiting</li> <li>Deployment: Docker Compose with multi-stage builds</li> </ul>"},{"location":"development/code-review/#multi-tenancy","title":"Multi-Tenancy","text":"<ul> <li>\u2705 Tenant resolution via header (<code>x-tenant-id</code>) or query parameter</li> <li>\u2705 Prisma middleware for tenant scoping</li> <li>\u2705 Auto-bootstrap creates default tenant on first startup</li> <li>\u2705 Seed scripts support multi-tenant data</li> </ul>"},{"location":"development/code-review/#authentication-authorization","title":"Authentication &amp; Authorization","text":"<ul> <li>\u2705 Mock SSO for development (header-based: <code>x-mock-sso-user</code>, <code>x-tenant-id</code>)</li> <li>\u2705 Admin API key protection (<code>x-admin-key</code>)</li> <li>\u2705 Session-based auth with Redis store</li> <li>\u2705 CSRF protection on state-changing requests</li> <li>\u2705 Role-based access control (viewer, member, moderator, admin, owner)</li> <li>\u26a0\ufe0f TODO: Real SSO integration (OIDC/SAML) for production</li> </ul>"},{"location":"development/code-review/#2-api-layer-review","title":"2. API Layer Review","text":""},{"location":"development/code-review/#strengths","title":"Strengths","text":"<ul> <li>\u2705 Comprehensive test coverage (214 tests passing, 47.31%)</li> <li>\u2705 Zod validation on all inputs</li> <li>\u2705 Consistent error handling with ApiError class</li> <li>\u2705 Rate limiting on all endpoints (Redis-based)</li> <li>\u2705 Security headers (Helmet, CSP, HSTS)</li> <li>\u2705 Audit logging for sensitive operations</li> <li>\u2705 OpenAPI documentation (<code>/docs</code>)</li> <li>\u2705 Server-Sent Events for real-time updates</li> <li>\u2705 Graceful startup with database health checks</li> </ul>"},{"location":"development/code-review/#areas-for-review","title":"Areas for Review","text":""},{"location":"development/code-review/#21-server-sent-events-sse","title":"2.1 Server-Sent Events (SSE)","text":"<p>Location: <code>api/src/app.ts</code> (lines ~2100-2150)</p> <p>Current Implementation: <pre><code>app.get('/events', (req, res) =&gt; {\n  // Prioritize query param over middleware tenant\n  if (req.query.tenant) {\n    tenantId = req.query.tenant as string;\n  } else if (req.tenant) {\n    tenantId = req.tenant.id;\n  }\n  // ...\n});\n</code></pre></p> <p>Status: \u2705 Fixed - Query parameter now takes precedence for EventSource compatibility</p> <p>Recommendation: Document this behavior in OpenAPI spec</p>"},{"location":"development/code-review/#22-tag-management","title":"2.2 Tag Management","text":"<p>Location: <code>api/src/app.ts</code> (tag creation/deletion endpoints)</p> <p>Current Implementation: - Uses <code>prisma.questionTag.create()</code> and handles <code>P2002</code> (unique constraint) gracefully - Treats existing records as success (idempotent operations)</p> <p>Status: \u2705 Reviewed and approved</p> <p>Rationale: Idempotent tag operations prevent race conditions in presentation mode when multiple clients add the same tag</p>"},{"location":"development/code-review/#23-middleware-chain","title":"2.3 Middleware Chain","text":"<p>Location: <code>api/src/middleware/</code></p> <p>Current Order: 1. Helmet (security headers) 2. CORS 3. Session 4. Rate limiting (disabled in dev) 5. Mock SSO or real auth 6. Tenant resolution 7. CSRF protection</p> <p>Status: \u2705 Logical and consistent</p>"},{"location":"development/code-review/#24-environment-variables","title":"2.4 Environment Variables","text":"<p>Location: <code>api/src/env.ts</code></p> <p>Status: \u2705 Comprehensive validation with Zod - All required vars validated at startup - Sensible defaults for development - Clear error messages for missing/invalid values</p> <p>Recommendation: None - well implemented</p>"},{"location":"development/code-review/#3-frontend-layer-review","title":"3. Frontend Layer Review","text":""},{"location":"development/code-review/#strengths_1","title":"Strengths","text":"<ul> <li>\u2705 Context-based state management (User, Team, Admin, Theme)</li> <li>\u2705 Custom hooks for common patterns (<code>useDebounce</code>, <code>useTeamFromUrl</code>)</li> <li>\u2705 Type-safe API client with error handling</li> <li>\u2705 Real-time updates via SSE hook</li> <li>\u2705 Responsive design with dark mode</li> <li>\u2705 Accessibility considerations (aria-labels, semantic HTML)</li> </ul>"},{"location":"development/code-review/#areas-for-review_1","title":"Areas for Review","text":""},{"location":"development/code-review/#31-context-providers","title":"3.1 Context Providers","text":"<p>Location: <code>web/src/contexts/</code></p> <p>Current Structure: <pre><code>&lt;ThemeProvider&gt;\n  &lt;AdminProvider&gt;\n    &lt;UserProvider&gt;\n      &lt;TeamProvider&gt;\n        &lt;App /&gt;\n</code></pre></p> <p>Status: \u2705 Proper dependency order - Theme is independent (outermost) - Admin has no dependencies - User depends on Admin (for auth) - Team depends on User (for memberships)</p> <p>Recommendation: Document this dependency chain in code comments</p>"},{"location":"development/code-review/#32-api-client","title":"3.2 API Client","text":"<p>Location: <code>web/src/lib/api.ts</code></p> <p>Current Implementation: - Adds <code>x-mock-sso-user</code> and <code>x-tenant-id</code> headers from localStorage - Handles 401/403/404/409 errors consistently - Returns typed responses</p> <p>Status: \u2705 Well structured</p> <p>Potential Issue: localStorage-based auth is not secure for production Recommendation: Replace with HTTP-only cookies when real SSO is implemented</p>"},{"location":"development/code-review/#33-presentation-mode","title":"3.3 Presentation Mode","text":"<p>Location: <code>web/src/pages/PresentationPage.tsx</code></p> <p>Recent Fixes: - \u2705 Handles 409 Conflict when creating tags (refetches existing tag) - \u2705 Bulk tag operations for efficiency - \u2705 Real-time updates via SSE</p> <p>Status: \u2705 Robust and tested</p> <p>Recommendation: Add error boundary to gracefully handle unexpected failures</p>"},{"location":"development/code-review/#34-team-selector","title":"3.4 Team Selector","text":"<p>Location: <code>web/src/components/TeamSelector.tsx</code></p> <p>Recent Enhancement: - \u2705 Role badges for all user roles (owner, admin, moderator, member) - \u2705 Color-coded for easy identification</p> <p>Status: \u2705 Complete</p>"},{"location":"development/code-review/#4-database-layer-review","title":"4. Database Layer Review","text":""},{"location":"development/code-review/#schema","title":"Schema","text":"<p>Location: <code>api/prisma/schema.prisma</code></p> <p>Status: \u2705 Well-normalized with proper relationships</p> <p>Key Relations: - Tenant \u2192 Team (1:many) - Team \u2192 Question (1:many) - User \u2192 TeamMember (1:many) - Question \u2192 QuestionTag (many:many via join table)</p> <p>Indexes: - \u2705 Full-text search index on Question.searchVector (GIN) - \u2705 Foreign key indexes for joins - \u2705 Unique constraints on critical fields</p> <p>Recommendation: None - schema is production-ready</p>"},{"location":"development/code-review/#migrations","title":"Migrations","text":"<p>Location: <code>api/prisma/migrations/</code></p> <p>Status: \u2705 Idempotent and safe</p> <p>Key Migration: <code>add_fulltext_search.sql</code> - Creates trigger for automatic search_vector updates - Uses PostgreSQL GIN index for fast prefix matching</p> <p>Recommendation: None</p>"},{"location":"development/code-review/#5-security-review","title":"5. Security Review","text":""},{"location":"development/code-review/#current-measures","title":"Current Measures","text":"<ul> <li>\u2705 Helmet security headers (CSP, HSTS, X-Frame-Options)</li> <li>\u2705 CSRF protection with <code>csrf-csrf</code> library</li> <li>\u2705 Rate limiting (Redis-based, configurable per endpoint)</li> <li>\u2705 Input validation (Zod schemas)</li> <li>\u2705 SQL injection protection (Prisma parameterized queries)</li> <li>\u2705 XSS protection (React automatic escaping + CSP)</li> <li>\u2705 Admin API key authentication</li> <li>\u2705 Audit logging for sensitive operations</li> </ul>"},{"location":"development/code-review/#known-limitations","title":"Known Limitations","text":"<ul> <li>\u26a0\ufe0f Mock SSO is development-only (clearly documented)</li> <li>\u26a0\ufe0f Admin key is basic (should use proper admin auth in production)</li> <li>\u26a0\ufe0f localStorage for auth tokens (should use HTTP-only cookies)</li> </ul>"},{"location":"development/code-review/#vulnerability-scanning","title":"Vulnerability Scanning","text":"<ul> <li>\u2705 No production vulnerabilities (npm audit)</li> <li>\u2705 Dependabot enabled for automated updates</li> <li>\u2705 Docker images scanned in CI</li> </ul> <p>Recommendation: Add OWASP ZAP or similar for dynamic security testing</p>"},{"location":"development/code-review/#6-testing-review","title":"6. Testing Review","text":""},{"location":"development/code-review/#current-coverage","title":"Current Coverage","text":"<ul> <li>API: 214 tests, 47.31% coverage</li> <li>Unit tests for middleware</li> <li>Integration tests for endpoints</li> <li> <p>Test data setup with Prisma</p> </li> <li> <p>Web: E2E tests with Playwright</p> </li> <li>Happy path test (submit, upvote, answer, present)</li> </ul>"},{"location":"development/code-review/#gaps","title":"Gaps","text":"<ul> <li>\u26a0\ufe0f Frontend unit tests missing (no React Testing Library tests)</li> <li>\u26a0\ufe0f Multi-tenant test scenarios limited</li> <li>\u26a0\ufe0f Performance/load tests not implemented</li> </ul> <p>Recommendation:  1. Add React component tests (priority: contexts, hooks) 2. Add more E2E scenarios (moderation, admin, multi-user) 3. Consider k6 or similar for load testing</p>"},{"location":"development/code-review/#7-docker-deployment-review","title":"7. Docker &amp; Deployment Review","text":""},{"location":"development/code-review/#current-setup","title":"Current Setup","text":"<ul> <li>\u2705 Multi-stage builds for minimal image sizes</li> <li>\u2705 Published images on GitHub Container Registry</li> <li>\u2705 <code>docker-compose.yaml</code> for production</li> <li>\u2705 <code>docker-compose.override.yaml</code> for local development builds</li> <li>\u2705 Health checks and startup ordering</li> <li>\u2705 Wait-for-database logic in API startup</li> </ul>"},{"location":"development/code-review/#configuration","title":"Configuration","text":"<ul> <li>\u2705 Environment variables for all config</li> <li>\u2705 Secure default for secrets generation (<code>setup.sh</code>)</li> <li>\u2705 Clear documentation in README</li> </ul> <p>Recommendation: Add docker-compose.prod.yaml with production-grade settings (resource limits, restart policies, logging)</p>"},{"location":"development/code-review/#8-documentation-review","title":"8. Documentation Review","text":""},{"location":"development/code-review/#current-state","title":"Current State","text":"<ul> <li>\u2705 Comprehensive README with quick start</li> <li>\u2705 Documentation site (GitHub Pages with MkDocs)</li> <li>\u2705 API documentation (OpenAPI/Swagger at <code>/docs</code>)</li> <li>\u2705 Architecture diagrams</li> <li>\u2705 Development setup guide</li> <li>\u2705 Security policy</li> </ul>"},{"location":"development/code-review/#gaps_1","title":"Gaps","text":"<ul> <li>\u26a0\ufe0f CODE_OF_CONDUCT.md missing</li> <li>\u26a0\ufe0f CONTRIBUTING.md incomplete</li> <li>\u26a0\ufe0f Issue templates missing</li> </ul> <p>Recommendation: Add these (see Track 2 below)</p>"},{"location":"development/code-review/#9-code-quality-review","title":"9. Code Quality Review","text":""},{"location":"development/code-review/#strengths_2","title":"Strengths","text":"<ul> <li>\u2705 TypeScript throughout (strict mode)</li> <li>\u2705 Consistent code style</li> <li>\u2705 Descriptive variable/function names</li> <li>\u2705 Error handling with proper types</li> <li>\u2705 ESLint configured for both API and Web</li> </ul>"},{"location":"development/code-review/#areas-for-improvement","title":"Areas for Improvement","text":"<ul> <li>\u26a0\ufe0f Some long functions (e.g., <code>loadQuestions</code> in PresentationPage: ~100 lines)</li> <li>\u26a0\ufe0f Magic numbers in some places (e.g., rate limit values)</li> <li>\u26a0\ufe0f TODO comments scattered throughout</li> </ul> <p>Recommendation:  1. Extract complex logic into separate functions 2. Create constants file for magic numbers 3. Track TODOs in GitHub Issues instead of code comments</p>"},{"location":"development/code-review/#10-known-technical-debt","title":"10. Known Technical Debt","text":""},{"location":"development/code-review/#high-priority","title":"High Priority","text":"<ol> <li>Real SSO Integration: Mock SSO is dev-only, need OIDC/SAML</li> <li>Admin Authentication: Replace simple API key with proper auth</li> <li>Frontend Test Coverage: Add React component tests</li> </ol>"},{"location":"development/code-review/#medium-priority","title":"Medium Priority","text":"<ol> <li>Error Boundaries: Add to key UI components</li> <li>Code Splitting: Lazy load routes for better performance</li> <li>API Response Caching: Add ETags or similar for GET endpoints</li> </ol>"},{"location":"development/code-review/#low-priority","title":"Low Priority","text":"<ol> <li>Refactor Long Functions: Break down complex components</li> <li>Centralize Constants: Magic numbers and strings</li> <li>Storybook: Add for component documentation</li> </ol>"},{"location":"development/code-review/#11-logical-consistency-check","title":"11. Logical Consistency Check","text":""},{"location":"development/code-review/#data-flow","title":"Data Flow","text":"<ol> <li>User Authentication: localStorage \u2192 API headers \u2192 Mock SSO middleware \u2192 Session</li> <li>Tenant Resolution: URL/header \u2192 Middleware \u2192 Prisma context \u2192 Scoped queries</li> <li>Real-time Updates: Question change \u2192 Broadcast via SSE \u2192 Frontend EventSource \u2192 UI update</li> </ol> <p>Status: \u2705 Consistent and well-documented</p>"},{"location":"development/code-review/#state-management","title":"State Management","text":"<ul> <li>Frontend: React Context for global state, local state for component-specific</li> <li>Backend: Stateless API with Redis for sessions</li> <li>Database: Single source of truth</li> </ul> <p>Status: \u2705 Proper separation of concerns</p>"},{"location":"development/code-review/#error-handling","title":"Error Handling","text":"<ul> <li>API: Consistent error responses (ApiError class)</li> <li>Frontend: Try-catch with user-friendly messages</li> <li>Database: Prisma errors mapped to HTTP status codes</li> </ul> <p>Status: \u2705 Comprehensive error handling</p>"},{"location":"development/code-review/#12-pre-push-checklist","title":"12. Pre-Push Checklist","text":""},{"location":"development/code-review/#code","title":"Code","text":"<ul> <li> All tests passing (214/214)</li> <li> No linter errors</li> <li> No production npm vulnerabilities</li> <li> TypeScript strict mode enabled</li> <li> Docker builds successful</li> </ul>"},{"location":"development/code-review/#documentation","title":"Documentation","text":"<ul> <li> README up to date</li> <li> API docs current</li> <li> Architecture docs reflect reality</li> <li> CODE_OF_CONDUCT.md (creating in Track 2)</li> <li> CONTRIBUTING.md (creating in Track 2)</li> <li> Issue templates (creating in Track 2)</li> </ul>"},{"location":"development/code-review/#security","title":"Security","text":"<ul> <li> Secrets not committed</li> <li> Security headers configured</li> <li> Input validation complete</li> <li> Audit logging in place</li> </ul>"},{"location":"development/code-review/#deployment","title":"Deployment","text":"<ul> <li> Published Docker images working</li> <li> Fresh install tested</li> <li> Seed scripts functional</li> <li> Auto-bootstrap working</li> </ul>"},{"location":"development/code-review/#13-recommendations-summary","title":"13. Recommendations Summary","text":""},{"location":"development/code-review/#immediate-before-new-features","title":"Immediate (Before New Features)","text":"<ol> <li>\u2705 Complete GitHub community standards (Track 2)</li> <li>\u2705 Add error boundaries to key components</li> <li>\u2705 Document context provider dependency chain</li> <li>\u2705 Create GitHub Issues for TODO comments</li> </ol>"},{"location":"development/code-review/#short-term-next-sprint","title":"Short Term (Next Sprint)","text":"<ol> <li>Add React component tests (target: 50% coverage)</li> <li>Add more E2E test scenarios</li> <li>Refactor long functions (&gt;100 lines)</li> <li>Implement error boundaries</li> </ol>"},{"location":"development/code-review/#medium-term-next-2-3-sprints","title":"Medium Term (Next 2-3 Sprints)","text":"<ol> <li>Real SSO integration (OIDC)</li> <li>Proper admin authentication system</li> <li>API response caching (ETags)</li> <li>Load/performance testing</li> </ol>"},{"location":"development/code-review/#long-term-backlog","title":"Long Term (Backlog)","text":"<ol> <li>Code splitting and lazy loading</li> <li>Storybook for component docs</li> <li>Multi-region deployment guide</li> <li>Advanced analytics dashboard</li> </ol>"},{"location":"development/code-review/#14-conclusion","title":"14. Conclusion","text":"<p>Overall Assessment: \u2705 SOLID FOUNDATION</p> <p>The codebase is well-structured, thoroughly tested, and production-ready for the core features. The architecture is logical and consistent, with proper separation of concerns.</p> <p>Key Strengths: - Comprehensive test coverage on critical paths - Security-first approach with multiple layers - Well-documented with clear setup process - Multi-tenant architecture from the start - Real-time capabilities with SSE</p> <p>Key Risks: - Mock SSO limits production deployment - Frontend test coverage needs improvement - Some technical debt in component complexity</p> <p>Recommendation: \u2705 APPROVED to proceed with new features after completing Track 2 (GitHub community standards).</p>"},{"location":"development/code-review/#appendix-file-structure","title":"Appendix: File Structure","text":"<pre><code>ama-app/\n\u251c\u2500\u2500 api/                    # Backend API\n\u2502   \u251c\u2500\u2500 src/\n\u2502   \u2502   \u251c\u2500\u2500 app.ts         # Main Express app (2700+ lines - consider splitting)\n\u2502   \u2502   \u251c\u2500\u2500 env.ts         # Environment validation\n\u2502   \u2502   \u251c\u2500\u2500 server.ts      # HTTP server entry point\n\u2502   \u2502   \u2514\u2500\u2500 middleware/    # Auth, rate limiting, etc.\n\u2502   \u251c\u2500\u2500 prisma/\n\u2502   \u2502   \u251c\u2500\u2500 schema.prisma  # Database schema\n\u2502   \u2502   \u2514\u2500\u2500 migrations/    # SQL migrations\n\u2502   \u251c\u2500\u2500 dist/              # Compiled JavaScript\n\u2502   \u2514\u2500\u2500 coverage/          # Test coverage reports\n\u2502\n\u251c\u2500\u2500 web/                   # Frontend\n\u2502   \u251c\u2500\u2500 src/\n\u2502   \u2502   \u251c\u2500\u2500 components/    # React components\n\u2502   \u2502   \u251c\u2500\u2500 contexts/      # React contexts\n\u2502   \u2502   \u251c\u2500\u2500 hooks/         # Custom hooks\n\u2502   \u2502   \u251c\u2500\u2500 pages/         # Page components\n\u2502   \u2502   \u251c\u2500\u2500 lib/           # API client, types\n\u2502   \u2502   \u2514\u2500\u2500 utils/         # Helper functions\n\u2502   \u2514\u2500\u2500 e2e/              # Playwright tests\n\u2502\n\u251c\u2500\u2500 docs/                  # MkDocs documentation\n\u251c\u2500\u2500 .github/               # GitHub workflows, templates\n\u2514\u2500\u2500 docker-compose.yaml    # Production deployment\n</code></pre> <p>Reviewed By: AI Assistant Next Review: After implementing new features Sign-off: Pending user approval</p>"},{"location":"development/code-style/","title":"Code Style","text":"<p>Documentation coming soon...</p>"},{"location":"development/contributing/","title":"Contributing to PulseStage","text":"<p>Thank you for your interest in contributing to PulseStage! This guide provides guidelines and instructions for contributing to our open-source Q&amp;A platform.</p> <p>Code of Conduct</p> <p>This project and everyone participating in it is governed by our Code of Conduct. By participating, you are expected to uphold this code.</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":""},{"location":"development/contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js: Version 24 LTS or higher</li> <li>Docker &amp; Docker Compose: For running the full stack locally</li> <li>Git: For version control  </li> <li>npm: Comes with Node.js</li> </ul>"},{"location":"development/contributing/#repository-structure","title":"Repository Structure","text":"<pre><code>pulsestage/\n\u251c\u2500\u2500 api/                 # Backend API (Node.js/Express/TypeScript)\n\u251c\u2500\u2500 web/                 # Frontend (React/TypeScript)\n\u251c\u2500\u2500 docs/                # Documentation (MkDocs)\n\u251c\u2500\u2500 docker-compose.yaml  # Main Docker configuration\n\u251c\u2500\u2500 setup.sh            # Setup script\n\u2514\u2500\u2500 README.md           # Project overview\n</code></pre>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":""},{"location":"development/contributing/#1-fork-and-clone","title":"1. Fork and Clone","text":"<ol> <li>Fork the repository on GitHub</li> <li>Clone your fork locally:    <pre><code>git clone https://github.com/YOUR_USERNAME/pulsestage.git\ncd pulsestage\n</code></pre></li> </ol>"},{"location":"development/contributing/#2-initial-setup","title":"2. Initial Setup","text":"<p>Run the setup script to install dependencies and prepare the environment:</p> <pre><code>./setup.sh\n</code></pre> <p>This script will:</p> <ul> <li>Install dependencies for both API and web applications</li> <li>Set up environment files</li> <li>Build Docker images</li> <li>Start the database and Redis services</li> </ul>"},{"location":"development/contributing/#3-start-development-environment","title":"3. Start Development Environment","text":"<pre><code># Start the full stack with Docker\ndocker compose up -d\n\n# Visit http://localhost:5173 and follow the Setup Wizard\n</code></pre> <p>See Local Development for more details.</p>"},{"location":"development/contributing/#making-changes","title":"Making Changes","text":""},{"location":"development/contributing/#branch-strategy","title":"Branch Strategy","text":"<ol> <li> <p>Create a feature branch from <code>main</code>:    <pre><code>git checkout main\ngit pull origin main\ngit checkout -b feature/your-feature-name\n</code></pre></p> </li> <li> <p>Branch naming conventions:</p> </li> <li><code>feature/description</code> - New features</li> <li><code>fix/description</code> - Bug fixes</li> <li><code>docs/description</code> - Documentation updates</li> <li><code>refactor/description</code> - Code refactoring</li> <li><code>test/description</code> - Test improvements</li> </ol>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":"<ol> <li>Make your changes following our coding standards</li> <li>Write tests for new functionality</li> <li>Update documentation if needed</li> <li>Run tests to ensure everything works</li> <li>Commit your changes with clear commit messages</li> </ol>"},{"location":"development/contributing/#testing","title":"Testing","text":""},{"location":"development/contributing/#running-tests","title":"Running Tests","text":"<pre><code># Run all API tests\ncd api &amp;&amp; npm test\n\n# Run web tests\ncd web &amp;&amp; npm test\n\n# Run E2E tests\ncd web &amp;&amp; npx playwright test\n\n# Run tests with coverage\ncd api &amp;&amp; npm run test:coverage\n</code></pre>"},{"location":"development/contributing/#test-coverage","title":"Test Coverage","text":"<p>We aim for comprehensive test coverage:</p> <ul> <li>API: 231+ tests passing</li> <li>Frontend: Component and integration tests</li> <li>E2E: Critical user journeys with Playwright</li> </ul>"},{"location":"development/contributing/#writing-tests","title":"Writing Tests","text":"<ul> <li>Unit tests: Test individual functions and components</li> <li>Integration tests: Test API endpoints and database interactions</li> <li>E2E tests: Test complete user workflows</li> <li>Follow the AAA pattern: Arrange, Act, Assert</li> </ul>"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"development/contributing/#before-submitting","title":"Before Submitting","text":"<ol> <li> <p>Ensure tests pass:    <pre><code>cd api &amp;&amp; npm test\ncd web &amp;&amp; npx playwright test\n</code></pre></p> </li> <li> <p>Check code quality:    <pre><code>cd api &amp;&amp; npm run lint\ncd web &amp;&amp; npm run lint\n</code></pre></p> </li> <li> <p>Update documentation if your changes affect:</p> </li> <li>API endpoints</li> <li>User interface</li> <li>Configuration</li> <li>Installation process</li> </ol>"},{"location":"development/contributing/#pr-guidelines","title":"PR Guidelines","text":"<ol> <li>Create a clear title describing the change</li> <li>Write a detailed description:</li> <li>What changes were made</li> <li>Why the changes were necessary</li> <li>How to test the changes</li> <li> <p>Any breaking changes or migration steps</p> </li> <li> <p>Link related issues using <code>Fixes #123</code> or <code>Closes #123</code></p> </li> <li>Include screenshots for UI changes</li> <li>Keep PRs focused - one feature or bug fix per PR</li> </ol>"},{"location":"development/contributing/#pr-template","title":"PR Template","text":"<pre><code>## Description\nBrief description of changes\n\n## Type of Change\n- [ ] Bug fix\n- [ ] New feature\n- [ ] Breaking change\n- [ ] Documentation update\n\n## Testing\n- [ ] Unit tests pass\n- [ ] Integration tests pass\n- [ ] E2E tests pass\n- [ ] Manual testing completed\n\n## Screenshots (if applicable)\n[Add screenshots here]\n\n## Checklist\n- [ ] Code follows style guidelines\n- [ ] Self-review completed\n- [ ] Documentation updated\n- [ ] Tests added/updated\n</code></pre>"},{"location":"development/contributing/#review-process","title":"Review Process","text":"<ol> <li>Automated checks must pass (CI/CD pipeline)</li> <li>Code review by maintainers</li> <li>Approval from at least one maintainer</li> <li>Merge after approval</li> </ol>"},{"location":"development/contributing/#coding-standards","title":"Coding Standards","text":""},{"location":"development/contributing/#typescript","title":"TypeScript","text":"<ul> <li>Strict mode enabled - No <code>any</code> types without justification</li> <li>Explicit return types for functions</li> <li>Interface over type for object shapes</li> <li>Use enums for constants with multiple values</li> </ul>"},{"location":"development/contributing/#code-style","title":"Code Style","text":"<ul> <li>ESLint configuration enforced</li> <li>Prettier formatting for consistent style</li> <li>Meaningful variable names - avoid abbreviations</li> <li>Small functions - single responsibility principle</li> <li>DRY principle - Don't Repeat Yourself</li> </ul>"},{"location":"development/contributing/#api-development","title":"API Development","text":"<ul> <li>RESTful endpoints following REST conventions</li> <li>Input validation using middleware</li> <li>Error handling with proper HTTP status codes</li> <li>Rate limiting on all public endpoints</li> <li>Authentication required for protected routes</li> <li>Audit logging for security-relevant actions</li> </ul>"},{"location":"development/contributing/#react-development","title":"React Development","text":"<ul> <li>Functional components with hooks</li> <li>TypeScript interfaces for props</li> <li>Custom hooks for reusable logic</li> <li>Error boundaries for error handling</li> <li>Accessibility (a11y) considerations</li> </ul>"},{"location":"development/contributing/#database","title":"Database","text":"<ul> <li>Prisma ORM for database operations</li> <li>Migrations for schema changes</li> <li>Indexes for performance optimization</li> <li>Constraints for data integrity</li> </ul>"},{"location":"development/contributing/#documentation","title":"Documentation","text":""},{"location":"development/contributing/#code-documentation","title":"Code Documentation","text":"<ul> <li>JSDoc comments for public APIs</li> <li>Inline comments for complex logic</li> <li>README updates for significant changes</li> <li>API documentation in OpenAPI format</li> </ul>"},{"location":"development/contributing/#user-documentation","title":"User Documentation","text":"<ul> <li>MkDocs for comprehensive guides</li> <li>Clear examples and code snippets</li> <li>Screenshots for UI changes</li> <li>Troubleshooting sections</li> </ul>"},{"location":"development/contributing/#reporting-issues","title":"Reporting Issues","text":""},{"location":"development/contributing/#bug-reports","title":"Bug Reports","text":"<p>Use the bug report template and include:</p> <ul> <li>Clear title describing the issue</li> <li>Steps to reproduce the problem</li> <li>Expected vs actual behavior</li> <li>Environment details (OS, browser, Node.js version)</li> <li>Screenshots or error messages</li> <li>Logs from browser console or server</li> </ul>"},{"location":"development/contributing/#feature-requests","title":"Feature Requests","text":"<p>Use the feature request template and include:</p> <ul> <li>Clear title describing the feature</li> <li>Problem description and use case</li> <li>Proposed solution with examples</li> <li>Alternatives considered</li> <li>Additional context (screenshots, mockups)</li> </ul>"},{"location":"development/contributing/#security-issues","title":"Security Issues","text":"<p>Security Vulnerabilities</p> <p>Do not report security vulnerabilities through public issues. Instead:</p> <ol> <li>Email seanmdalton@pm.me</li> <li>Include detailed reproduction steps</li> <li>Allow time for response before public disclosure</li> </ol>"},{"location":"development/contributing/#community","title":"Community","text":""},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: https://seanmdalton.github.io/pulsestage/</li> <li>Issues: GitHub Issues</li> <li>Discussions: GitHub Discussions</li> </ul>"},{"location":"development/contributing/#contributing-areas","title":"Contributing Areas","text":"<p>We welcome contributions in many areas:</p> <ul> <li>Bug fixes and performance improvements</li> <li>New features and enhancements</li> <li>Documentation improvements</li> <li>Test coverage expansion</li> <li>UI/UX improvements</li> <li>Security enhancements</li> <li>Accessibility improvements</li> </ul>"},{"location":"development/contributing/#recognition","title":"Recognition","text":"<p>Contributors are recognized in:</p> <ul> <li>GitHub contributors list</li> <li>Release notes for significant contributions</li> <li>Community highlights in discussions</li> </ul>"},{"location":"development/contributing/#license","title":"License","text":"<p>By contributing to PulseStage, you agree that your contributions will be licensed under the Apache License 2.0.</p> <p>Thank you for contributing to PulseStage! \ud83d\ude80</p> <p>For questions about contributing, please open a discussion or email seanmdalton@pm.me.</p>"},{"location":"development/email-testing/","title":"Testing Email Functionality","text":"<p>This guide explains how to test PulseStage's email notification system locally using Mailpit.</p>"},{"location":"development/email-testing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker Compose running with Mailpit service</li> <li>API configured to use SMTP (default in <code>docker-compose.override.yaml</code>)</li> <li>Mailpit web UI accessible at http://localhost:8025</li> </ul>"},{"location":"development/email-testing/#quick-test-steps","title":"Quick Test Steps","text":""},{"location":"development/email-testing/#1-ensure-services-are-running","title":"1. Ensure Services are Running","text":"<pre><code>cd /home/klitz/Development/ama-app\ndocker compose up -d\n</code></pre> <p>Wait for all services to be ready (~30 seconds). Verify the email worker started:</p> <pre><code>docker compose logs api | grep \"\ud83d\udce7 Email worker started\"\n</code></pre> <p>You should see: <code>\ud83d\udce7 Email worker started</code></p>"},{"location":"development/email-testing/#2-open-mailpit","title":"2. Open Mailpit","text":"<p>In your browser, navigate to: <pre><code>http://localhost:8025\n</code></pre></p> <p>This is your local email inbox. Leave this tab open.</p>"},{"location":"development/email-testing/#3-submit-and-answer-a-question","title":"3. Submit and Answer a Question","text":""},{"location":"development/email-testing/#3a-as-a-user-submit-a-question","title":"3a. As a User - Submit a Question","text":"<ol> <li>Open the app: http://localhost:5173</li> <li>Log in as Alice (or any test user)</li> <li>Go to the ACME tenant's town hall</li> <li>Submit a new question, e.g., \"How do I test email notifications?\"</li> <li>Note the question ID or text</li> </ol>"},{"location":"development/email-testing/#3b-as-a-moderator-answer-the-question","title":"3b. As a Moderator - Answer the Question","text":"<ol> <li>Still in the app, log in as a Moderator or Admin (e.g., switch to a moderator user)</li> <li>Go to the Moderation Queue or view the question you just submitted</li> <li>Provide an answer and click \"Submit Response\"</li> <li>You should see a success message</li> </ol>"},{"location":"development/email-testing/#3c-check-mailpit","title":"3c. Check Mailpit","text":"<ol> <li>Switch back to the Mailpit tab (http://localhost:8025)</li> <li>Refresh if needed</li> <li>You should see a new email to Alice's email address with the subject \"Your question was answered!\"</li> <li>Click to view the email and verify:</li> <li>Question text is present</li> <li>Answer text is present</li> <li>Responder name is shown</li> <li>Link to view the question works</li> <li>Unsubscribe link goes to profile settings</li> </ol>"},{"location":"development/email-testing/#4-monitor-logs","title":"4. Monitor Logs","text":"<p>In a terminal, watch for email activity:</p> <pre><code>cd /home/klitz/Development/ama-app\ndocker compose logs api -f | grep -E \"\ud83d\udce7|Email|\u2705.*sent\"\n</code></pre> <p>Expected log messages (in order): 1. <code>\ud83d\udce7 Email worker started</code> - Worker initialized on startup 2. <code>\ud83d\udce7 Queued email notification for alice@example.com</code> - Email queued when question answered 3. <code>\ud83d\udce7 Processing email job 1: question-answered</code> - Worker picked up the job 4. <code>\u2705 Email sent successfully to alice@example.com: &lt;message-id&gt;</code> - Email delivered to Mailpit</p>"},{"location":"development/email-testing/#5-test-email-preferences-opt-out","title":"5. Test Email Preferences (Opt-Out)","text":"<ol> <li>Log in as Alice (the user who submitted the question)</li> <li>Go to Profile Settings</li> <li>Disable email notifications (toggle or checkbox)</li> <li>Submit another question</li> <li>Have a moderator answer it</li> <li>Verify NO email arrives in Mailpit for this question</li> </ol>"},{"location":"development/email-testing/#6-check-email-queue-status","title":"6. Check Email Queue Status","text":"<p>View the queue status via the admin health dashboard or API:</p> <pre><code>curl -X GET http://localhost:3000/admin/email-queue \\\n  -H \"X-Admin-Key: dev-admin-key\" \\\n  | jq\n</code></pre> <p>Expected response: <pre><code>{\n  \"waiting\": 0,\n  \"active\": 0,\n  \"completed\": 2,\n  \"failed\": 0,\n  \"delayed\": 0,\n  \"paused\": false\n}\n</code></pre></p>"},{"location":"development/email-testing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/email-testing/#issue-no-emails-arriving-in-mailpit","title":"Issue: No emails arriving in Mailpit","text":"<p>Diagnosis Steps:</p> <ol> <li> <p>Check email worker is running: <pre><code>docker compose logs api | grep \"\ud83d\udce7 Email worker\"\n</code></pre>    Expected: <code>\ud83d\udce7 Email worker started</code></p> </li> <li> <p>Check if email was queued: <pre><code>docker compose logs api | grep \"\ud83d\udce7 Queued email\"\n</code></pre>    Expected: <code>\ud83d\udce7 Queued email notification for user@example.com</code></p> </li> <li> <p>Check for SMTP errors: <pre><code>docker compose logs api --tail 100 | grep -E \"SMTP|credentials|auth\"\n</code></pre>    Should see NO errors (the SMTP fix removed credential requirements for Mailpit)</p> </li> <li> <p>Verify Redis connection: <pre><code>docker compose ps redis\ndocker compose logs redis --tail 20\n</code></pre>    Redis should be running and connected.</p> </li> <li> <p>Check Mailpit is running: <pre><code>docker compose ps mailpit\n</code></pre>    Should show \"running\". If not:    <pre><code>docker compose up -d mailpit\n</code></pre></p> </li> <li> <p>Check email queue: <pre><code>curl http://localhost:3000/admin/email-queue -H \"X-Admin-Key: dev-admin-key\"\n</code></pre>    Look for <code>failed</code> count &gt; 0, which indicates retry failures.</p> </li> </ol>"},{"location":"development/email-testing/#issue-emails-queued-but-not-processing","title":"Issue: Emails queued but not processing","text":"<ol> <li> <p>Restart the email worker: <pre><code>docker compose restart api\ndocker compose logs api -f\n</code></pre>    Watch for <code>\ud83d\udce7 Email worker started</code></p> </li> <li> <p>Check Redis connectivity: <pre><code>docker compose exec api node -e \"const Redis = require('ioredis'); const r = new Redis({host:'redis'}); r.ping().then(console.log)\"\n</code></pre>    Expected: <code>PONG</code></p> </li> </ol>"},{"location":"development/email-testing/#issue-user-preferences-not-saving","title":"Issue: User preferences not saving","text":"<ol> <li> <p>Verify migration ran: <pre><code>docker compose exec api npx prisma migrate status\n</code></pre>    Should show all migrations applied.</p> </li> <li> <p>Check database column exists: <pre><code>docker compose exec db psql -U postgres -d ama -c \"\\d \\\"UserPreferences\\\"\"\n</code></pre>    Should include <code>emailNotifications</code> column.</p> </li> <li> <p>Manually query preferences: <pre><code>docker compose exec db psql -U postgres -d ama -c \"SELECT id, \\\"userId\\\", \\\"emailNotifications\\\" FROM \\\"UserPreferences\\\" LIMIT 5;\"\n</code></pre></p> </li> </ol>"},{"location":"development/email-testing/#email-providers-configuration","title":"Email Providers Configuration","text":""},{"location":"development/email-testing/#local-development-mailpit-default","title":"Local Development (Mailpit - Default)","text":"<p>Already configured in <code>docker-compose.override.yaml</code>: <pre><code>EMAIL_PROVIDER=smtp\nSMTP_HOST=mailpit\nSMTP_PORT=1025\nSMTP_SECURE=false\nSMTP_USER=\nSMTP_PASS=\nEMAIL_FROM=noreply@pulsestage.local\nEMAIL_FROM_NAME=PulseStage\nFRONTEND_URL=http://localhost:5173\n</code></pre></p>"},{"location":"development/email-testing/#production-with-resend-recommended","title":"Production with Resend (Recommended)","text":"<p>Create a <code>.env</code> file or set environment variables: <pre><code>EMAIL_PROVIDER=resend\nRESEND_API_KEY=re_xxxxxxxxxxxxx\nEMAIL_FROM=noreply@yourdomain.com\nEMAIL_FROM_NAME=PulseStage\nFRONTEND_URL=https://yourdomain.com\n</code></pre></p>"},{"location":"development/email-testing/#production-with-smtp-eg-sendgrid-aws-ses","title":"Production with SMTP (e.g., SendGrid, AWS SES)","text":"<pre><code>EMAIL_PROVIDER=smtp\nSMTP_HOST=smtp.sendgrid.net\nSMTP_PORT=587\nSMTP_SECURE=true\nSMTP_USER=apikey\nSMTP_PASS=SG.xxxxxxxxxxxxx\nEMAIL_FROM=noreply@yourdomain.com\nEMAIL_FROM_NAME=PulseStage\nFRONTEND_URL=https://yourdomain.com\n</code></pre>"},{"location":"development/email-testing/#development-preview-email-templates","title":"Development: Preview Email Templates","text":"<p>React Email provides a dev server to preview templates:</p> <pre><code>cd api\nnpm run email:dev\n</code></pre> <p>Then open http://localhost:3001 to see all email templates with hot reload.</p>"},{"location":"development/email-testing/#next-steps","title":"Next Steps","text":"<p>Once local testing is successful:</p> <ol> <li>\u2705 Email notifications working - You've verified the core flow</li> <li>Add email preferences UI - Already added to profile page, test it</li> <li>Configure production email provider - Set up Resend or SMTP credentials</li> <li>Set up DNS records (SPF, DKIM, DMARC) - For production deliverability</li> <li>Add more email templates - Welcome emails, digests, etc.</li> <li>Monitor email queue in production - Use <code>/admin/health</code> and <code>/admin/email-queue</code> endpoints</li> </ol>"},{"location":"development/migrations/","title":"Migrations","text":"<p>Documentation coming soon...</p>"},{"location":"development/running-locally/","title":"Running Locally","text":"<p>This guide covers different ways to run PulseStage locally for development.</p>"},{"location":"development/running-locally/#option-1-pure-local-development-recommended-for-daily-work","title":"Option 1: Pure Local Development (Recommended for Daily Work)","text":"<p>Run only infrastructure in Docker, services on your host machine.</p>"},{"location":"development/running-locally/#advantages","title":"Advantages","text":"<ul> <li>\u26a1 Fastest iteration cycle</li> <li>\ud83d\udd27 Easy debugging with breakpoints</li> <li>\ud83d\udd04 Instant hot reload (TypeScript + Vite)</li> <li>\ud83d\udee0\ufe0f Native dev tools work perfectly</li> </ul>"},{"location":"development/running-locally/#setup","title":"Setup","text":"<pre><code># Start only database and Redis\ndocker compose up db redis -d\n\n# Terminal 1: API\ncd api\nnpm install\nnpx prisma db push\nnpm run db:seed:dev\nnpm run dev              # Hot reload with ts-node-dev\n\n# Terminal 2: Web\ncd web\nnpm install\nnpm run dev              # Hot reload with Vite HMR\n</code></pre> <p>Access: - Web: http://localhost:5173 - API: http://localhost:3000 - API Docs: http://localhost:3000/api-docs</p>"},{"location":"development/running-locally/#option-2-docker-with-local-builds-recommended-before-pushing","title":"Option 2: Docker with Local Builds (Recommended Before Pushing)","text":"<p>Test the actual containerized environment before pushing changes.</p>"},{"location":"development/running-locally/#advantages_1","title":"Advantages","text":"<ul> <li>\ud83d\udc33 Tests real Docker environment</li> <li>\ud83d\udd12 Run security scans locally</li> <li>\u2705 Catch Docker-specific issues</li> <li>\ud83d\udce6 Validate complete build process</li> </ul>"},{"location":"development/running-locally/#setup_1","title":"Setup","text":"<pre><code># Build and run locally\ndocker compose up --build -d\n\n# Run validation\n./run-tests.sh                    # Tests + Trivy scans\n./test-security.sh                # Security headers\n\n# Load demo data\ndocker compose exec api npm run db:seed:full\n\n# View logs\ndocker compose logs -f api\n</code></pre> <p>How it works: - <code>docker-compose.yaml</code>: Published images (for end users) - <code>docker-compose.override.yaml</code>: Local builds (for developers) - Docker Compose automatically merges both files - <code>up --build</code> rebuilds images from local source</p>"},{"location":"development/running-locally/#option-3-published-images-testing-user-experience","title":"Option 3: Published Images (Testing User Experience)","text":"<p>Test exactly what end users will experience.</p>"},{"location":"development/running-locally/#setup_2","title":"Setup","text":"<pre><code># Temporarily disable local builds\nmv docker-compose.override.yaml docker-compose.override.yaml.bak\n\n# Pull and run published images\ndocker compose pull\ndocker compose up -d\ndocker compose exec api npm run db:seed:full\n\n# Restore local builds\nmv docker-compose.override.yaml.bak docker-compose.override.yaml\n</code></pre>"},{"location":"development/running-locally/#recommended-workflow","title":"Recommended Workflow","text":"<ol> <li>Daily development: Use Option 1 (pure local, fastest)</li> <li>Before committing: Use Option 2 (Docker builds, run security scans)</li> <li>Testing UX: Use Option 3 (published images, validate end-user experience)</li> </ol>"},{"location":"development/running-locally/#database-management","title":"Database Management","text":""},{"location":"development/running-locally/#reset-database-local","title":"Reset Database (Local)","text":"<pre><code>cd api\nnpx prisma db push --force-reset\nnpm run db:seed:dev\n</code></pre>"},{"location":"development/running-locally/#reset-database-docker","title":"Reset Database (Docker)","text":"<pre><code>docker compose down -v\ndocker compose up -d\ndocker compose exec api npm run db:seed:full\n</code></pre>"},{"location":"development/running-locally/#view-database","title":"View Database","text":"<pre><code>cd api\nnpx prisma studio    # Opens GUI at http://localhost:5555\n</code></pre>"},{"location":"development/running-locally/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/running-locally/#port-conflicts","title":"Port Conflicts","text":"<p>If ports 3000, 5173, or 5432 are in use:</p> <pre><code># Find what's using the port\nlsof -i :3000\nlsof -i :5173\nlsof -i :5432\n</code></pre>"},{"location":"development/running-locally/#typescript-errors","title":"TypeScript Errors","text":"<pre><code>cd api\nnpm run build        # Should complete without errors\n</code></pre>"},{"location":"development/running-locally/#database-connection-issues","title":"Database Connection Issues","text":"<pre><code>docker compose logs db\ndocker compose ps db\n</code></pre>"},{"location":"development/running-locally/#next-steps","title":"Next Steps","text":"<ul> <li>Testing Guide - Run tests and validate changes</li> <li>Contributing Guide - Submit pull requests</li> <li>Code Style - Coding standards</li> </ul>"},{"location":"development/setup/","title":"Development Setup","text":"<p>This guide covers setting up PulseStage for local development.</p>"},{"location":"development/setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 20+ and npm 10+</li> <li>Docker and Docker Compose</li> <li>Git</li> <li>OpenSSL (for generating secrets)</li> </ul>"},{"location":"development/setup/#quick-start","title":"Quick Start","text":""},{"location":"development/setup/#1-clone-and-setup","title":"1. Clone and Setup","text":"<pre><code>git clone https://github.com/seanmdalton/pulsestage.git\ncd pulsestage\n./setup.sh\n</code></pre>"},{"location":"development/setup/#2-start-infrastructure","title":"2. Start Infrastructure","text":"<p>Start PostgreSQL and Redis via Docker:</p> <pre><code>docker compose up db redis -d\n</code></pre>"},{"location":"development/setup/#3-install-dependencies-and-setup-database","title":"3. Install Dependencies and Setup Database","text":"<pre><code># API dependencies\ncd api\nnpm install\nnpx prisma db push\nnpm run db:seed:dev\n\n# Web dependencies\ncd ../web\nnpm install\n</code></pre>"},{"location":"development/setup/#4-start-development-servers","title":"4. Start Development Servers","text":"<p>In separate terminals:</p> <pre><code># Terminal 1: API with hot reload\ncd api\nnpm run dev\n\n# Terminal 2: Web with Vite HMR\ncd web\nnpm run dev\n</code></pre>"},{"location":"development/setup/#5-access-development-environment","title":"5. Access Development Environment","text":"<ul> <li>Web: http://localhost:5173 (Vite dev server with HMR)</li> <li>API: http://localhost:3000 (ts-node-dev with auto-restart)</li> <li>API Docs: http://localhost:3000/api-docs</li> </ul>"},{"location":"development/setup/#database-seeding","title":"Database Seeding","text":"Script Description Use Case <code>npm run db:seed:dev</code> Basic seed: tenants, teams, users Local development <code>npm run db:seed:tags:dev</code> Add default tags Local development <code>npm run db:seed</code> Compiled JS version Docker containers <code>npm run db:seed:full</code> Full demo data Docker containers <p>For local development: <pre><code>cd api\nnpm run db:seed:dev\nnpm run db:seed:tags:dev\nnode load-comprehensive-test-data.js\n</code></pre></p> <p>For Docker testing: <pre><code>docker compose up -d\ndocker compose exec api npm run db:seed:full\n</code></pre></p>"},{"location":"development/setup/#development-workflow","title":"Development Workflow","text":""},{"location":"development/setup/#running-tests","title":"Running Tests","text":"<pre><code># API tests\ncd api\nnpm test\n\n# API tests with coverage\nnpm run test:coverage\n\n# API tests in watch mode\nnpm run test:watch\n\n# E2E tests (requires services running)\ncd web\nnpm run test:e2e\n</code></pre>"},{"location":"development/setup/#code-quality","title":"Code Quality","text":"<pre><code># Run pre-push checks (tests + security scans)\n./run-tests.sh\n\n# Test security headers and configuration\n./test-security.sh\n</code></pre>"},{"location":"development/setup/#database-management","title":"Database Management","text":"<pre><code>cd api\n\n# Push schema changes to database\nnpx prisma db push\n\n# Generate Prisma client\nnpx prisma generate\n\n# Open Prisma Studio (database GUI)\nnpx prisma studio\n</code></pre>"},{"location":"development/setup/#development-tips","title":"Development Tips","text":""},{"location":"development/setup/#working-with-docker-compose","title":"Working with Docker Compose","text":"<p>PulseStage uses <code>docker-compose.override.yaml</code> for local development builds.</p> <p>Build and test locally: <pre><code>docker compose up --build -d       # Builds from local source\n./run-tests.sh                     # Run tests + security scans\n./test-security.sh                 # Test security headers\n</code></pre></p> <p>Use published images (like end users): <pre><code># Temporarily rename override file\nmv docker-compose.override.yaml docker-compose.override.yaml.bak\ndocker compose pull\ndocker compose up -d\n# Restore override file\nmv docker-compose.override.yaml.bak docker-compose.override.yaml\n</code></pre></p> <p>How it works: - <code>docker-compose.yaml</code> uses published images from GitHub Container Registry - <code>docker-compose.override.yaml</code> overrides with <code>build:</code> directives for local development - Docker Compose automatically merges both files</p> <p>Auto-bootstrap: The API automatically creates a default tenant on first startup if the database is empty.</p>"},{"location":"development/setup/#mock-sso","title":"Mock SSO","text":"<p>In development, authentication uses mock SSO. Access the test page to switch users:</p> <pre><code>http://localhost:5173/sso-test.html\n</code></pre>"},{"location":"development/setup/#inspecting-logs","title":"Inspecting Logs","text":"<pre><code># View all service logs\ndocker compose logs -f\n\n# View specific service\ndocker compose logs -f api\ndocker compose logs -f web\ndocker compose logs -f db\n</code></pre>"},{"location":"development/setup/#resetting-database","title":"Resetting Database","text":"<p>For local development: <pre><code>cd api\nnpx prisma db push --force-reset\nnpm run db:seed:dev\n</code></pre></p> <p>For Docker: <pre><code>docker compose down -v\ndocker compose up -d\ndocker compose exec api npm run db:seed:full\n</code></pre></p>"},{"location":"development/setup/#common-issues","title":"Common Issues","text":""},{"location":"development/setup/#port-already-in-use","title":"Port Already in Use","text":"<p>Change ports in <code>docker-compose.yaml</code> and update <code>.env</code> accordingly.</p>"},{"location":"development/setup/#database-connection-failed","title":"Database Connection Failed","text":"<p>Ensure PostgreSQL is running: <pre><code>docker compose ps db\ndocker compose logs db\n</code></pre></p>"},{"location":"development/setup/#redis-connection-failed","title":"Redis Connection Failed","text":"<p>Check Redis status: <pre><code>docker compose ps redis\ndocker compose logs redis\n</code></pre></p>"},{"location":"development/setup/#next-steps","title":"Next Steps","text":"<ul> <li>Running Locally - Detailed development guide</li> <li>Testing - Testing strategies and practices</li> <li>Contributing - How to contribute</li> </ul>"},{"location":"development/testing/","title":"Testing","text":"<p>Documentation coming soon...</p>"},{"location":"development/setup/local-development/","title":"\ud83d\udee0\ufe0f PulseStage Development Guide","text":"<p>This guide covers the streamlined local development workflow for PulseStage.</p>"},{"location":"development/setup/local-development/#table-of-contents","title":"\ud83d\udccb Table of Contents","text":"<ul> <li>Quick Start</li> <li>Development Commands</li> <li>Testing Workflow</li> <li>Pre-Push Validation</li> <li>Common Workflows</li> <li>Troubleshooting</li> </ul>"},{"location":"development/setup/local-development/#quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"development/setup/local-development/#first-time-setup","title":"First Time Setup","text":"<ol> <li> <p>Initialize environment: <pre><code>make setup\n# or: bash setup.sh\n</code></pre></p> </li> <li> <p>Install dependencies: <pre><code>make install\n</code></pre></p> </li> <li> <p>Start development environment: <pre><code>make dev\n</code></pre></p> </li> <li> <p>Access the application:</p> </li> <li>Web: http://localhost:5173</li> <li>API: http://localhost:3000</li> <li> <p>API Docs: http://localhost:3000/docs</p> </li> <li> <p>Load data (choose one):</p> </li> <li>Via Setup Wizard (recommended): Open http://localhost:5173 and follow the wizard</li> <li>Via CLI (development): <code>make db-seed</code> (in another terminal)</li> </ol>"},{"location":"development/setup/local-development/#development-commands","title":"\ud83c\udfaf Development Commands","text":"<p>We use a Makefile for convenience. All commands can be run with <code>make &lt;command&gt;</code>.</p>"},{"location":"development/setup/local-development/#setup-environment","title":"Setup &amp; Environment","text":"<pre><code>make setup        # Initialize .env file with secure secrets\nmake install      # Install all dependencies (API + Web)\n</code></pre>"},{"location":"development/setup/local-development/#development","title":"Development","text":"<pre><code>make dev          # Start local development (builds from source)\nmake up           # Start services in background\nmake down         # Stop all services\nmake logs         # Follow logs from all services\nmake clean        # Clean up containers, volumes, and build artifacts\n</code></pre>"},{"location":"development/setup/local-development/#testing","title":"Testing","text":"<pre><code>make test         # Run all tests\nmake test-api     # Run API tests only\nmake test-web     # Run Web E2E tests (requires services running)\nmake validate-ci  # Run all CI checks locally before pushing\nmake security     # Run security scans (Trivy)\n</code></pre>"},{"location":"development/setup/local-development/#code-quality","title":"Code Quality","text":"<pre><code>make lint         # Run linting (API + Web)\nmake lint-fix     # Fix linting issues automatically\nmake format       # Format code (Prettier)\n</code></pre>"},{"location":"development/setup/local-development/#database","title":"Database","text":"<pre><code>make db-seed      # Seed database with demo data (development only)\nmake db-reset     # Reset and reseed database from scratch\n</code></pre> <p>Note: For production/first-time users, use the Setup Wizard instead (opens automatically at http://localhost:5173).</p>"},{"location":"development/setup/local-development/#testing-workflow","title":"\ud83e\uddea Testing Workflow","text":""},{"location":"development/setup/local-development/#local-testing","title":"Local Testing","text":"<p>PulseStage has comprehensive testing at multiple levels:</p> <ol> <li> <p>Unit/Integration Tests (API) <pre><code>make test-api\n# or: cd api &amp;&amp; npm test\n</code></pre></p> </li> <li> <p>E2E Tests (Web) <pre><code>make up           # Start services first\nmake test-web     # Run E2E tests\n</code></pre></p> </li> <li> <p>Validate All CI Checks <pre><code>make validate-ci  # Runs everything CI will check\n</code></pre></p> </li> </ol>"},{"location":"development/setup/local-development/#what-gets-tested","title":"What Gets Tested","text":"<ul> <li>\u2705 API Tests: 214 unit/integration tests</li> <li>\u2705 API Build: TypeScript compilation</li> <li>\u2705 API Linting: ESLint + Prettier (0 errors allowed)</li> <li>\u2705 Web Linting: ESLint + Prettier (0 errors allowed)</li> <li>\u2705 Security: Semgrep + Trivy scans (in CI)</li> </ul>"},{"location":"development/setup/local-development/#pre-push-validation","title":"\ud83d\udd12 Pre-Push Validation","text":"<p>We use Husky hooks to ensure quality before pushing:</p>"},{"location":"development/setup/local-development/#pre-commit-hook","title":"Pre-Commit Hook","text":"<p>Automatically runs on every commit: - \u2705 Formats code with Prettier - \u2705 Adds formatted files to staging</p>"},{"location":"development/setup/local-development/#pre-push-hook","title":"Pre-Push Hook","text":"<p>Automatically runs before every push: - \u2705 Runs API tests (214 tests must pass) - \u2705 Builds API (TypeScript compilation) - \u2705 Runs API linting (0 errors) - \u2705 Runs Web linting (0 errors)</p> <p>Note: Warnings are allowed, but errors will block the push.</p>"},{"location":"development/setup/local-development/#manual-pre-push-check","title":"Manual Pre-Push Check","text":"<p>Run all validation checks manually before pushing:</p> <pre><code>make validate-ci\n</code></pre> <p>This runs the exact same checks that CI will run, ensuring your push will succeed.</p>"},{"location":"development/setup/local-development/#common-workflows","title":"\ud83d\udcbc Common Workflows","text":""},{"location":"development/setup/local-development/#starting-a-new-feature","title":"Starting a New Feature","text":"<pre><code># 1. Start fresh\nmake down\nmake clean\n\n# 2. Pull latest changes\ngit pull origin main\n\n# 3. Install dependencies\nmake install\n\n# 4. Start development\nmake dev\n\n# 5. In another terminal, seed database\nmake db-seed\n\n# 6. Start coding!\n</code></pre>"},{"location":"development/setup/local-development/#before-committing","title":"Before Committing","text":"<pre><code># Format and lint your code\nmake lint-fix\nmake format\n\n# Run tests\nmake test-api\n\n# The pre-commit hook will auto-format on commit\ngit add .\ngit commit -m \"your message\"\n</code></pre>"},{"location":"development/setup/local-development/#before-pushing","title":"Before Pushing","text":"<pre><code># Validate everything locally\nmake validate-ci\n\n# If all checks pass, push!\ngit push origin your-branch\n\n# The pre-push hook will run automatically\n</code></pre>"},{"location":"development/setup/local-development/#testing-ui-changes","title":"Testing UI Changes","text":"<pre><code># 1. Start with local builds\nmake dev\n\n# 2. Make your changes to web/src/...\n\n# 3. Vite will hot-reload automatically\n\n# 4. For API changes, restart the service\ndocker compose restart api\n</code></pre>"},{"location":"development/setup/local-development/#database-changes","title":"Database Changes","text":"<pre><code># After changing prisma/schema.prisma\n\n# 1. Update the schema in Docker\ndocker compose exec api npx prisma db push\n\n# 2. Regenerate Prisma client\ndocker compose exec api npx prisma generate\n\n# 3. Restart API\ndocker compose restart api\n\n# 4. Reseed if needed\nmake db-seed\n</code></pre>"},{"location":"development/setup/local-development/#running-security-scans","title":"Running Security Scans","text":"<pre><code># Run the same security scans as CI\nmake security\n</code></pre> <p>This will: - Build fresh Docker images - Run Trivy scans for vulnerabilities - Test service health - Report any HIGH/CRITICAL issues</p>"},{"location":"development/setup/local-development/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":""},{"location":"development/setup/local-development/#services-wont-start","title":"Services Won't Start","text":"<pre><code># Check logs\nmake logs\n\n# Clean and restart\nmake clean\nmake dev\n</code></pre>"},{"location":"development/setup/local-development/#database-connection-issues","title":"Database Connection Issues","text":"<pre><code># Reset database\nmake db-reset\n</code></pre>"},{"location":"development/setup/local-development/#tests-failing","title":"Tests Failing","text":"<pre><code># Make sure you're using the test database\ncd api &amp;&amp; npm test\n\n# The tests use a separate test database automatically\n</code></pre>"},{"location":"development/setup/local-development/#port-already-in-use","title":"Port Already in Use","text":"<pre><code># Stop all services\nmake down\n\n# If that doesn't work, find and kill the process\nlsof -ti:3000 | xargs kill -9  # API port\nlsof -ti:5173 | xargs kill -9  # Web port\n</code></pre>"},{"location":"development/setup/local-development/#linting-errors","title":"Linting Errors","text":"<pre><code># Auto-fix most issues\nmake lint-fix\n\n# Format code\nmake format\n\n# Check what's wrong\nmake lint\n</code></pre>"},{"location":"development/setup/local-development/#pre-push-hook-failing","title":"Pre-Push Hook Failing","text":"<pre><code># Run the checks manually to see details\nmake validate-ci\n\n# Fix any issues, then try pushing again\n</code></pre>"},{"location":"development/setup/local-development/#docker-build-issues","title":"Docker Build Issues","text":"<pre><code># Clean everything and rebuild\nmake clean\ndocker system prune -af\nmake dev\n</code></pre>"},{"location":"development/setup/local-development/#additional-resources","title":"\ud83d\udcda Additional Resources","text":"<ul> <li>Setup Guide: <code>docs/getting-started/quick-start.md</code></li> <li>Testing Guide: <code>docs/development/testing.md</code></li> <li>API Documentation: http://localhost:3000/docs (when running)</li> <li>Contributing Guide: <code>CONTRIBUTING.md</code></li> </ul>"},{"location":"development/setup/local-development/#key-principles","title":"\ud83c\udfaf Key Principles","text":"<ol> <li>Local-First Development: Use <code>make dev</code> to build from local source</li> <li>Test Before Push: Use <code>make validate-ci</code> to catch issues early</li> <li>Automated Validation: Pre-push hooks ensure code quality</li> <li>Docker for Consistency: All services run in Docker for consistency</li> <li>Simple Commands: Use <code>make</code> for common tasks</li> </ol>"},{"location":"development/setup/local-development/#getting-help","title":"\ud83e\udd1d Getting Help","text":"<p>If you run into issues:</p> <ol> <li>Check the logs: <code>make logs</code></li> <li>Try a clean restart: <code>make clean &amp;&amp; make dev</code></li> <li>Check the Troubleshooting Guide for common issues</li> <li>Ask in the team channel</li> </ol> <p>Happy coding! \ud83d\ude80</p>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>Documentation coming soon...</p>"},{"location":"getting-started/first-steps/","title":"First Steps with PulseStage","text":"<p>Welcome to PulseStage! This guide walks you through the main features and helps you get started.</p>"},{"location":"getting-started/first-steps/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Sign In</li> <li>Understanding Roles</li> <li>Submit Your First Question</li> <li>Up-Vote Questions</li> <li>Browse and Search</li> <li>Moderator Features</li> <li>Admin Panel</li> <li>Presentation Mode</li> </ul>"},{"location":"getting-started/first-steps/#sign-in","title":"Sign In","text":"<p>After completing the Setup Wizard, you'll need to sign in:</p>"},{"location":"getting-started/first-steps/#demo-data-users","title":"Demo Data Users","text":"<p>Navigate to the SSO test page: <pre><code>http://localhost:5173/sso-test.html\n</code></pre></p> <p>You'll see 4 demo users: - Alice Anderson (alice.admin@acme.com) - Admin role, Engineering team - Charlie Chen (charlie.owner@acme.com) - Owner, Product &amp; Marketing teams - David Martinez (david@acme.com) - Moderator, Engineering team - Emily Evans (emily.member@acme.com) - Member, Engineering &amp; Product teams</p> <p>Click any user to sign in with their account.</p>"},{"location":"getting-started/first-steps/#custom-setup","title":"Custom Setup","text":"<p>If you created your own organization: 1. Navigate to <code>http://localhost:5173/sso-test.html</code> 2. You'll see your admin user 3. Click to sign in</p>"},{"location":"getting-started/first-steps/#understanding-roles","title":"Understanding Roles","text":"<p>PulseStage has 5 role levels with increasing permissions:</p>"},{"location":"getting-started/first-steps/#viewer-default","title":"Viewer (Default)","text":"<ul> <li>View questions and answers</li> <li>Search and browse</li> <li>No authentication required</li> </ul>"},{"location":"getting-started/first-steps/#member","title":"Member","text":"<ul> <li>Everything Viewer can do, plus:</li> <li>Submit questions</li> <li>Up-vote questions</li> <li>Edit/delete own questions</li> </ul>"},{"location":"getting-started/first-steps/#moderator","title":"Moderator","text":"<ul> <li>Everything Member can do, plus:</li> <li>Answer questions</li> <li>Pin/unpin questions</li> <li>Freeze questions (prevent new upvotes)</li> <li>Add/remove tags</li> <li>Access Presentation Mode</li> <li>Team-scoped: Only for assigned teams</li> </ul>"},{"location":"getting-started/first-steps/#admin","title":"Admin","text":"<ul> <li>Everything Moderator can do, plus:</li> <li>Access Admin Panel</li> <li>View moderation stats</li> <li>Manage tags across all teams</li> <li>Bulk operations</li> <li>Export data</li> <li>View audit logs</li> <li>Cross-team: Access all teams</li> </ul>"},{"location":"getting-started/first-steps/#owner","title":"Owner","text":"<ul> <li>Everything Admin can do, plus:</li> <li>Create/edit/delete teams</li> <li>Manage team members</li> <li>Change user roles</li> <li>Manage organization settings</li> <li>Full control</li> </ul>"},{"location":"getting-started/first-steps/#submit-your-first-question","title":"Submit Your First Question","text":"<ol> <li>Sign in with any Member+ account</li> <li>Select a team from the navigation</li> <li>Click \"Submit Question\" button</li> <li>Enter your question</li> <li>Be clear and concise</li> <li>10-2000 characters</li> <li>One question per submission</li> <li>Click \"Submit\"</li> </ol> <p>Your question will appear instantly with 1 automatic upvote (from you).</p>"},{"location":"getting-started/first-steps/#up-vote-questions","title":"Up-Vote Questions","text":"<p>Help surface the most important questions:</p> <ol> <li>Browse open questions in any team</li> <li>Click the \u2b06\ufe0f button to upvote</li> <li>Questions sort by upvote count automatically</li> <li>You can only upvote once per question</li> </ol> <p>Upvoting helps prioritize what gets answered first.</p>"},{"location":"getting-started/first-steps/#browse-and-search","title":"Browse and Search","text":""},{"location":"getting-started/first-steps/#browse-questions","title":"Browse Questions","text":"<ul> <li>Open Questions: Waiting for answers</li> <li>Answered Questions: View all responses</li> <li>All Teams: See questions across teams (Admin+)</li> </ul>"},{"location":"getting-started/first-steps/#search","title":"Search","text":"<p>Use the search bar to find specific questions:</p> <ul> <li>Full-text search: Searches question body and responses</li> <li>Prefix matching: Type partial words</li> <li>Filter by:</li> <li>Team</li> <li>Tags</li> <li>Status (Open/Answered)</li> <li>Date range</li> </ul> <p>Example searches: - \"remote work\" - \"benefits\" - \"#urgent\" (searches by tag)</p>"},{"location":"getting-started/first-steps/#moderator-features","title":"Moderator Features","text":"<p>Available to Moderators, Admins, and Owners in their assigned teams.</p>"},{"location":"getting-started/first-steps/#answer-questions","title":"Answer Questions","text":"<ol> <li>Click on a question to open details</li> <li>Click \"Answer\" button</li> <li>Write your response (clear, comprehensive)</li> <li>Click \"Submit Answer\"</li> </ol> <p>The question status changes to \"Answered\" and appears in the answered list.</p>"},{"location":"getting-started/first-steps/#pin-questions","title":"Pin Questions","text":"<p>Highlight important questions at the top:</p> <ol> <li>Open question details</li> <li>Click \"Pin\" button</li> <li>Pinned questions appear first in the list</li> </ol>"},{"location":"getting-started/first-steps/#freeze-questions","title":"Freeze Questions","text":"<p>Prevent further upvotes (for already-answered questions):</p> <ol> <li>Open question details</li> <li>Click \"Freeze\" button</li> <li>Frozen questions show a \u2744\ufe0f icon</li> </ol>"},{"location":"getting-started/first-steps/#add-tags","title":"Add Tags","text":"<p>Organize questions with tags:</p> <ol> <li>Open question details</li> <li>Click \"+ Tag\"</li> <li>Select or create a tag</li> <li>Tags appear on the question card</li> </ol> <p>Common tags: - \ud83c\udff7\ufe0f Important - \ud83d\udd25 Urgent - \ud83d\udca1 Feature Request - \u2705 Answered Live - \ud83c\udfa4 Currently Presenting</p>"},{"location":"getting-started/first-steps/#admin-panel","title":"Admin Panel","text":"<p>Available to Admins and Owners. Access via your profile menu \u2192 \"Admin Panel\".</p>"},{"location":"getting-started/first-steps/#dashboard-tabs","title":"Dashboard Tabs","text":""},{"location":"getting-started/first-steps/#moderation-queue","title":"Moderation Queue","text":"<ul> <li>View all questions with filters</li> <li>Bulk operations (pin, freeze, tag, delete)</li> <li>Quick actions for common tasks</li> <li>Real-time updates</li> </ul>"},{"location":"getting-started/first-steps/#stats","title":"Stats","text":"<ul> <li>Questions answered per moderator</li> <li>Average response time</li> <li>Activity trends</li> <li>Team-level analytics</li> </ul>"},{"location":"getting-started/first-steps/#teams","title":"Teams","text":"<ul> <li>View all teams</li> <li>Create new teams</li> <li>Edit team details</li> <li>Activate/deactivate teams</li> <li>View member counts</li> </ul>"},{"location":"getting-started/first-steps/#tags","title":"Tags","text":"<ul> <li>Create custom tags</li> <li>Edit tag names and colors</li> <li>Delete unused tags</li> <li>See tag usage counts</li> </ul>"},{"location":"getting-started/first-steps/#users-owner-only","title":"Users (Owner only)","text":"<ul> <li>View all users</li> <li>Change user roles</li> <li>Remove users from teams</li> <li>Search by name/email</li> </ul>"},{"location":"getting-started/first-steps/#export","title":"Export","text":"<ul> <li>Export questions to CSV/JSON</li> <li>Filter by date range, status, team</li> <li>Include metadata and responses</li> <li>Download for analysis</li> </ul>"},{"location":"getting-started/first-steps/#audit-logs-admin","title":"Audit Logs (Admin+)","text":"<ul> <li>View all system actions</li> <li>Track user changes</li> <li>See who did what and when</li> <li>Filter by action type, user, date</li> </ul>"},{"location":"getting-started/first-steps/#settings-owner-only","title":"Settings (Owner only)","text":"<ul> <li>Change organization name</li> <li>Configure tenant settings</li> <li>Manage organization-level options</li> </ul>"},{"location":"getting-started/first-steps/#presentation-mode","title":"Presentation Mode","text":"<p>Perfect for live town halls and all-hands meetings. Available to Moderator+ roles.</p>"},{"location":"getting-started/first-steps/#entering-presentation-mode","title":"Entering Presentation Mode","text":"<ol> <li>Navigate to a team</li> <li>Click \"Presentation Mode\" in the top right</li> <li>Full-screen view optimized for projection</li> <li>Questions auto-sort by upvotes</li> <li>Real-time updates as votes come in</li> </ol>"},{"location":"getting-started/first-steps/#using-presentation-mode","title":"Using Presentation Mode","text":"<ul> <li>Large, readable text for audiences</li> <li>Auto-tagged as \"Currently Presenting\"</li> <li>Answer inline without leaving presentation</li> <li>Questions auto-mark as \"Reviewed\" when answered</li> <li>Press ESC to exit</li> </ul>"},{"location":"getting-started/first-steps/#tips-for-presentations","title":"Tips for Presentations","text":"<ol> <li>Sort by upvotes to address top priorities</li> <li>Use tags to track answered questions</li> <li>Pin important questions to keep them visible</li> <li>Answer live for immediate engagement</li> <li>Export afterwards for follow-up items</li> </ol>"},{"location":"getting-started/first-steps/#next-steps","title":"Next Steps","text":""},{"location":"getting-started/first-steps/#explore-more-features","title":"Explore More Features","text":"<ul> <li>User Guide - Detailed feature walkthrough</li> <li>Moderator Guide - Moderation best practices</li> <li>Admin Guide - Admin panel features</li> </ul>"},{"location":"getting-started/first-steps/#customize-your-installation","title":"Customize Your Installation","text":"<ul> <li>Configuration - Environment settings</li> <li>Team Management - Organize your teams</li> <li>Role Management - Set up permissions</li> </ul>"},{"location":"getting-started/first-steps/#for-developers","title":"For Developers","text":"<ul> <li>Development Guide - Contribute to PulseStage</li> <li>API Documentation - REST API reference</li> <li>Architecture - System design</li> </ul>"},{"location":"getting-started/first-steps/#common-workflows","title":"Common Workflows","text":""},{"location":"getting-started/first-steps/#town-hall-qa-workflow","title":"Town Hall Q&amp;A Workflow","text":"<ol> <li>Before the meeting:</li> <li>Admins create a team event (e.g., \"Q1 All-Hands\")</li> <li>Share the link with employees</li> <li> <p>Employees submit questions ahead of time</p> </li> <li> <p>During the meeting:</p> </li> <li>Moderator opens Presentation Mode</li> <li>Questions are sorted by upvotes</li> <li>Leadership answers top questions live</li> <li> <p>Tag questions as \"Answered Live\"</p> </li> <li> <p>After the meeting:</p> </li> <li>Admin exports unanswered questions</li> <li>Follow-up responses are added via the platform</li> <li>Transcript can be exported for documentation</li> </ol>"},{"location":"getting-started/first-steps/#team-retrospective-workflow","title":"Team Retrospective Workflow","text":"<ol> <li>Setup:</li> <li>Create a team (e.g., \"Engineering Retro\")</li> <li> <p>Invite team members</p> </li> <li> <p>Collection Phase:</p> </li> <li>Team submits questions/topics</li> <li>Upvote most important items</li> <li> <p>Use tags: \"Went Well\", \"Needs Improvement\", \"Action Item\"</p> </li> <li> <p>Discussion Phase:</p> </li> <li>Open Presentation Mode</li> <li>Discuss top-voted items</li> <li> <p>Answer/respond inline</p> </li> <li> <p>Follow-Up:</p> </li> <li>Export action items</li> <li>Track progress in next retro</li> </ol>"},{"location":"getting-started/first-steps/#tips-best-practices","title":"Tips &amp; Best Practices","text":""},{"location":"getting-started/first-steps/#for-question-submitters","title":"For Question Submitters","text":"<ul> <li>\u2705 Be specific: \"What's our remote work policy for 2025?\" vs \"Policy question?\"</li> <li>\u2705 One question per submission: Makes it easier to answer</li> <li>\u2705 Search first: Your question might already be answered</li> <li>\u2705 Upvote similar questions: Rather than duplicating</li> </ul>"},{"location":"getting-started/first-steps/#for-moderators","title":"For Moderators","text":"<ul> <li>\u2705 Answer promptly: Within 48 hours when possible</li> <li>\u2705 Be comprehensive: Answer thoroughly to avoid follow-ups</li> <li>\u2705 Use tags: Organize for easier tracking</li> <li>\u2705 Pin important: Keep critical questions visible</li> </ul>"},{"location":"getting-started/first-steps/#for-admins","title":"For Admins","text":"<ul> <li>\u2705 Review audit logs: Track system usage</li> <li>\u2705 Monitor stats: Identify response bottlenecks</li> <li>\u2705 Export regularly: Keep records for compliance</li> <li>\u2705 Manage tags: Keep them organized and relevant</li> </ul>"},{"location":"getting-started/first-steps/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/first-steps/#cant-submit-questions","title":"Can't Submit Questions","text":"<ul> <li>Ensure you're signed in (Member+ role required)</li> <li>Check you're on a team page, not the home page</li> <li>Verify question length (10-2000 characters)</li> </ul>"},{"location":"getting-started/first-steps/#not-seeing-all-teams","title":"Not Seeing All Teams","text":"<ul> <li>Regular users only see teams they're members of</li> <li>Admins see all teams</li> <li>Check with your admin if you need access</li> </ul>"},{"location":"getting-started/first-steps/#presentation-mode-not-available","title":"Presentation Mode Not Available","text":"<ul> <li>Requires Moderator+ role</li> <li>Must be on a team page with questions</li> <li>Check your role in Profile \u2192 Teams</li> </ul>"},{"location":"getting-started/first-steps/#changes-not-appearing","title":"Changes Not Appearing","text":"<ul> <li>Hard refresh: Ctrl+F5 (Windows/Linux) or Cmd+Shift+R (Mac)</li> <li>Clear browser cache</li> <li>Check real-time connection (top-right indicator)</li> </ul>"},{"location":"getting-started/first-steps/#getting-help","title":"Getting Help","text":"<ul> <li>\ud83d\udcd6 Full Documentation</li> <li>\ud83d\udc1b Report Issues</li> <li>\ud83d\udcac Discussions</li> <li>\ud83d\udce7 Contact your PulseStage administrator</li> </ul> <p>Welcome to PulseStage! We hope you enjoy using it to improve communication and transparency in your organization. \ud83d\ude80</p>"},{"location":"getting-started/installation/","title":"Installation Guide","text":"<p>This guide provides detailed instructions for installing PulseStage in various environments.</p>"},{"location":"getting-started/installation/#system-requirements","title":"System Requirements","text":""},{"location":"getting-started/installation/#minimum-requirements","title":"Minimum Requirements","text":"<ul> <li>CPU: 2 cores</li> <li>RAM: 2GB</li> <li>Disk: 10GB free space</li> <li>OS: Linux, macOS, or Windows with WSL2</li> </ul>"},{"location":"getting-started/installation/#software-requirements","title":"Software Requirements","text":"<ul> <li>Docker 20.10+ and Docker Compose 2.0+</li> <li>Git 2.30+</li> <li>(Optional) Node.js 24+ for local development</li> </ul>"},{"location":"getting-started/installation/#docker-compose-installation-recommended","title":"Docker Compose Installation (Recommended)","text":"<p>The easiest way to run PulseStage is with Docker Compose using published images.</p>"},{"location":"getting-started/installation/#1-clone-repository","title":"1. Clone Repository","text":"<pre><code>git clone https://github.com/seanmdalton/pulsestage.git\ncd pulsestage\n</code></pre>"},{"location":"getting-started/installation/#2-configure-environment","title":"2. Configure Environment","text":"<p>Run the setup command to generate secure configuration:</p> <pre><code>make setup\n</code></pre> <p>This automatically: - Creates <code>.env</code> file with all required settings - Generates secure random secrets using OpenSSL - Sets up database and Redis URLs - Configures ports and CORS</p> <p>Manual Setup (Alternative):</p> <p>If you prefer manual configuration:</p> <pre><code>cp env.example .env\n</code></pre> <p>Then edit <code>.env</code> and set: - <code>SESSION_SECRET</code> - Random 32+ character string (generate with: <code>openssl rand -base64 32</code>) - <code>ADMIN_SESSION_SECRET</code> - Different random 32+ character string - <code>CSRF_SECRET</code> - Another random 32+ character string - <code>ADMIN_KEY</code> - Admin authentication key (change from default!) - <code>CORS_ORIGIN</code> - Your frontend URL (default: http://localhost:5173)</p>"},{"location":"getting-started/installation/#3-start-services","title":"3. Start Services","text":"<pre><code>make start\n</code></pre> <p>This pulls and runs the latest published images from GitHub Container Registry: - pulsestage-api:latest - pulsestage-web:latest</p>"},{"location":"getting-started/installation/#4-complete-setup-wizard","title":"4. Complete Setup Wizard","text":"<p>The API auto-creates a default tenant on first startup. Open your browser:</p> <pre><code>http://localhost:5173\n</code></pre> <p>You'll see the Setup Wizard which guides you through: - Load Demo Data - Pre-configured teams, users, and sample questions - Create Organization - Start fresh with your own setup</p> <p>See the Quick Start Guide for detailed wizard instructions.</p>"},{"location":"getting-started/installation/#5-verify-installation","title":"5. Verify Installation","text":"<p>Check all services are running:</p> <pre><code>make status\n</code></pre> <p>Expected output: <pre><code>NAME                IMAGE               STATUS\nama-app-api-1       ama-app-api         Up\nama-app-db-1        postgres:16-alpine  Up\nama-app-redis-1     redis:7-alpine      Up\nama-app-web-1       ama-app-web         Up\n</code></pre></p>"},{"location":"getting-started/installation/#6-access-application","title":"6. Access Application","text":"<ul> <li>Web UI: http://localhost:5173</li> <li>API: http://localhost:3000</li> <li>API Docs (Swagger): http://localhost:3000/api-docs</li> <li>SSO Test Page: http://localhost:5173/sso-test.html</li> </ul>"},{"location":"getting-started/installation/#local-development-installation","title":"Local Development Installation","text":"<p>For active development with hot reload and local builds:</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<pre><code>node --version  # Should be 24.x\nnpm --version   # Should be 10.x\n</code></pre>"},{"location":"getting-started/installation/#1-clone-and-install","title":"1. Clone and Install","text":"<pre><code>git clone https://github.com/seanmdalton/pulsestage.git\ncd pulsestage\n\n# Use Makefile for convenience\nmake setup     # Generate .env\nmake install   # Install dependencies\n</code></pre> <p>Manual installation: <pre><code># Install API dependencies\ncd api\nnpm install\n\n# Install Web dependencies\ncd ../web\nnpm install\n</code></pre></p>"},{"location":"getting-started/installation/#2-start-development-environment","title":"2. Start Development Environment","text":"<pre><code>make dev\n</code></pre> <p>This starts all services with local builds and hot reload enabled.</p> <p>Manual start: <pre><code># Start with local builds\ndocker compose -f docker-compose.yaml -f docker-compose.override.yaml up -d\n</code></pre></p>"},{"location":"getting-started/installation/#3-load-demo-data-optional","title":"3. Load Demo Data (Optional)","text":"<pre><code>make db-seed\n</code></pre> <p>This loads the same demo data as the setup wizard for development purposes.</p> <p>Manual seeding: <pre><code>docker compose exec api npm run db:seed:full\ndocker compose restart api  # Reload mock SSO users\n</code></pre></p>"},{"location":"getting-started/installation/#4-access-development-environment","title":"4. Access Development Environment","text":"<ul> <li>Web UI: http://localhost:5173 (Vite dev server with HMR)</li> <li>API: http://localhost:3000</li> <li>API Docs: http://localhost:3000/api-docs</li> </ul>"},{"location":"getting-started/installation/#development-workflow","title":"Development Workflow","text":"<p>See DEVELOPMENT.md for the complete development guide, including: - Testing workflow - Pre-push validation - Common tasks - Troubleshooting</p>"},{"location":"getting-started/installation/#production-deployment","title":"Production Deployment","text":"<p>See Deployment Guide for production setup instructions.</p> <p>Key differences for production: - Use strong, unique secrets in <code>.env</code> - Change <code>ADMIN_KEY</code> from default - Enable HTTPS with proper certificates - Configure proper SSO provider (not Mock SSO) - Set <code>NODE_ENV=production</code> - Use production-grade PostgreSQL (managed service) - Configure backups and monitoring</p>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#port-conflicts","title":"Port Conflicts","text":"<p>If ports are already in use, modify <code>docker-compose.yaml</code>:</p> <pre><code>services:\n  web:\n    ports:\n      - \"8080:80\"  # Change external port 5173 to 8080\n\n  api:\n    ports:\n      - \"3001:3000\"  # Change external port 3000 to 3001\n</code></pre> <p>Then update <code>CORS_ORIGIN</code> in <code>.env</code> to match your new web port.</p>"},{"location":"getting-started/installation/#database-connection-errors","title":"Database Connection Errors","text":"<p>Check PostgreSQL is running:</p> <pre><code>make logs-db\n</code></pre> <p>Or manually: <pre><code>docker compose logs db\n</code></pre></p> <p>Reset database if needed:</p> <pre><code>make clean\nmake start\n</code></pre> <p>Or manually: <pre><code>docker compose down -v\ndocker compose up -d\n</code></pre></p> <p>Warning: This deletes all data! Use only for development.</p>"},{"location":"getting-started/installation/#setup-wizard-issues","title":"Setup Wizard Issues","text":"<p>If the setup wizard doesn't appear:</p> <ol> <li>Clear browser cache/localStorage:</li> <li>Open DevTools (F12)</li> <li>Application \u2192 Local Storage \u2192 Clear All</li> <li> <p>Refresh page</p> </li> <li> <p>Or use incognito/private window</p> </li> <li> <p>Check if teams already exist:    <pre><code>docker compose exec db psql -U app -d ama -c \"SELECT COUNT(*) FROM \\\"Team\\\";\"\n</code></pre></p> </li> </ol>"},{"location":"getting-started/installation/#permission-errors","title":"Permission Errors","text":"<p>On Linux, you may need to fix file permissions:</p> <pre><code>sudo chown -R $USER:$USER .\n</code></pre>"},{"location":"getting-started/installation/#services-wont-start","title":"Services Won't Start","text":"<p>Check Docker logs:</p> <pre><code># All services\nmake logs\n\n# Specific service\nmake logs-api\nmake logs-web  \nmake logs-db\n</code></pre> <p>Or manually with docker compose: <pre><code>docker compose logs\ndocker compose logs api\ndocker compose logs db\n</code></pre></p> <p>Common issues: - Ports already in use (see Port Conflicts above) - Insufficient RAM (need at least 2GB) - Docker daemon not running</p>"},{"location":"getting-started/installation/#upgrading","title":"Upgrading","text":"<p>To upgrade to the latest version:</p> <pre><code># Pull latest images and restart\nmake update\n</code></pre> <p>Or manually: <pre><code>docker compose pull\ndocker compose up -d\n</code></pre></p> <p>Note: Database migrations are applied automatically on startup.</p> <p>For local development builds:</p> <pre><code>git pull origin main\nmake install  # Update dependencies\nmake dev      # Rebuild and restart\n</code></pre>"},{"location":"getting-started/installation/#uninstalling","title":"Uninstalling","text":"<p>To completely remove PulseStage:</p> <pre><code># Stop and remove all containers and volumes\nmake clean\n\n# Remove images (optional)\ndocker rmi ghcr.io/seanmdalton/pulsestage-api:latest\ndocker rmi ghcr.io/seanmdalton/pulsestage-web:latest\n\n# Remove repository\ncd ..\nrm -rf pulsestage\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Get running quickly</li> <li>Configuration Guide - Environment variables</li> <li>First Steps - Getting started with PulseStage</li> <li>Development Setup - For contributors</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get PulseStage up and running in under 5 minutes!</p>"},{"location":"getting-started/quick-start/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker and Docker Compose installed</li> <li>Git for cloning the repository</li> <li>At least 2GB RAM available</li> </ul>"},{"location":"getting-started/quick-start/#installation","title":"Installation","text":""},{"location":"getting-started/quick-start/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/seanmdalton/pulsestage.git\ncd pulsestage\n</code></pre>"},{"location":"getting-started/quick-start/#2-run-setup","title":"2. Run Setup","text":"<p>The setup command creates your environment configuration with secure secrets:</p> <pre><code>make setup\n</code></pre> <p>This will: - Create <code>.env</code> file with all required configuration - Generate secure random secrets for sessions and CSRF - Set up database and Redis connection strings - Configure default ports and CORS settings</p> <p>Note: The generated admin key is <code>dev-admin-key-change-me</code>. Change this in production!</p>"},{"location":"getting-started/quick-start/#3-start-the-services","title":"3. Start the Services","text":"<pre><code>make start\n</code></pre> <p>This will: - Pull the latest published container images from GitHub Container Registry - Start all services in the background</p> <p>Services started: - PostgreSQL database on port 5432 - Redis cache on port 6379 - API server on port 3000 (ghcr.io/seanmdalton/pulsestage-api:latest) - Web frontend on port 5173 (ghcr.io/seanmdalton/pulsestage-web:latest)</p> <p>The API automatically creates a default tenant on first startup (auto-bootstrap).</p>"},{"location":"getting-started/quick-start/#4-access-pulsestage","title":"4. Access PulseStage","text":"<p>Open your browser and navigate to:</p> <pre><code>http://localhost:5173\n</code></pre> <p>You'll see the Setup Wizard which guides you through initial setup.</p>"},{"location":"getting-started/quick-start/#setup-wizard","title":"Setup Wizard","text":"<p>On first visit, PulseStage presents a setup wizard with two options:</p>"},{"location":"getting-started/quick-start/#option-1-load-demo-data-recommended","title":"Option 1: Load Demo Data (Recommended)","text":"<p>Perfect for exploring PulseStage's features:</p> <ol> <li>Click \"Load Demo Data\"</li> <li>Click \"Continue\"</li> <li>Wait ~5-10 seconds for the system to:</li> <li>Create Acme Corp tenant</li> <li>Add 3 teams (Engineering, Product, Marketing)</li> <li>Create 4 demo users (Alice, Charlie, David, Emily)</li> <li>Generate 6 sample questions</li> <li>Add default tags</li> <li>System will restart automatically to load the new users</li> </ol> <p>Demo includes: - Alice Anderson (alice.admin@acme.com) - Admin, Engineering team - Charlie Chen (charlie.owner@acme.com) - Owner, Product &amp; Marketing teams - David Martinez (david@acme.com) - Moderator, Engineering team - Emily Evans (emily.member@acme.com) - Member, Engineering &amp; Product teams</p>"},{"location":"getting-started/quick-start/#option-2-create-your-own-organization","title":"Option 2: Create Your Own Organization","text":"<p>For starting fresh with your own setup:</p> <ol> <li>Click \"Set up a new team\"</li> <li>Name your organization (e.g., \"My Company\")</li> <li>Create admin user with your name and email</li> <li>Create your first team (e.g., \"Engineering\")</li> <li>System will restart automatically to create your account</li> <li>Navigate to <code>/sso-test.html</code> to sign in with your new account</li> </ol>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":""},{"location":"getting-started/quick-start/#sign-in","title":"Sign In","text":"<p>After setup completes, navigate to:</p> <pre><code>http://localhost:5173/sso-test.html\n</code></pre> <p>For Demo Data: - You'll see all 4 demo users listed - Click any user to sign in - Try different users to explore different roles</p> <p>For Custom Setup: - You'll see your admin user - Click to sign in with your account</p>"},{"location":"getting-started/quick-start/#explore-features","title":"Explore Features","text":"<ol> <li>Submit Your First Question</li> <li>Navigate to any team page</li> <li>Click \"Submit Question\"</li> <li> <p>Enter your question and submit!</p> </li> <li> <p>Try Presentation Mode (Moderator+)</p> </li> <li>Open a team with questions</li> <li>Click \"Presentation Mode\"</li> <li> <p>Perfect for live town halls</p> </li> <li> <p>Access Admin Panel (Admin+)</p> </li> <li>Click your profile \u2192 \"Admin Panel\"</li> <li>Explore team management, user management, analytics</li> <li> <p>View audit logs and exports</p> </li> <li> <p>Manage Teams (Admin+)</p> </li> <li>Create additional teams</li> <li>Add/remove members</li> <li>Configure team settings</li> </ol>"},{"location":"getting-started/quick-start/#development-mode","title":"Development Mode","text":"<p>For local development with live code changes:</p> <pre><code># Initialize and install dependencies\nmake setup\nmake install\n\n# Start with local builds (hot reload)\nmake dev\n\n# In another terminal, seed demo data\nmake db-seed\n</code></pre> <p>See DEVELOPMENT.md for the complete development workflow.</p>"},{"location":"getting-started/quick-start/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quick-start/#setup-wizard-doesnt-appear","title":"Setup Wizard Doesn't Appear","text":"<p>Clear your browser's localStorage: 1. Open DevTools (F12) 2. Go to Application \u2192 Local Storage \u2192 <code>http://localhost:5173</code> 3. Click \"Clear All\" 4. Refresh the page</p> <p>Or use an incognito/private window.</p>"},{"location":"getting-started/quick-start/#services-wont-start","title":"Services Won't Start","text":"<p>Check if ports are already in use:</p> <pre><code># Check port 5173 (web)\nlsof -i :5173\n\n# Check port 3000 (api)\nlsof -i :3000\n\n# Check port 5432 (database)\nlsof -i :5432\n</code></pre>"},{"location":"getting-started/quick-start/#database-connection-issues","title":"Database Connection Issues","text":"<p>Ensure PostgreSQL is running:</p> <pre><code>docker compose ps\n</code></pre> <p>All services should show \"Up\" status.</p>"},{"location":"getting-started/quick-start/#need-help","title":"Need Help?","text":"<ul> <li>Check the Installation Guide for detailed troubleshooting</li> <li>Visit our GitHub Issues</li> <li>See Troubleshooting Guide</li> </ul>"},{"location":"getting-started/quick-start/#whats-next","title":"What's Next?","text":"<ul> <li>Installation Guide - Detailed setup instructions</li> <li>Configuration - Environment variables and settings</li> <li>First Steps - Guided tour of PulseStage features</li> <li>Development Guide - For contributors</li> </ul>"},{"location":"getting-started/troubleshooting/","title":"Troubleshooting Guide","text":""},{"location":"getting-started/troubleshooting/#api-connection-refused-err_connection_refused","title":"API Connection Refused (ERR_CONNECTION_REFUSED)","text":"<p>If you see errors like: <pre><code>GET http://localhost:3000/teams net::ERR_CONNECTION_REFUSED\nGET http://localhost:3000/admin/status net::ERR_CONNECTION_REFUSED\n</code></pre></p> <p>The API server is not running. Follow these steps:</p>"},{"location":"getting-started/troubleshooting/#1-check-if-docker-services-are-running","title":"1. Check if Docker services are running","text":"<pre><code>docker compose ps\n</code></pre> <p>Expected output - all services should show \"Up\": <pre><code>NAME                IMAGE                                      STATUS\nama-app-api-1       ghcr.io/seanmdalton/pulsestage-api:latest  Up\nama-app-db-1        postgres:16-alpine                         Up\nama-app-redis-1     redis:7-alpine                             Up\nama-app-web-1       ghcr.io/seanmdalton/pulsestage-web:latest  Up\n</code></pre></p>"},{"location":"getting-started/troubleshooting/#2-if-services-are-not-running-start-them","title":"2. If services are not running, start them","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"getting-started/troubleshooting/#3-check-api-logs-for-errors","title":"3. Check API logs for errors","text":"<pre><code>docker compose logs api\n</code></pre> <p>Common issues: - Database connection errors (check if PostgreSQL is running) - Missing environment variables (check your <code>.env</code> file) - Port already in use (another service using port 3000)</p>"},{"location":"getting-started/troubleshooting/#4-check-if-api-is-healthy","title":"4. Check if API is healthy","text":"<pre><code>curl http://localhost:3000/health\n</code></pre> <p>Should return: <code>{\"ok\":true,\"service\":\"ama-api\"}</code></p>"},{"location":"getting-started/troubleshooting/#5-verify-database-is-initialized","title":"5. Verify database is initialized","text":"<pre><code>docker compose exec api npm run db:seed\n</code></pre>"},{"location":"getting-started/troubleshooting/#6-complete-restart","title":"6. Complete restart","text":"<p>If nothing works, try a complete restart:</p> <pre><code>docker compose down\ndocker compose up -d\ndocker compose logs -f api\n</code></pre> <p>Watch the logs to see if the API starts successfully.</p>"},{"location":"getting-started/troubleshooting/#port-conflicts","title":"Port Conflicts","text":"<p>If port 3000 or 5173 is already in use:</p> <pre><code># Find what's using the port\nlsof -i :3000\nlsof -i :5173\n\n# Or on Linux:\nss -tulpn | grep :3000\nss -tulpn | grep :5173\n</code></pre> <p>Then either: 1. Stop the conflicting service 2. Change ports in <code>docker-compose.yaml</code> and update <code>.env</code></p>"},{"location":"getting-started/troubleshooting/#database-issues","title":"Database Issues","text":""},{"location":"getting-started/troubleshooting/#reset-database-completely","title":"Reset database completely","text":"<pre><code>docker compose down -v  # Warning: This deletes all data!\ndocker compose up -d\ndocker compose exec api npm run db:seed:full\n</code></pre>"},{"location":"getting-started/troubleshooting/#check-database-connection","title":"Check database connection","text":"<pre><code>docker compose exec db psql -U app -d ama -c \"SELECT COUNT(*) FROM \\\"Question\\\";\"\n</code></pre>"},{"location":"getting-started/troubleshooting/#web-container-issues","title":"Web Container Issues","text":"<p>If web is running but API isn't, the web container might be trying to connect to the wrong API URL.</p> <p>Check the web container environment: <pre><code>docker compose exec web env | grep VITE_API_URL\n</code></pre></p> <p>Should show: <code>VITE_API_URL=http://localhost:3000</code></p>"},{"location":"getting-started/troubleshooting/#still-not-working","title":"Still Not Working?","text":"<ol> <li> <p>Check all environment variables are set:    <pre><code>cat .env\n</code></pre></p> </li> <li> <p>Ensure <code>.env</code> has all required variables:</p> </li> <li><code>SESSION_SECRET</code></li> <li><code>ADMIN_SESSION_SECRET</code></li> <li><code>CSRF_SECRET</code></li> <li> <p><code>ADMIN_KEY</code></p> </li> <li> <p>Regenerate secrets:    <pre><code>./setup.sh\n</code></pre></p> </li> <li> <p>View all service logs:    <pre><code>docker compose logs\n</code></pre></p> </li> </ol>"},{"location":"moderator-guide/answering-questions/","title":"Answering Questions","text":"<p>Documentation coming soon...</p>"},{"location":"moderator-guide/moderation-queue/","title":"Moderation Queue","text":"<p>The Moderation Queue is a powerful interface for moderators and admins to efficiently manage and moderate questions across all teams.</p>"},{"location":"moderator-guide/moderation-queue/#overview","title":"Overview","text":"<p>Access the Moderation Queue from the Admin Panel \u2192 Moderation Queue tab.</p> <p>Who can access: - \u2705 Moderators (for their teams) - \u2705 Admins (all teams) - \u2705 Owners (all teams)</p>"},{"location":"moderator-guide/moderation-queue/#features","title":"Features","text":""},{"location":"moderator-guide/moderation-queue/#table-view","title":"\ud83d\udcca Table View","text":"<p>All questions are displayed in a comprehensive table with:</p> <ul> <li>Checkbox - Select for bulk operations</li> <li>Question - Body text with pinned \ud83d\udccc and frozen \u2744\ufe0f indicators</li> <li>Team - Which team the question belongs to</li> <li>Status - OPEN or ANSWERED</li> <li>Upvotes - Number of upvotes</li> <li>Tags - Color-coded tag pills</li> <li>Actions - Quick action buttons</li> </ul>"},{"location":"moderator-guide/moderation-queue/#filters","title":"\ud83d\udd0d Filters","text":"<p>Filter questions by:</p> <ul> <li>Status - All, Open, or Answered</li> <li>Team - Filter to specific team</li> <li>Pinned - All, Pinned Only, or Unpinned Only</li> <li>Frozen - All, Frozen Only, or Unfrozen Only</li> <li>Needs Review - Checkbox to show only unreviewed questions</li> </ul> <p>Clear all filters with the \"Clear Filters\" button.</p>"},{"location":"moderator-guide/moderation-queue/#quick-actions","title":"\u26a1 Quick Actions","text":"<p>Each question has quick action buttons:</p> <ul> <li>\ud83d\udccc Pin/Unpin - Highlight important questions (pinned appear first)</li> <li>\u2744\ufe0f Freeze/Unfreeze - Lock questions from further interaction</li> <li>\ud83d\udcac Answer - Open answer modal (only for OPEN questions)</li> </ul> <p>Actions update instantly and sync across all browser windows via SSE.</p>"},{"location":"moderator-guide/moderation-queue/#bulk-operations","title":"Bulk Operations","text":""},{"location":"moderator-guide/moderation-queue/#selecting-questions","title":"Selecting Questions","text":"<ol> <li>Select individual questions - Click checkbox next to each question</li> <li>Select all - Click checkbox in table header</li> <li>Selection shows badge - \"X questions selected\" with available actions</li> </ol>"},{"location":"moderator-guide/moderation-queue/#bulk-tag-actions","title":"Bulk Tag Actions","text":"<p>When questions are selected, use the Tag Actions dropdown:</p> <p>Add Tag: - Select \"+ Tag Name\" from dropdown - Tag is added to all selected questions - Success count displayed</p> <p>Remove Tag: - Select \"- Tag Name\" from dropdown - Tag is removed from all selected questions</p>"},{"location":"moderator-guide/moderation-queue/#bulk-actions","title":"Bulk Actions","text":"<p>Use the Bulk Actions dropdown for:</p> <ul> <li>\ud83d\udccc Pin All - Pin all selected questions</li> <li>\ud83d\udccc Unpin All - Remove pin from all selected</li> <li>\u2744\ufe0f Freeze All - Freeze all selected questions</li> <li>\u2744\ufe0f Unfreeze All - Unfreeze all selected</li> <li>\ud83d\uddd1\ufe0f Delete All - Permanently delete (requires confirmation)</li> </ul> <p>Results: - Success/error count displayed - Audit log created for all operations - Real-time updates via SSE to all connected clients</p>"},{"location":"moderator-guide/moderation-queue/#pin-vs-freeze","title":"Pin vs Freeze","text":""},{"location":"moderator-guide/moderation-queue/#pin","title":"\ud83d\udccc Pin","text":"<p>Purpose: Highlight important questions</p> <p>Effect: - Question appears first in lists (ordered by pin status) - Visual \ud83d\udccc indicator shown - Tracks who pinned and when - Does NOT prevent upvotes or responses</p> <p>Use Cases: - Highlight frequently asked questions - Mark questions for leadership attention - Prioritize for upcoming town hall</p>"},{"location":"moderator-guide/moderation-queue/#freeze","title":"\u2744\ufe0f Freeze","text":"<p>Purpose: Lock questions from further interaction</p> <p>Effect: - Visual \u2744\ufe0f indicator shown - Prevents new upvotes (optional enforcement) - Prevents new responses (optional enforcement) - Tracks who froze and when</p> <p>Use Cases: - Mark questions as resolved - Prevent interaction on sensitive topics - Archive old questions while keeping them visible</p>"},{"location":"moderator-guide/moderation-queue/#best-practices","title":"Best Practices","text":""},{"location":"moderator-guide/moderation-queue/#efficient-workflow","title":"Efficient Workflow","text":"<ol> <li>Filter to \"Needs Review\" - See only unreviewed questions</li> <li>Sort by team - Focus on your assigned teams</li> <li>Use bulk tags - Tag similar questions at once (e.g., all \"Policy\" questions)</li> <li>Pin urgent items - Ensure leadership sees critical questions</li> <li>Freeze resolved - Lock questions that don't need more upvotes</li> </ol>"},{"location":"moderator-guide/moderation-queue/#tag-strategy","title":"Tag Strategy","text":"<p>Common tag patterns:</p> <ul> <li>\"Important\" - High-priority questions</li> <li>\"Reviewed\" - Questions already addressed in presentation mode</li> <li>\"Currently Presenting\" - Active question in presentation (auto-managed)</li> <li>\"Follow-up\" - Needs additional action</li> <li>\"Policy\", \"Benefits\", \"Culture\" - Topic categories</li> </ul>"},{"location":"moderator-guide/moderation-queue/#bulk-operations-tips","title":"Bulk Operations Tips","text":"<ul> <li>Always review selection before bulk delete</li> <li>Use bulk tag to categorize similar questions quickly</li> <li>Bulk pin for pre-town hall question prioritization</li> <li>Bulk freeze after event to archive historical questions</li> </ul>"},{"location":"moderator-guide/moderation-queue/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"<p>When in moderation queue:</p> <ul> <li>Click checkbox - Select/deselect question</li> <li>Click row - View question details</li> <li>Quick actions - Instant pin/freeze/answer</li> </ul>"},{"location":"moderator-guide/moderation-queue/#real-time-updates","title":"Real-Time Updates","text":"<p>The moderation queue updates in real-time:</p> <ul> <li>New questions appear automatically</li> <li>Upvote counts update live</li> <li>Tag changes from other moderators sync instantly</li> <li>Pin/freeze actions from other windows reflected immediately</li> </ul> <p>No need to refresh the page!</p>"},{"location":"moderator-guide/moderation-queue/#related-pages","title":"Related Pages","text":"<ul> <li>Answering Questions</li> <li>Tagging</li> <li>Presentation Mode</li> <li>Moderation Stats</li> </ul>"},{"location":"moderator-guide/overview/","title":"Moderator Guide Overview","text":"<p>Welcome to the PulseStage moderator guide! As a moderator, you have special privileges to manage questions, facilitate discussions, and ensure smooth Q&amp;A sessions.</p>"},{"location":"moderator-guide/overview/#what-is-a-moderator","title":"What is a Moderator?","text":"<p>Moderators are team-scoped roles responsible for: - Answering questions during live sessions - Tagging and organizing questions - Using presentation mode for live events - Reviewing and moderating content</p>"},{"location":"moderator-guide/overview/#key-features-for-moderators","title":"Key Features for Moderators","text":""},{"location":"moderator-guide/overview/#answer-questions","title":"\u270d\ufe0f Answer Questions","text":"<p>Respond to questions with detailed answers that are visible to all team members. Track which questions you've reviewed and answered.</p> <p>Learn more about answering questions \u2192</p>"},{"location":"moderator-guide/overview/#tag-questions","title":"\ud83c\udff7\ufe0f Tag Questions","text":"<p>Organize questions by topic using tags. This helps users find related questions and helps you identify themes.</p> <p>Learn more about tagging \u2192</p>"},{"location":"moderator-guide/overview/#moderation-queue","title":"\ud83d\udcca Moderation Queue","text":"<p>Access a powerful dashboard to review, filter, and manage questions. See which questions need attention and track your moderation activity.</p> <p>Learn more about the moderation queue \u2192</p>"},{"location":"moderator-guide/overview/#presentation-mode","title":"\ud83c\udfa4 Presentation Mode","text":"<p>Present questions in a clean, full-screen interface perfect for live events. Navigate through questions seamlessly while audiences watch in real-time.</p> <p>Learn more about presentation mode \u2192</p>"},{"location":"moderator-guide/overview/#pin-freeze-questions","title":"\ud83d\udccc Pin &amp; Freeze Questions","text":"<ul> <li>Pin important questions to the top of the list</li> <li>Freeze questions to prevent additional upvotes or responses</li> </ul>"},{"location":"moderator-guide/overview/#moderator-permissions","title":"Moderator Permissions","text":"<p>As a moderator, you have access to:</p> <p>\u2705 Answer questions in your assigned teams \u2705 Tag and untag questions \u2705 Pin important questions \u2705 Freeze questions to prevent changes \u2705 Access the moderation queue \u2705 Use presentation mode \u2705 View moderation statistics for your teams  </p> <p>\u274c Cannot access questions outside your assigned teams \u274c Cannot manage users, teams, or global settings (admin only)</p>"},{"location":"moderator-guide/overview/#team-scoping","title":"Team Scoping","text":"<p>Important: Team Boundaries</p> <p>Moderators are scoped to specific teams. You can only:</p> <ul> <li>See questions from teams you moderate</li> <li>Answer questions in your teams</li> <li>Access moderation stats for your teams</li> </ul> <p>To moderate multiple teams, you must be explicitly added as a moderator to each team.</p>"},{"location":"moderator-guide/overview/#getting-started","title":"Getting Started","text":"<ol> <li>Access the Admin Panel (visible when viewing a team you moderate)</li> <li>Review the Moderation Queue to see pending questions</li> <li>Tag questions to help organize them</li> <li>Answer questions during your Q&amp;A session</li> <li>Use Presentation Mode for live events</li> </ol>"},{"location":"moderator-guide/overview/#quick-tips","title":"Quick Tips","text":"<p>Best Practices</p> <ul> <li>Review regularly: Check the moderation queue before sessions</li> <li>Use tags consistently: Create a tagging taxonomy with your team</li> <li>Pin sparingly: Only pin the most critical questions</li> <li>Freeze when needed: Prevent vote manipulation on sensitive topics</li> <li>Answer thoroughly: Clear, complete answers reduce follow-up questions</li> </ul> <p>Real-Time Collaboration</p> <p>Multiple moderators can work simultaneously. Changes appear in real-time for all moderators and users.</p>"},{"location":"moderator-guide/overview/#moderation-workflow","title":"Moderation Workflow","text":"<p>A typical moderation workflow:</p> <ol> <li>Before the event:</li> <li>Review questions in the moderation queue</li> <li>Tag questions by topic</li> <li> <p>Pin high-priority questions</p> </li> <li> <p>During the event:</p> </li> <li>Launch presentation mode</li> <li>Navigate through questions</li> <li>Answer questions live</li> <li> <p>Freeze questions as they're addressed</p> </li> <li> <p>After the event:</p> </li> <li>Review remaining unanswered questions</li> <li>Check moderation stats</li> <li>Follow up on any outstanding items</li> </ol>"},{"location":"moderator-guide/overview/#need-help","title":"Need Help?","text":"<ul> <li>For user features: See the User Guide</li> <li>For admin features: See the Admin Guide</li> <li>For technical issues: Check our GitHub Issues</li> </ul>"},{"location":"moderator-guide/overview/#next-steps","title":"Next Steps","text":"<p>Ready to start moderating? Check out these guides:</p> <ul> <li>Answering Questions - Learn how to respond effectively</li> <li>Moderation Queue - Master the moderation dashboard</li> <li>Presentation Mode - Run successful live Q&amp;A sessions</li> </ul>"},{"location":"moderator-guide/presentation-mode/","title":"Presentation Mode","text":"<p>Documentation coming soon...</p>"},{"location":"moderator-guide/tagging/","title":"Tagging","text":"<p>Documentation coming soon...</p>"},{"location":"security/audit-logging/","title":"Audit Logging","text":"<p>Documentation coming soon...</p>"},{"location":"security/ci-scanning/","title":"CI Security Scanning","text":"<p>PulseStage implements comprehensive automated security scanning in our CI/CD pipeline to detect vulnerabilities before they reach production.</p>"},{"location":"security/ci-scanning/#overview","title":"Overview","text":"<p>Every push to <code>main</code> and every pull request triggers:</p> <ol> <li>Semgrep SAST - Static code analysis</li> <li>Trivy Filesystem - Dependency vulnerability scanning</li> <li>Trivy Image - Docker image vulnerability scanning</li> <li>SBOM Generation - Software Bill of Materials</li> </ol> <p>Fail Criteria: Builds fail on High or Critical severity findings.</p>"},{"location":"security/ci-scanning/#scanning-tools","title":"Scanning Tools","text":""},{"location":"security/ci-scanning/#1-semgrep-sast","title":"1. Semgrep (SAST)","text":"<p>What it scans: Source code for security vulnerabilities and code quality issues</p> <p>Rulesets: - <code>p/ci</code> - CI/CD best practices - <code>p/typescript</code> - TypeScript-specific security rules - <code>p/nodejs</code> - Node.js security patterns - <code>p/docker</code> - Dockerfile best practices - <code>p/security-audit</code> - Security audit rules</p> <p>Severity Levels: - ERROR (High/Critical) - Fails the build - WARNING (Medium) - Reported but doesn't fail - INFO (Low) - Informational only</p> <p>Example Output: <pre><code>\ud83d\udd0d Semgrep SAST Results:\n   High/Critical findings: 0\n\u2705 No high/critical security issues found\n</code></pre></p>"},{"location":"security/ci-scanning/#2-trivy-filesystem-scanner","title":"2. Trivy Filesystem Scanner","text":"<p>What it scans: Dependencies in <code>package.json</code>, <code>package-lock.json</code>, and other manifest files</p> <p>Checks for: - Known CVEs in npm packages - Outdated dependencies with security issues - Transitive dependency vulnerabilities</p> <p>Severity Levels: - CRITICAL - Fails the build - HIGH - Fails the build - MEDIUM - Reported only - LOW - Reported only</p> <p>Example Output: <pre><code>\ud83d\udd0d Trivy Filesystem Scan Results:\n   High/Critical vulnerabilities: 2\n\u274c Found 2 high/critical vulnerabilities in dependencies\n  - axios@0.21.1: Improper Input Validation (Severity: HIGH)\n  - express@4.17.1: Information Exposure (Severity: MEDIUM)\n</code></pre></p>"},{"location":"security/ci-scanning/#3-trivy-docker-image-scanner","title":"3. Trivy Docker Image Scanner","text":"<p>What it scans: Built Docker images (<code>api</code> and <code>web</code>)</p> <p>Checks for: - Vulnerabilities in base images (node:20-alpine, etc.) - Vulnerabilities in installed OS packages - Known CVEs in all image layers</p> <p>Matrix Strategy: Scans both <code>api</code> and <code>web</code> images separately</p> <p>Example Output: <pre><code>\ud83d\udd0d Trivy api Image Scan:\n   High/Critical vulnerabilities: 0\n\u2705 No high/critical vulnerabilities found in api image\n</code></pre></p>"},{"location":"security/ci-scanning/#4-sbom-generation-syft","title":"4. SBOM Generation (Syft)","text":"<p>What it generates: Software Bill of Materials in two formats</p> <p>Formats: - SPDX JSON - Industry standard format - CycloneDX JSON - OWASP standard format</p> <p>Retention: 90 days</p> <p>Contents: - All packages and dependencies - Version information - License information - Package relationships</p> <p>Example: <pre><code>\ud83d\udce6 SBOM Generated for api\n   Format: SPDX + CycloneDX JSON\n   Total packages: 342\n   Retention: 90 days\n</code></pre></p>"},{"location":"security/ci-scanning/#workflow-triggers","title":"Workflow Triggers","text":""},{"location":"security/ci-scanning/#automatic-triggers","title":"Automatic Triggers","text":"<ol> <li>Push to main - Full scan on every merge</li> <li>Pull requests - Scan before merge to catch issues early</li> <li>Daily schedule - Runs at 2 AM UTC to catch newly disclosed CVEs</li> </ol>"},{"location":"security/ci-scanning/#manual-trigger","title":"Manual Trigger","text":"<p>You can manually trigger scans from GitHub Actions UI: <pre><code>Actions \u2192 Security Scanning \u2192 Run workflow\n</code></pre></p>"},{"location":"security/ci-scanning/#viewing-results","title":"Viewing Results","text":""},{"location":"security/ci-scanning/#github-security-tab","title":"GitHub Security Tab","text":"<p>Trivy results are automatically uploaded to the GitHub Security tab:</p> <pre><code>Repository \u2192 Security \u2192 Code scanning\n</code></pre> <p>You'll see: - All detected vulnerabilities - Severity levels - Affected files/packages - Remediation guidance</p>"},{"location":"security/ci-scanning/#artifacts","title":"Artifacts","text":"<p>All scan results are uploaded as artifacts:</p> <pre><code>Actions \u2192 [Your workflow run] \u2192 Artifacts\n</code></pre> <p>Download: - <code>semgrep-results</code> - Semgrep SAST findings (JSON) - <code>trivy-fs-results</code> - Filesystem scan results (JSON) - <code>trivy-api-image</code> - API image scan results (JSON) - <code>trivy-web-image</code> - Web image scan results (JSON) - <code>sbom-api</code> - API SBOM (SPDX + CycloneDX) - <code>sbom-web</code> - Web SBOM (SPDX + CycloneDX)</p>"},{"location":"security/ci-scanning/#workflow-summary","title":"Workflow Summary","text":"<p>Each workflow run generates a summary visible in the workflow page:</p> <pre><code>\ud83c\udfaf CI Pipeline Results\n\nSecurity Scanning\n| Job                 | Status  |\n|---------------------|---------|\n| Semgrep SAST        | \u2705 success |\n| Trivy Filesystem    | \u2705 success |\n| Build &amp; Scan Images | \u2705 success |\n\n\ud83d\udce6 SBOM Artifacts\n- API component (SPDX + CycloneDX)\n- Web component (SPDX + CycloneDX)\n</code></pre>"},{"location":"security/ci-scanning/#local-testing","title":"Local Testing","text":"<p>Run security scans locally before pushing:</p>"},{"location":"security/ci-scanning/#semgrep","title":"Semgrep","text":"<pre><code># Install Semgrep\npip install semgrep\n\n# Run scan\nsemgrep --config=auto \\\n  --config=p/ci \\\n  --config=p/typescript \\\n  --config=p/nodejs \\\n  --severity=ERROR \\\n  --severity=WARNING\n</code></pre>"},{"location":"security/ci-scanning/#trivy-filesystem","title":"Trivy Filesystem","text":"<pre><code># Install Trivy (macOS)\nbrew install aquasecurity/trivy/trivy\n\n# Scan dependencies\ntrivy fs . --severity CRITICAL,HIGH\n</code></pre>"},{"location":"security/ci-scanning/#trivy-docker-images","title":"Trivy Docker Images","text":"<pre><code># Build images first\ndocker compose build\n\n# Scan API image\ntrivy image ama-app-api:latest --severity CRITICAL,HIGH\n\n# Scan Web image\ntrivy image ama-app-web:latest --severity CRITICAL,HIGH\n</code></pre>"},{"location":"security/ci-scanning/#generate-sbom-locally","title":"Generate SBOM Locally","text":"<pre><code># Install Syft (macOS)\nbrew install syft\n\n# Build image\ndocker compose build api\n\n# Generate SBOM\nsyft ama-app-api:latest -o spdx-json=sbom-api.spdx.json\nsyft ama-app-api:latest -o cyclonedx-json=sbom-api.cyclonedx.json\n</code></pre>"},{"location":"security/ci-scanning/#handling-vulnerabilities","title":"Handling Vulnerabilities","text":""},{"location":"security/ci-scanning/#when-a-scan-fails","title":"When a Scan Fails","text":"<ol> <li>Review the findings in the workflow logs</li> <li>Assess the risk - Is it a real vulnerability in your context?</li> <li>Remediate:</li> <li>Update dependencies: <code>npm update</code></li> <li>Fix code issues identified by Semgrep</li> <li>Update base Docker images</li> </ol>"},{"location":"security/ci-scanning/#false-positives","title":"False Positives","text":"<p>If a finding is a false positive:</p> <p>Semgrep: Add inline comment <pre><code>// nosemgrep: rule-id-here\nconst example = dangerousOperation();\n</code></pre></p> <p>Trivy: Add to <code>.trivyignore</code> <pre><code>CVE-2021-12345  # False positive - not applicable\n</code></pre></p>"},{"location":"security/ci-scanning/#accepted-risks","title":"Accepted Risks","text":"<p>Document accepted risks in: - <code>.trivyignore</code> with justification - Security documentation - Architecture Decision Records (ADRs)</p>"},{"location":"security/ci-scanning/#best-practices","title":"Best Practices","text":"<ol> <li>Fix vulnerabilities promptly - Don't let them accumulate</li> <li>Review dependencies regularly - Run <code>npm audit</code> locally</li> <li>Keep base images updated - Update Node.js base image quarterly</li> <li>Monitor security advisories - Subscribe to security mailing lists</li> <li>Test locally before pushing - Catch issues early</li> </ol>"},{"location":"security/ci-scanning/#configuration-files","title":"Configuration Files","text":"<ul> <li><code>.semgrepignore</code> - Patterns to exclude from Semgrep scans</li> <li><code>.trivyignore</code> - CVEs to ignore (with justification)</li> <li><code>.github/workflows/ci.yaml</code> - CI workflow configuration</li> </ul>"},{"location":"security/ci-scanning/#related-documentation","title":"Related Documentation","text":"<ul> <li>Security Overview</li> <li>Security Headers</li> <li>RBAC</li> <li>Audit Logging</li> </ul>"},{"location":"security/content-moderation/","title":"Content Moderation","text":"<p>PulseStage includes built-in content moderation to protect your community from inappropriate content, spam, and abuse.</p>"},{"location":"security/content-moderation/#overview","title":"Overview","text":"<p>The moderation system uses a cascading filter approach:</p> <ol> <li>Local Filter (Always Active)</li> <li>Profanity detection</li> <li>Spam pattern recognition</li> <li>Hate speech detection</li> <li>Excessive capitalization</li> <li>No configuration required</li> <li>Zero API costs</li> <li> <p>Instant processing</p> </li> <li> <p>OpenAI Moderation (Optional)</p> </li> <li>Context-aware AI analysis</li> <li>Advanced toxicity detection</li> <li>Hate speech, harassment, self-harm detection</li> <li>Requires API key</li> <li>Very low cost (~$0.002 per 1K tokens)</li> <li>Only runs if <code>OPENAI_API_KEY</code> is configured</li> </ol> <p>Content is flagged if either filter flags it, providing comprehensive protection.</p>"},{"location":"security/content-moderation/#how-it-works","title":"How It Works","text":""},{"location":"security/content-moderation/#tiered-moderation-system","title":"Tiered Moderation System","text":"<p>PulseStage uses a 3-tier moderation system to balance protection with user experience:</p> <ol> <li>High Confidence Violations \u2192 Auto-Reject</li> <li>Clear profanity, hate speech, spam</li> <li>User receives immediate feedback with reasons</li> <li> <p>Question is NOT created</p> </li> <li> <p>Medium/Low Confidence Flags \u2192 Under Review</p> </li> <li>Borderline content, false positive risk</li> <li>Question created with <code>UNDER_REVIEW</code> status</li> <li>Sent to moderator queue</li> <li> <p>User notified of pending review</p> </li> <li> <p>Clean Content \u2192 Published</p> </li> <li>No flags from any provider</li> <li>Immediately published as <code>OPEN</code></li> <li>Visible to all users</li> </ol>"},{"location":"security/content-moderation/#question-submission-flow","title":"Question Submission Flow","text":"<pre><code>graph TD\n    A[User Submits Question] --&gt; B[Validation]\n    B --&gt; C{Local Filter}\n    C --&gt;|High Confidence| D[Auto-Reject]\n    C --&gt;|Medium/Low| E[Under Review]\n    C --&gt;|Clean| F{OpenAI Available?}\n    F --&gt;|No| G[Publish as OPEN]\n    F --&gt;|Yes| H[OpenAI Check]\n    H --&gt;|High Confidence| D\n    H --&gt;|Medium/Low| E\n    H --&gt;|Clean| G\n    D --&gt; I[400 Response]\n    E --&gt; J[201 Response + Review Notice]\n    G --&gt; K[201 Response + Success]</code></pre>"},{"location":"security/content-moderation/#what-gets-checked","title":"What Gets Checked","text":"<ul> <li>Profanity: Common profane language</li> <li>Spam: Repeated characters, excessive URLs, spam keywords</li> <li>Hate Speech: Slurs, derogatory language, harmful content</li> <li>Toxicity: Aggressive, harassing, or threatening tone</li> <li>Self-Harm: Content promoting self-harm</li> <li>Harassment: Personal attacks, bullying</li> </ul>"},{"location":"security/content-moderation/#configuration","title":"Configuration","text":""},{"location":"security/content-moderation/#local-only-default","title":"Local-Only (Default)","text":"<p>No configuration needed. Works out of the box:</p> <pre><code># env.example - no moderation configuration required\n# Local filtering is automatically active\n</code></pre>"},{"location":"security/content-moderation/#with-openai-enhancement","title":"With OpenAI Enhancement","text":"<p>Add your OpenAI API key for enhanced moderation:</p> <pre><code># Optional: Enhanced AI moderation\nOPENAI_API_KEY=sk-...\n</code></pre> <p>Get an API key: https://platform.openai.com/api-keys</p>"},{"location":"security/content-moderation/#security-best-practices","title":"Security Best Practices","text":""},{"location":"security/content-moderation/#protecting-your-api-key","title":"Protecting Your API Key","text":"<ol> <li>Server-Side Only: Never expose <code>OPENAI_API_KEY</code> to frontend</li> <li>Separate Keys: Use different keys for dev/demo/production</li> <li>Rate Limiting: Already implemented (10 questions/min per IP)</li> <li>Usage Monitoring: Set spending limits in OpenAI dashboard</li> <li>Environment Variables: Never commit keys to git (.gitignore configured)</li> </ol>"},{"location":"security/content-moderation/#recommended-setup","title":"Recommended Setup","text":"<p>Demo/Development: <pre><code># Use local-only filtering\n# No API key needed\n</code></pre></p> <p>Production: <pre><code># Add OpenAI for enhanced protection\nOPENAI_API_KEY=sk-...\n# Set spending limit: $10/month (very generous for most use cases)\n</code></pre></p>"},{"location":"security/content-moderation/#cost-analysis","title":"Cost Analysis","text":""},{"location":"security/content-moderation/#local-filtering","title":"Local Filtering","text":"<ul> <li>Cost: $0 (100% free)</li> <li>Speed: &lt;1ms per question</li> <li>Accuracy: ~85-90% for obvious violations</li> </ul>"},{"location":"security/content-moderation/#openai-moderation-api","title":"OpenAI Moderation API","text":"<ul> <li>Cost: ~$0.002 per 1,000 tokens</li> <li>Speed: ~200ms per question</li> <li>Accuracy: ~95-98% with context awareness</li> </ul>"},{"location":"security/content-moderation/#example-costs","title":"Example Costs","text":"Questions/Month Local Only Local + OpenAI 1,000 $0.00 $0.40 10,000 $0.00 $4.00 100,000 $0.00 $40.00 <p>Caching: Results are cached to avoid duplicate API calls for identical content.</p>"},{"location":"security/content-moderation/#api-response","title":"API Response","text":""},{"location":"security/content-moderation/#successful-submission","title":"Successful Submission","text":"<pre><code>POST /questions\nContent-Type: application/json\n\n{\n  \"body\": \"What is our remote work policy?\"\n}\n\n\u2192 201 Created\n</code></pre>"},{"location":"security/content-moderation/#moderation-failure","title":"Moderation Failure","text":"<pre><code>POST /questions\nContent-Type: application/json\n\n{\n  \"body\": \"This is some fucking bullshit\"\n}\n\n\u2192 400 Bad Request\n{\n  \"error\": \"Content does not meet community guidelines\",\n  \"reasons\": [\n    \"Contains profanity\"\n  ],\n  \"moderationId\": \"mod_1760054757000\"\n}\n</code></pre>"},{"location":"security/content-moderation/#using-the-moderation-id","title":"Using the Moderation ID","text":"<p>The <code>moderationId</code> can be used for: - Support Requests: Users can appeal moderation decisions - Audit Logging: Track moderation patterns - False Positive Reports: Improve filter accuracy</p>"},{"location":"security/content-moderation/#moderator-review-workflow","title":"Moderator Review Workflow","text":"<p>Questions flagged with medium or low confidence are sent to a review queue for human moderation.</p>"},{"location":"security/content-moderation/#review-queue-access","title":"Review Queue Access","text":"<p>Moderators (users with <code>question.answer</code> permission) can access the review queue:</p> <ol> <li>Admin Panel \u2192 Navigate to Moderation Queue</li> <li>Status Filter \u2192 Select \"Under Review\"</li> <li>View all pending questions with:</li> <li>Original question text</li> <li>Moderation reasons</li> <li>Confidence level</li> <li>Flagging providers (local, openai)</li> <li>Team assignment</li> <li>Submission timestamp</li> </ol>"},{"location":"security/content-moderation/#moderator-actions","title":"Moderator Actions","text":""},{"location":"security/content-moderation/#approve-question","title":"Approve Question","text":"<p>Publishes the question and makes it visible to all users:</p> <pre><code>POST /admin/moderation/approve/{questionId}\nAuthorization: Bearer {session}\n\n\u2192 200 OK\n{\n  \"status\": \"OPEN\",\n  \"message\": \"Question approved and published\"\n}\n</code></pre> <p>What happens: - Question status changes from <code>UNDER_REVIEW</code> \u2192 <code>OPEN</code> - Question appears in public browse page - Real-time SSE event (<code>question:created</code>) notifies connected clients - Audit log records approval action - <code>reviewedBy</code> and <code>reviewedAt</code> fields are set</p>"},{"location":"security/content-moderation/#reject-question","title":"Reject Question","text":"<p>Removes the question permanently:</p> <pre><code>POST /admin/moderation/reject/{questionId}\nAuthorization: Bearer {session}\nContent-Type: application/json\n\n{\n  \"reason\": \"Inappropriate content\"\n}\n\n\u2192 200 OK\n{\n  \"message\": \"Question rejected and removed\",\n  \"questionId\": \"...\"\n}\n</code></pre> <p>What happens: - Question is permanently deleted from database - Audit log captures rejection with:   - Original question text   - Moderation reasons   - Moderator's rejection reason   - Moderator user ID   - Timestamp - No notification to other clients (question never existed publicly)</p>"},{"location":"security/content-moderation/#api-endpoints","title":"API Endpoints","text":""},{"location":"security/content-moderation/#list-questions-under-review","title":"List Questions Under Review","text":"<pre><code>GET /admin/moderation/review-queue\nAuthorization: Bearer {session}\nQuery Parameters:\n  - teamId (optional): Filter by team\n  - confidence (optional): Filter by confidence level (high, medium, low)\n\n\u2192 200 OK\n[\n  {\n    \"id\": \"...\",\n    \"body\": \"Question text\",\n    \"status\": \"UNDER_REVIEW\",\n    \"moderationReasons\": [\"Borderline toxic language\"],\n    \"moderationConfidence\": \"medium\",\n    \"moderationProviders\": [\"local\"],\n    \"teamId\": \"...\",\n    \"createdAt\": \"2025-01-10T10:30:00Z\"\n  }\n]\n</code></pre>"},{"location":"security/content-moderation/#user-experience","title":"User Experience","text":""},{"location":"security/content-moderation/#when-question-is-under-review","title":"When Question Is Under Review","text":"<p>User sees: <pre><code>\u2713 Your question has been submitted and is under moderator review.\n  You'll be notified once it's published.\n</code></pre></p> <p>The question: - \u2705 Is saved to database - \u2705 Has <code>UNDER_REVIEW</code> status - \u274c Does NOT appear in public browse page - \u274c Does NOT appear in search results - \u274c Is NOT visible to other users</p>"},{"location":"security/content-moderation/#after-approval","title":"After Approval","text":"<ul> <li>Question appears immediately in public browse page</li> <li>Real-time updates via SSE</li> <li>No additional notification to author (they see it published)</li> </ul>"},{"location":"security/content-moderation/#after-rejection","title":"After Rejection","text":"<ul> <li>Question is deleted</li> <li>No public record</li> <li>Author does not receive automatic notification</li> <li>(Future enhancement: email notification with appeal option)</li> </ul>"},{"location":"security/content-moderation/#audit-logging","title":"Audit Logging","text":"<p>All moderation actions are logged for transparency and compliance:</p>"},{"location":"security/content-moderation/#logged-events","title":"Logged Events","text":"<ol> <li><code>question.moderation.flagged</code></li> <li>Triggered when content is initially flagged</li> <li> <p>Metadata: reasons, confidence, providers, question preview</p> </li> <li> <p><code>question.moderation.under_review</code></p> </li> <li>Triggered when question is sent to review queue</li> <li> <p>Metadata: questionId, teamId, reasons, confidence</p> </li> <li> <p><code>question.moderation.approved</code></p> </li> <li>Triggered when moderator approves a question</li> <li> <p>Metadata: questionId, reviewerId, timestamp</p> </li> <li> <p><code>question.moderation.rejected</code></p> </li> <li>Triggered when moderator rejects a question</li> <li>Metadata: questionId, reviewerId, rejectionReason, originalQuestionText</li> </ol>"},{"location":"security/content-moderation/#querying-audit-logs","title":"Querying Audit Logs","text":"<pre><code>-- View all moderation events\nSELECT action, \"entityType\", metadata, \"createdAt\"\nFROM \"AuditLog\"\nWHERE action LIKE '%moderation%'\nORDER BY \"createdAt\" DESC;\n\n-- Count flagged questions by provider\nSELECT \n  metadata-&gt;&gt;'providers' as providers,\n  COUNT(*) \nFROM \"AuditLog\"\nWHERE action = 'question.moderation.flagged'\nGROUP BY metadata-&gt;&gt;'providers';\n</code></pre>"},{"location":"security/content-moderation/#testing","title":"Testing","text":""},{"location":"security/content-moderation/#running-moderation-tests","title":"Running Moderation Tests","text":"<p>Local filter tests (no database required): <pre><code>cd api\nnpm test -- --config=vitest.moderation.config.ts\n</code></pre></p> <p>Full workflow tests (includes database): <pre><code>cd api\nnpm test src/lib/moderation/moderationWorkflow.test.ts\n</code></pre></p> <p>Tests include: - \u2705 Profanity detection - \u2705 Spam pattern recognition - \u2705 Hate speech detection - \u2705 Excessive capitalization - \u2705 OpenAI integration (when key is available) - \u2705 Error handling and graceful degradation - \u2705 Tiered moderation (auto-reject vs under review) - \u2705 Review queue operations (list, approve, reject) - \u2705 Audit logging for all moderation actions</p>"},{"location":"security/content-moderation/#manual-testing","title":"Manual Testing","text":"<p>Test with local filter: <pre><code># Profanity\ncurl -X POST http://localhost:3000/questions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"body\": \"Why is this shit so broken?\"}'\n</code></pre></p> <p>Test with clean content: <pre><code>curl -X POST http://localhost:3000/questions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"body\": \"How do I submit a PTO request?\"}'\n</code></pre></p>"},{"location":"security/content-moderation/#monitoring","title":"Monitoring","text":""},{"location":"security/content-moderation/#logs","title":"Logs","text":"<p>Moderation events are logged with details:</p> <pre><code>Content flagged by moderation: {\n  providers: ['local', 'openai'],\n  reasons: ['Contains profanity', 'Hate speech detected'],\n  confidence: 'high',\n  preview: 'This is some fucking...'\n}\n</code></pre>"},{"location":"security/content-moderation/#metrics-to-track","title":"Metrics to Track","text":"<ul> <li>Flagged Rate: % of questions flagged</li> <li>False Positives: User reports of incorrect flags</li> <li>Provider Distribution: Local vs OpenAI catches</li> <li>Cost: OpenAI API usage (if enabled)</li> </ul>"},{"location":"security/content-moderation/#customization","title":"Customization","text":""},{"location":"security/content-moderation/#adjusting-sensitivity","title":"Adjusting Sensitivity","text":"<p>Edit <code>api/src/lib/moderation/localFilter.ts</code>:</p> <pre><code>// More lenient: Require higher caps ratio\nconst capsRatio = (text.match(/[A-Z]/g) || []).length / text.replace(/\\s/g, '').length\nif (capsRatio &gt; 0.7 &amp;&amp; text.length &gt; 20) {  // Was 0.6\n  reasons.push('Excessive capitalization')\n}\n</code></pre>"},{"location":"security/content-moderation/#adding-custom-patterns","title":"Adding Custom Patterns","text":"<pre><code>// api/src/lib/moderation/localFilter.ts\nconst customPatterns = [\n  /\\b(custom|banned|phrase)\\b/gi,\n]\n\nfor (const pattern of customPatterns) {\n  if (pattern.test(text)) {\n    reasons.push('Custom policy violation')\n    break\n  }\n}\n</code></pre>"},{"location":"security/content-moderation/#whitelisting","title":"Whitelisting","text":"<p>For trusted users or specific contexts:</p> <pre><code>// In app.ts, before moderation check\nif (req.user?.role === 'admin' || req.user?.role === 'moderator') {\n  // Skip moderation for trusted roles\n}\n</code></pre>"},{"location":"security/content-moderation/#alternatives","title":"Alternatives","text":""},{"location":"security/content-moderation/#perspective-api-google","title":"Perspective API (Google)","text":"<p>Free alternative to OpenAI:</p> <pre><code>// api/src/lib/moderation/perspectiveFilter.ts\nimport { google } from 'googleapis'\n\nconst perspective = google.perspective('v1alpha1')\n// Implement Perspective API integration\n</code></pre> <p>Pros: Free (1 QPS), similar quality Cons: Requires Google Cloud setup</p>"},{"location":"security/content-moderation/#custom-ml-models","title":"Custom ML Models","text":"<p>For enterprise deployments:</p> <ul> <li>Train on your specific domain</li> <li>Host locally for zero API costs</li> <li>Full control over accuracy/sensitivity</li> </ul>"},{"location":"security/content-moderation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"security/content-moderation/#content-flagged-but-seems-appropriate","title":"\"Content flagged\" but seems appropriate","text":"<p>Cause: False positive from local filter Solution:  1. Add OpenAI key for better context awareness 2. Adjust local filter sensitivity 3. Implement appeal process</p>"},{"location":"security/content-moderation/#openai-api-errors","title":"OpenAI API errors","text":"<p>Symptoms:  <pre><code>OpenAI moderation API error: AuthenticationError: 401\n</code></pre></p> <p>Solutions: 1. Verify <code>OPENAI_API_KEY</code> is set correctly 2. Check key hasn't expired 3. Confirm spending limits not exceeded 4. System gracefully falls back to local-only</p>"},{"location":"security/content-moderation/#high-api-costs","title":"High API costs","text":"<p>Solutions: 1. Implement caching (already included) 2. Use local filter first, OpenAI only for edge cases 3. Adjust rate limiting to reduce volume 4. Set OpenAI usage limits</p>"},{"location":"security/content-moderation/#further-reading","title":"Further Reading","text":"<ul> <li>OpenAI Moderation API Documentation</li> <li>Content Policy Best Practices</li> <li>Rate Limiting</li> <li>Audit Logging</li> </ul>"},{"location":"security/overview/","title":"Security Overview","text":"<p>PulseStage implements comprehensive security measures to protect your data, ensure proper access control, and maintain compliance with security best practices.</p>"},{"location":"security/overview/#security-philosophy","title":"Security Philosophy","text":"<p>PulseStage follows a defense-in-depth approach with multiple layers of security:</p> <ol> <li>Authentication &amp; Authorization: Strong identity verification and role-based access control</li> <li>Data Protection: Encryption, isolation, and secure transmission</li> <li>Attack Prevention: CSRF protection, rate limiting, and input validation</li> <li>Audit &amp; Compliance: Comprehensive logging and traceability</li> <li>Secure Development: SAST, vulnerability scanning, and secure defaults</li> </ol>"},{"location":"security/overview/#key-security-features","title":"Key Security Features","text":""},{"location":"security/overview/#role-based-access-control-rbac","title":"\ud83d\udd10 Role-Based Access Control (RBAC)","text":"<p>Fine-grained permissions system with five roles: - Viewer: Read-only access - Member: Can submit and upvote questions - Moderator: Can answer and manage questions (team-scoped) - Admin: Full administrative access (global) - Owner: Complete system control (global)</p> <p>Learn more about RBAC \u2192</p>"},{"location":"security/overview/#audit-logging","title":"\ud83d\udccb Audit Logging","text":"<p>Comprehensive, append-only audit logs track: - Actor (who performed the action) - Action (what was done) - Entity (what was affected) - Timestamp (when it occurred) - Before/After state (what changed) - IP address &amp; User-Agent (context)</p> <p>Learn more about audit logging \u2192</p>"},{"location":"security/overview/#security-headers","title":"\ud83d\udee1\ufe0f Security Headers","text":"<p>HTTP security headers protect against common attacks: - Content Security Policy (CSP): Prevents XSS attacks - X-Frame-Options: Prevents clickjacking - X-Content-Type-Options: Prevents MIME sniffing - Strict-Transport-Security (HSTS): Enforces HTTPS - Referrer-Policy: Controls referrer information</p> <p>Learn more about security headers \u2192</p>"},{"location":"security/overview/#session-management","title":"\ud83c\udf6a Session Management","text":"<p>Secure session handling with: - HttpOnly cookies: Prevents JavaScript access - Secure flag: HTTPS-only transmission - SameSite=Lax: CSRF protection - Session expiration: Automatic timeout - CSRF tokens: Double-submit cookie pattern</p> <p>Learn more about sessions \u2192</p>"},{"location":"security/overview/#rate-limiting","title":"\ud83d\udea6 Rate Limiting","text":"<p>Protect against abuse with: - Per-user rate limits (100 req/min) - Per-IP rate limits (1000 req/min) - Redis-backed sliding window - Graceful degradation to memory store</p> <p>Learn more about rate limiting \u2192</p>"},{"location":"security/overview/#ci-security-scanning","title":"\ud83d\udd0d CI Security Scanning","text":"<p>Automated security scanning in CI/CD: - Semgrep: Static Application Security Testing (SAST) - Trivy: Dependency and Docker image scanning - SBOM (Syft): Software Bill of Materials - MDN HTTP Observatory: Security header validation</p> <p>Learn more about CI scanning \u2192</p>"},{"location":"security/overview/#security-architecture","title":"Security Architecture","text":""},{"location":"security/overview/#multi-tenant-isolation","title":"Multi-Tenant Isolation","text":"<p>Every tenant has complete data isolation: - Separate database records per tenant - Tenant-scoped queries enforced at the ORM level - No cross-tenant data leakage</p>"},{"location":"security/overview/#team-scoping","title":"Team Scoping","text":"<p>Questions and permissions are team-scoped: - Users can belong to multiple teams - Different roles per team - Moderators limited to their assigned teams - Admins have global access</p>"},{"location":"security/overview/#permission-enforcement","title":"Permission Enforcement","text":"<p>Permissions are enforced at multiple levels:</p> <ol> <li>Middleware: Request-level authorization</li> <li>API Routes: Endpoint-specific checks</li> <li>Database Queries: Tenant and team filtering</li> <li>Frontend: UI elements hidden based on permissions</li> </ol>"},{"location":"security/overview/#common-security-scenarios","title":"Common Security Scenarios","text":""},{"location":"security/overview/#user-submits-a-question","title":"User Submits a Question","text":"<ol> <li>Authentication: User identity verified via SSO</li> <li>Authorization: User must be a member+ role</li> <li>CSRF Check: Token validated for POST request</li> <li>Rate Limit: Request counted against user limit</li> <li>Input Validation: Question body validated (Zod schema)</li> <li>Tenant Isolation: Question saved with user's tenant ID</li> <li>Team Scoping: Question associated with selected team</li> <li>Audit Log: Action recorded with actor, entity, timestamp</li> </ol>"},{"location":"security/overview/#moderator-answers-a-question","title":"Moderator Answers a Question","text":"<ol> <li>Authentication: Moderator identity verified</li> <li>Authorization: User must have <code>question.answer</code> permission</li> <li>Team Check: Question must be in moderator's team</li> <li>CSRF Check: Token validated</li> <li>Input Validation: Answer validated</li> <li>Database Update: Question marked as answered</li> <li>Audit Log: Answer action recorded</li> <li>SSE Broadcast: Real-time update sent to team</li> </ol>"},{"location":"security/overview/#admin-views-audit-logs","title":"Admin Views Audit Logs","text":"<ol> <li>Authentication: Admin identity verified</li> <li>Authorization: User must have <code>admin.access</code> permission</li> <li>Tenant Filter: Only see logs for their tenant</li> <li>Team Filter: Admins see all teams, moderators see their teams</li> <li>Pagination: Logs paginated for performance</li> <li>Export: Can download as CSV/JSON</li> </ol>"},{"location":"security/overview/#security-best-practices","title":"Security Best Practices","text":""},{"location":"security/overview/#for-administrators","title":"For Administrators","text":"<p>Admin Security Checklist</p> <ul> <li>\u2705 Limit admin roles to trusted users</li> <li>\u2705 Review audit logs weekly</li> <li>\u2705 Export and backup data regularly</li> <li>\u2705 Use strong SSO authentication</li> <li>\u2705 Monitor rate limit violations</li> <li>\u2705 Keep dependencies updated</li> <li>\u2705 Review moderation statistics for anomalies</li> </ul>"},{"location":"security/overview/#for-developers","title":"For Developers","text":"<p>Developer Security Checklist</p> <ul> <li>\u2705 Always use parameterized queries (Prisma ORM)</li> <li>\u2705 Validate all input with Zod schemas</li> <li>\u2705 Enforce RBAC on all endpoints</li> <li>\u2705 Include tenant/team filters in queries</li> <li>\u2705 Log security-relevant actions</li> <li>\u2705 Use CSRF protection on state-changing endpoints</li> <li>\u2705 Run security scans before pushing</li> </ul>"},{"location":"security/overview/#for-moderators","title":"For Moderators","text":"<p>Moderator Security Checklist</p> <ul> <li>\u2705 Don't share your credentials</li> <li>\u2705 Log out from shared devices</li> <li>\u2705 Report suspicious questions</li> <li>\u2705 Use strong passwords with your SSO provider</li> <li>\u2705 Review questions before answering</li> </ul>"},{"location":"security/overview/#compliance-standards","title":"Compliance &amp; Standards","text":"<p>PulseStage follows industry security standards:</p> <ul> <li>OWASP Top 10: Mitigations for common web vulnerabilities</li> <li>CWE/SANS Top 25: Protection against dangerous software errors</li> <li>Mozilla Observatory: A+ security header configuration</li> <li>NIST: Secure development lifecycle practices</li> </ul>"},{"location":"security/overview/#threat-model","title":"Threat Model","text":""},{"location":"security/overview/#threats-mitigated","title":"Threats Mitigated","text":"<p>\u2705 SQL Injection: Prisma ORM with parameterized queries \u2705 XSS (Cross-Site Scripting): CSP, input validation, output encoding \u2705 CSRF (Cross-Site Request Forgery): Double-submit cookie tokens \u2705 Clickjacking: X-Frame-Options: DENY \u2705 MIME Sniffing: X-Content-Type-Options: nosniff \u2705 Man-in-the-Middle: HSTS, Secure cookies \u2705 Brute Force: Rate limiting \u2705 Privilege Escalation: RBAC enforcement \u2705 Data Leakage: Multi-tenant and team isolation \u2705 Dependency Vulnerabilities: Trivy scanning, automated updates  </p>"},{"location":"security/overview/#out-of-scope","title":"Out of Scope","text":"<p>\u26a0\ufe0f DDoS Protection: Use a CDN or load balancer (e.g., Cloudflare) \u26a0\ufe0f Physical Security: Secure your hosting infrastructure \u26a0\ufe0f SSO Provider Security: Ensure your identity provider is secure \u26a0\ufe0f Insider Threats: Implement organizational policies  </p>"},{"location":"security/overview/#incident-response","title":"Incident Response","text":"<p>If you discover a security vulnerability:</p> <ol> <li>Do NOT create a public GitHub issue</li> <li>Email security concerns to the repository maintainers</li> <li>Include details: steps to reproduce, impact, affected versions</li> <li>Wait for acknowledgment before public disclosure</li> </ol> <p>We aim to respond within 48 hours and issue patches promptly.</p>"},{"location":"security/overview/#security-roadmap","title":"Security Roadmap","text":"<p>Future security enhancements:</p> <ul> <li> OpenTelemetry tracing for security events</li> <li> Advanced threat detection (AI-based moderation)</li> <li> Additional compliance certifications (SOC 2, ISO 27001)</li> <li> Encrypted data at rest (database-level encryption)</li> <li> Advanced anomaly detection</li> <li> Two-factor authentication (2FA) support</li> </ul>"},{"location":"security/overview/#security-metrics","title":"Security Metrics","text":"<p>Track your security posture:</p> <ul> <li>Vulnerability Scan Results: CI/CD pipeline reports</li> <li>Audit Log Volume: Track administrative actions</li> <li>Rate Limit Violations: Monitor abuse attempts</li> <li>Failed Authentication Attempts: Track in logs</li> <li>Uptime &amp; Availability: Monitor with health checks</li> </ul> <p>View CI Security Scanning \u2192</p>"},{"location":"security/overview/#need-help","title":"Need Help?","text":"<ul> <li>RBAC questions: See RBAC Documentation</li> <li>Audit logs: See Audit Logging</li> <li>Security headers: See Security Headers</li> <li>Report vulnerabilities: Contact maintainers privately</li> <li>General security: Check GitHub Security Advisories</li> </ul>"},{"location":"security/overview/#next-steps","title":"Next Steps","text":"<p>Explore detailed security documentation:</p> <ul> <li>RBAC &amp; Permissions - Understand role-based access control</li> <li>Audit Logging - Track administrative actions</li> <li>Security Headers - HTTP security configuration</li> <li>Session Management - Secure session handling</li> <li>CI Security Scanning - Automated vulnerability detection</li> </ul>"},{"location":"security/rate-limiting/","title":"Rate Limiting","text":"<p>Documentation coming soon...</p>"},{"location":"security/rbac/","title":"Role-Based Access Control (RBAC)","text":"<p>PulseStage implements a comprehensive RBAC system with five distinct roles and team-scoped permissions.</p>"},{"location":"security/rbac/#roles","title":"Roles","text":""},{"location":"security/rbac/#viewer","title":"Viewer","text":"<ul> <li>Access: Read-only, anonymous access</li> <li>Permissions:</li> <li>Browse questions (open and answered)</li> <li>Use search functionality</li> <li>View team information</li> </ul> <p>Use Case: Public access, unauthenticated users</p>"},{"location":"security/rbac/#member","title":"Member","text":"<ul> <li>Access: Basic authenticated user</li> <li>Permissions:</li> <li>All Viewer permissions</li> <li>Submit questions</li> <li>Upvote questions</li> <li>Manage profile preferences</li> </ul> <p>Use Case: All employees, authenticated users</p>"},{"location":"security/rbac/#moderator","title":"Moderator","text":"<ul> <li>Access: Team-scoped moderation</li> <li>Permissions:</li> <li>All Member permissions  </li> <li>Answer questions (in assigned teams only)</li> <li>Add/remove tags on questions</li> <li>Access presentation mode</li> <li>View admin panel (limited to their teams)</li> </ul> <p>Use Case: Team leads, department managers</p>"},{"location":"security/rbac/#admin","title":"Admin","text":"<ul> <li>Access: Global administrative access</li> <li>Permissions:</li> <li>All Moderator permissions (across all teams)</li> <li>Create and manage teams</li> <li>Create and manage tags</li> <li>Access audit logs</li> <li>Export data</li> <li>View all questions across teams</li> </ul> <p>Use Case: Platform administrators, IT team</p>"},{"location":"security/rbac/#owner","title":"Owner","text":"<ul> <li>Access: Complete system control</li> <li>Permissions:</li> <li>All Admin permissions</li> <li>Manage user roles</li> <li>System configuration</li> </ul> <p>Use Case: System owners, executive admins</p>"},{"location":"security/rbac/#permission-matrix","title":"Permission Matrix","text":"Permission Viewer Member Moderator Admin Owner View questions \u2705 \u2705 \u2705 \u2705 \u2705 Submit questions \u274c \u2705 \u2705 \u2705 \u2705 Upvote questions \u274c \u2705 \u2705 \u2705 \u2705 Answer questions \u274c \u274c \u2705 (team-scoped) \u2705 \u2705 Tag questions \u274c \u274c \u2705 (team-scoped) \u2705 \u2705 Presentation mode \u274c \u274c \u2705 (team-scoped) \u2705 \u2705 Create teams \u274c \u274c \u274c \u2705 \u2705 Manage tags \u274c \u274c \u274c \u2705 \u2705 View audit logs \u274c \u274c \u274c \u2705 \u2705 Export data \u274c \u274c \u274c \u2705 \u2705 Manage roles \u274c \u274c \u274c \u274c \u2705"},{"location":"security/rbac/#team-scoping","title":"Team Scoping","text":"<p>Moderators have team-scoped permissions, meaning:</p> <ul> <li>They can only answer questions from teams they moderate</li> <li>They can only tag questions in their assigned teams</li> <li>They only see questions from their teams in the admin panel</li> <li>Presentation mode is limited to their teams</li> </ul> <p>Example: - Mike (Moderator of \"People\" team) can:   - \u2705 Answer questions in the People team   - \u274c Answer questions in the Engineering team   - \u2705 See \"Admin Panel\" link when viewing People team questions   - \u274c See \"Admin Panel\" link when viewing Engineering team questions</p>"},{"location":"security/rbac/#implementation","title":"Implementation","text":""},{"location":"security/rbac/#backend-enforcement","title":"Backend Enforcement","text":"<p>Permissions are enforced at the API level using middleware:</p> <pre><code>// Team-scoped permission check\napp.post(\"/questions/:id/respond\", \n  extractQuestionTeam(), \n  requirePermission('question.answer', { teamIdParam: 'teamId' }), \n  async (req, res) =&gt; {\n    // Handler\n  }\n);\n</code></pre>"},{"location":"security/rbac/#frontend-ui","title":"Frontend UI","text":"<p>The UI dynamically shows/hides features based on: 1. User's role in the current team 2. Current team context (which team page they're viewing)</p>"},{"location":"security/rbac/#audit-logging","title":"Audit Logging","text":"<p>All permission checks (grants and denials) are logged to the audit log for compliance and security monitoring.</p>"},{"location":"security/rbac/#testing","title":"Testing","text":"<p>RBAC is comprehensively tested with 20+ test scenarios covering: - Team-scoped permissions - Role hierarchy - Cross-tenant isolation - Permission denials</p> <p>See api/src/rbac.test.ts for implementation.</p>"},{"location":"security/rbac/#best-practices","title":"Best Practices","text":"<ol> <li>Principle of Least Privilege: Assign the minimum role needed</li> <li>Team Scoping: Use moderators for department-level moderation</li> <li>Audit Regularly: Review audit logs for suspicious activity</li> <li>Limit Owners: Only assign owner role to trusted administrators</li> </ol>"},{"location":"security/rbac/#related-documentation","title":"Related Documentation","text":"<ul> <li>Security Overview</li> <li>Audit Logging</li> <li>Admin Guide: Roles &amp; Permissions</li> </ul>"},{"location":"security/security-headers/","title":"Security Headers","text":"<p>PulseStage implements comprehensive HTTP security headers using Helmet middleware to protect against common web vulnerabilities.</p>"},{"location":"security/security-headers/#overview","title":"Overview","text":"<p>All API responses include strict security headers following Mozilla Observatory best practices to achieve an A grade or higher.</p>"},{"location":"security/security-headers/#implemented-headers","title":"Implemented Headers","text":""},{"location":"security/security-headers/#content-security-policy-csp","title":"Content-Security-Policy (CSP)","text":"<p>Strict Content Security Policy to prevent XSS attacks:</p> <pre><code>default-src 'self';\nscript-src 'self';\nstyle-src 'self' 'unsafe-inline';\nobject-src 'none';\nbase-uri 'self';\nform-action 'self';\nframe-ancestors 'none';\nupgrade-insecure-requests;\n</code></pre> <p>Features: - No inline scripts allowed (prevents XSS) - Only load resources from same origin - Prevents framing (clickjacking protection) - Automatically upgrades HTTP to HTTPS requests</p>"},{"location":"security/security-headers/#x-frame-options","title":"X-Frame-Options","text":"<pre><code>X-Frame-Options: DENY\n</code></pre> <p>Prevents the site from being embedded in iframes, protecting against clickjacking attacks.</p>"},{"location":"security/security-headers/#x-content-type-options","title":"X-Content-Type-Options","text":"<pre><code>X-Content-Type-Options: nosniff\n</code></pre> <p>Prevents browsers from MIME-type sniffing, reducing exposure to drive-by download attacks.</p>"},{"location":"security/security-headers/#referrer-policy","title":"Referrer-Policy","text":"<pre><code>Referrer-Policy: strict-origin-when-cross-origin\n</code></pre> <p>Only sends the origin (not full URL) in the Referer header for cross-origin requests, protecting user privacy.</p>"},{"location":"security/security-headers/#strict-transport-security-hsts","title":"Strict-Transport-Security (HSTS)","text":"<pre><code>Strict-Transport-Security: max-age=31536000; includeSubDomains; preload\n</code></pre> <p>Forces browsers to only use HTTPS connections for 1 year. Only enabled in production behind HTTPS.</p>"},{"location":"security/security-headers/#cross-origin-opener-policy","title":"Cross-Origin-Opener-Policy","text":"<pre><code>Cross-Origin-Opener-Policy: same-origin\n</code></pre> <p>Ensures that top-level documents do not share a browsing context group with cross-origin documents.</p>"},{"location":"security/security-headers/#cross-origin-resource-policy","title":"Cross-Origin-Resource-Policy","text":"<pre><code>Cross-Origin-Resource-Policy: same-origin\n</code></pre> <p>Prevents other origins from reading the resource.</p>"},{"location":"security/security-headers/#permissions-policy","title":"Permissions-Policy","text":"<pre><code>Permissions-Policy: camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()\n</code></pre> <p>Disables access to sensitive browser APIs and device features.</p>"},{"location":"security/security-headers/#additional-headers","title":"Additional Headers","text":"<ul> <li><code>Origin-Agent-Cluster: ?1</code> - Provides origin-keyed agent cluster isolation</li> <li><code>X-DNS-Prefetch-Control: off</code> - Disables DNS prefetching</li> <li><code>X-Download-Options: noopen</code> - Prevents IE from executing downloads</li> <li><code>X-Powered-By: (removed)</code> - Hides server technology</li> </ul>"},{"location":"security/security-headers/#development-vs-production","title":"Development vs Production","text":""},{"location":"security/security-headers/#production-mode","title":"Production Mode","text":"<p>Strict security headers with: - No eval() in JavaScript - HSTS enabled - Strict CSP - All security headers enforced</p>"},{"location":"security/security-headers/#development-mode","title":"Development Mode","text":"<p>Relaxed headers for local development with Vite: - Allows <code>'unsafe-eval'</code> for Vite HMR - Allows WebSocket connections (ws:, wss:) - HSTS disabled (no HTTPS required) - All other security headers remain strict</p>"},{"location":"security/security-headers/#testing-security-headers","title":"Testing Security Headers","text":""},{"location":"security/security-headers/#automated-testing-recommended","title":"Automated Testing (Recommended)","text":"<p>We integrate MDN HTTP Observatory directly into our test suite:</p> <pre><code>cd api\nnpm test observatory.test.ts\n</code></pre> <p>This runs 6 automated security tests including: - Overall security grade and score - Content-Security-Policy validation - X-Content-Type-Options check - X-Frame-Options check - Referrer-Policy check - Detailed test result logging</p> <p>Development Mode Results: - Expected Grade: C (relaxed CSP for Vite HMR) - Expected Score: 50/100 - Acceptable: 7/10 tests passing</p> <p>Production Mode Expectations: - Target Grade: A or better - Target Score: 70+/100 - All critical security tests passing</p>"},{"location":"security/security-headers/#local-testing","title":"Local Testing","text":"<p>Check headers locally:</p> <pre><code>curl -I http://localhost:5001/health\n</code></pre>"},{"location":"security/security-headers/#mozilla-http-observatory-manual","title":"Mozilla HTTP Observatory (Manual)","text":"<p>Test your deployed site manually:</p> <ol> <li>Visit: https://developer.mozilla.org/en-US/observatory/</li> <li>Enter your site URL</li> <li>Run the scan</li> <li>Target score: A grade or higher</li> </ol>"},{"location":"security/security-headers/#securityheaderscom","title":"SecurityHeaders.com","text":"<p>Alternative testing tool:</p> <ol> <li>Visit: https://securityheaders.com/</li> <li>Enter your site URL</li> <li>Check for all security headers</li> </ol>"},{"location":"security/security-headers/#implementation","title":"Implementation","text":"<p>The security headers are implemented in <code>api/src/middleware/securityHeaders.ts</code> using Helmet:</p> <pre><code>import helmet from 'helmet';\n\nexport function securityHeadersMiddleware(): RequestHandler {\n  return helmet({\n    contentSecurityPolicy: {\n      directives: {\n        defaultSrc: [\"'self'\"],\n        scriptSrc: [\"'self'\"],\n        // ... more directives\n      },\n    },\n    // ... more options\n  });\n}\n</code></pre> <p>Applied in <code>api/src/app.ts</code>:</p> <pre><code>// Production\napp.use(securityHeadersMiddleware());\napp.use(apiSecurityHeaders());\n\n// Development\napp.use(developmentSecurityHeaders());\napp.use(apiSecurityHeaders());\n</code></pre>"},{"location":"security/security-headers/#testing","title":"Testing","text":""},{"location":"security/security-headers/#unit-tests","title":"Unit Tests","text":"<p>Comprehensive test suite in <code>api/src/middleware/securityHeaders.test.ts</code>:</p> <ul> <li>17 security header tests</li> <li>Verifies all headers are present</li> <li>Checks header values match expectations</li> <li>Tests CSP directives</li> <li>Validates Mozilla Observatory requirements</li> </ul> <pre><code>cd api\nnpm test securityHeaders.test.ts\n</code></pre>"},{"location":"security/security-headers/#observatory-integration-tests","title":"Observatory Integration Tests","text":"<p>Automated MDN HTTP Observatory scanning in <code>api/src/middleware/observatory.test.ts</code>:</p> <ul> <li>6 automated Observatory tests</li> <li>Runs actual security scanner against local server</li> <li>Validates grade and score</li> <li>Tests specific security headers</li> <li>Provides detailed results</li> </ul> <pre><code>cd api\nnpm test observatory.test.ts\n</code></pre>"},{"location":"security/security-headers/#run-all-security-tests","title":"Run All Security Tests","text":"<pre><code>cd api\nnpm test -- --grep \"security|observatory\"\n</code></pre>"},{"location":"security/security-headers/#best-practices","title":"Best Practices","text":"<ol> <li>Never disable security headers in production</li> <li>Always test after deployment with Observatory</li> <li>Monitor CSP violations in production logs</li> <li>Keep Helmet up to date for latest security patches</li> <li>Review headers quarterly as security best practices evolve</li> </ol>"},{"location":"security/security-headers/#related-documentation","title":"Related Documentation","text":"<ul> <li>Security Overview</li> <li>Mozilla Observatory</li> <li>Helmet Documentation</li> <li>CSP Reference</li> </ul>"},{"location":"security/sessions/","title":"Sessions","text":"<p>Documentation coming soon...</p>"},{"location":"user-guide/overview/","title":"User Guide Overview","text":"<p>Welcome to the PulseStage user guide! This section covers everything you need to know to participate effectively in Q&amp;A sessions.</p>"},{"location":"user-guide/overview/#what-is-pulsestage","title":"What is PulseStage?","text":"<p>PulseStage is an open-source Q&amp;A platform designed for town halls, all-hands meetings, and live events. It enables participants to submit questions, upvote the most important ones, and see real-time responses from moderators.</p>"},{"location":"user-guide/overview/#key-features-for-users","title":"Key Features for Users","text":""},{"location":"user-guide/overview/#submit-questions","title":"\ud83d\udcdd Submit Questions","text":"<p>Ask questions anonymously or with your name attached. Questions are visible to your team and can be answered during live sessions.</p> <p>Learn more about submitting questions \u2192</p>"},{"location":"user-guide/overview/#upvote-questions","title":"\ud83d\udc4d Upvote Questions","text":"<p>Help prioritize which questions get answered first by upvoting the ones that matter most to you. The most upvoted questions rise to the top.</p> <p>Learn more about upvoting \u2192</p>"},{"location":"user-guide/overview/#search-filter","title":"\ud83d\udd0d Search &amp; Filter","text":"<p>Find questions by keyword, tag, date range, or status. Use advanced filters to narrow down questions to specific topics or teams.</p> <p>Learn more about search &amp; filtering \u2192</p>"},{"location":"user-guide/overview/#team-context","title":"\ud83d\udc65 Team Context","text":"<p>All questions are scoped to teams, ensuring relevant discussions for your department or group.</p> <p>Learn more about teams \u2192</p>"},{"location":"user-guide/overview/#profile-preferences","title":"\ud83c\udfa8 Profile &amp; Preferences","text":"<p>Customize your experience with theme preferences and profile settings.</p> <p>Learn more about your profile \u2192</p>"},{"location":"user-guide/overview/#getting-started","title":"Getting Started","text":"<ol> <li>Log in with your SSO credentials</li> <li>Select your team from the dropdown menu</li> <li>Browse open questions or submit your own</li> <li>Upvote questions you want answered</li> <li>Check answered questions to see responses</li> </ol>"},{"location":"user-guide/overview/#quick-tips","title":"Quick Tips","text":"<p>Maximize Your Impact</p> <ul> <li>Be specific: Clear, focused questions get better answers</li> <li>Search first: Your question might already be answered</li> <li>Upvote wisely: Help surface the most important questions</li> <li>Check tags: Use tags to find related questions</li> </ul> <p>Real-Time Updates</p> <p>PulseStage updates in real-time! When questions are answered or upvoted, you'll see changes immediately without refreshing.</p>"},{"location":"user-guide/overview/#need-help","title":"Need Help?","text":"<ul> <li>For moderation features: See the Moderator Guide</li> <li>For administration: See the Admin Guide</li> <li>For technical issues: Check our GitHub Issues</li> </ul>"},{"location":"user-guide/overview/#next-steps","title":"Next Steps","text":"<p>Ready to get started? Check out these guides:</p> <ul> <li>Submitting Questions - Learn how to ask effective questions</li> <li>Upvoting - Understand how voting works</li> <li>Search &amp; Browse - Find relevant questions quickly</li> </ul>"},{"location":"user-guide/profile/","title":"Profile","text":"<p>Documentation coming soon...</p>"},{"location":"user-guide/search-browse/","title":"Search &amp; Browse","text":"<p>PulseStage offers powerful search and filtering capabilities to help you find relevant questions quickly.</p>"},{"location":"user-guide/search-browse/#quick-search","title":"Quick Search","text":""},{"location":"user-guide/search-browse/#basic-search","title":"Basic Search","text":"<p>The search bar is available on both Open Questions and Answered Questions pages.</p> <p>Features: - Full-text search - Searches both question body and answers - Prefix matching - \"mob\" finds \"mobile\", \"rem\" finds \"remote\" - Multi-word search - \"remote work\" finds questions containing both words - Debounced input - Results update 300ms after you stop typing (smooth, no lag)</p> <p>Example searches: <pre><code>remote          \u2192 Finds \"remote work\", \"working remotely\", etc.\nbenefits        \u2192 Finds questions about benefits packages\nwork life       \u2192 Finds \"work-life balance\" questions\n</code></pre></p>"},{"location":"user-guide/search-browse/#how-it-works","title":"How It Works","text":"<p>PulseStage uses PostgreSQL full-text search with:</p> <ul> <li>GIN indexes for fast searching</li> <li>English stemming - \"running\" matches \"run\", \"runs\", \"ran\"</li> <li>Relevance ranking - Best matches appear first</li> <li>Prefix operators - Substring matching for partial words</li> </ul>"},{"location":"user-guide/search-browse/#advanced-filters","title":"Advanced Filters","text":"<p>Click \"Advanced Filters\" to access additional filtering options.</p>"},{"location":"user-guide/search-browse/#filter-by-tag","title":"Filter by Tag","text":"<p>Select a tag from the dropdown to show only questions with that tag.</p> <p>Use cases: - Find all \"Important\" questions - See questions \"Currently Presenting\" - Filter by topic tags like \"Policy\" or \"Benefits\"</p>"},{"location":"user-guide/search-browse/#filter-by-date-range","title":"Filter by Date Range","text":"<p>From Date: Show questions created on or after this date To Date: Show questions created on or before this date</p> <p>Date handling: - Inclusive of both start and end dates - Full day included (00:00:00 to 23:59:59) - Works correctly across timezones</p> <p>Use cases: - Questions from last week - Questions submitted before last town hall - Questions from a specific event or meeting</p>"},{"location":"user-guide/search-browse/#filter-by-team","title":"Filter by Team","text":"<p>Automatically applied when viewing a team page (e.g., <code>/engineering/open</code>).</p> <p>Switch teams using the team dropdown in the navigation bar.</p>"},{"location":"user-guide/search-browse/#combined-filters","title":"Combined Filters","text":"<p>All filters work together:</p> <p>Example: Search for \"remote\" + Tag: \"Policy\" + From: Last month - Shows only policy questions about remote work from the last month</p>"},{"location":"user-guide/search-browse/#clear-filters","title":"Clear Filters","text":"<p>The \"Clear All Filters\" button appears when filters are active.</p> <p>Shows count: \"Clear All Filters (3)\" indicating how many filters are applied.</p>"},{"location":"user-guide/search-browse/#browsing-questions","title":"Browsing Questions","text":""},{"location":"user-guide/search-browse/#open-questions-page","title":"Open Questions Page","text":"<p>Default View: - Shows all OPEN (unanswered) questions - Sorted by upvotes (highest first) - Real-time updates as new questions arrive</p> <p>Includes: - Question body - Upvote count with button - Tags (color-coded) - Team name - Creation date - Upvote button (if you haven't upvoted yet)</p>"},{"location":"user-guide/search-browse/#answered-questions-page","title":"Answered Questions Page","text":"<p>Default View: - Shows all ANSWERED questions - Grouped by week - Sorted by date (most recent first)</p> <p>Card View Features: - Question preview (truncated) - Answer preview (truncated) - Click to expand and read full Q&amp;A - Tags visible - Upvote count - Answered date</p>"},{"location":"user-guide/search-browse/#question-details","title":"Question Details","text":"<p>Click any question to see:</p> <ul> <li>Full question text</li> <li>Complete answer (if answered)</li> <li>All tags</li> <li>Upvote count</li> <li>Submission and answer timestamps</li> <li>Team information</li> </ul>"},{"location":"user-guide/search-browse/#search-tips","title":"Search Tips","text":""},{"location":"user-guide/search-browse/#finding-specific-topics","title":"Finding Specific Topics","text":"<ol> <li>Use specific keywords - \"remote policy\" better than \"remote\"</li> <li>Try variations - \"benefit\", \"benefits\", \"comp\", \"compensation\"</li> <li>Use tags - Filter by tag after searching</li> </ol>"},{"location":"user-guide/search-browse/#discovering-trending-topics","title":"Discovering Trending Topics","text":"<ol> <li>Sort by upvotes - Default on Open Questions</li> <li>Check recent - Use date filter for last week</li> <li>Browse by team - See what each team is asking</li> </ol>"},{"location":"user-guide/search-browse/#research-before-submitting","title":"Research Before Submitting","text":"<ol> <li>Search first - Your question might already be asked</li> <li>Upvote existing - Better than duplicate submissions</li> <li>Check answered - Question might already have an answer</li> </ol>"},{"location":"user-guide/search-browse/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"<p>While browsing:</p> <ul> <li>Type to search - Focus is on search bar by default</li> <li>Click question - Open details/answer modal</li> <li>Click upvote - Upvote without opening modal</li> </ul>"},{"location":"user-guide/search-browse/#real-time-updates","title":"Real-Time Updates","text":"<p>Search results and filtered views update in real-time:</p> <ul> <li>New questions appear automatically if they match filters</li> <li>Upvote counts update live</li> <li>Tags added by moderators appear instantly</li> <li>Status changes (answered questions removed from open view)</li> </ul> <p>No need to refresh the page!</p>"},{"location":"user-guide/search-browse/#mobile-experience","title":"Mobile Experience","text":"<p>All search and filter features work on mobile:</p> <ul> <li>Responsive filters - Stack vertically on small screens</li> <li>Touch-friendly - Large tap targets for upvotes and filters</li> <li>Collapsible filters - Advanced filters hidden by default to save space</li> </ul>"},{"location":"user-guide/search-browse/#related-pages","title":"Related Pages","text":"<ul> <li>Submitting Questions</li> <li>Upvoting</li> <li>Teams</li> </ul>"},{"location":"user-guide/submitting-questions/","title":"Submitting Questions","text":"<p>Documentation coming soon...</p>"},{"location":"user-guide/teams/","title":"Teams","text":"<p>Documentation coming soon...</p>"},{"location":"user-guide/upvoting/","title":"Upvoting","text":"<p>Documentation coming soon...</p>"}]}